/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Component, Input, ViewChild, ElementRef, } from "@angular/core";
import { AmexioD3BaseChartComponent } from "../base/base.component";
import { CommanDataService } from '../services/comman.data.service';
import * as d3 from 'd3';
import { DeviceQueryService } from '../services/device.query.service';
var CombochartComponent = /** @class */ (function (_super) {
    tslib_1.__extends(CombochartComponent, _super);
    function CombochartComponent(myservice, device) {
        var _this = _super.call(this, 'combochart') || this;
        _this.myservice = myservice;
        _this.device = device;
        _this.svgwidth = 300;
        _this.svgheight = 300;
        _this.lineColor = "black";
        _this.horizontal = false;
        _this.level = 0;
        _this.drillabledatakey = [];
        _this.hScale = true;
        _this.drillableFlag = true;
        _this.resizeflag = false;
        _this.colorflag = false;
        _this.keyArray = [];
        _this.transformeddata = [];
        _this.legendArray = [];
        return _this;
    }
    /**
     * @return {?}
     */
    CombochartComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        if (this.level <= 1) {
            /** @type {?} */
            var resp_1;
            if (this.httpmethod && this.httpurl) {
                this.myservice.fetchUrlData(this.httpurl, this.httpmethod).subscribe(function (response) {
                    resp_1 = response;
                    _this.httpresponse = response;
                }, function (error) {
                }, function () {
                    setTimeout(function () {
                        _this.data = _this.getResponseData(resp_1);
                        _this.transformData(_this.data);
                        _this.initializeData();
                        _this.plotD3Chart();
                    }, 0);
                });
            }
            else if (this.data) {
                setTimeout(function () {
                    _this.data = _this.getResponseData(_this.data);
                    _this.transformData(_this.data);
                    _this.initializeData();
                    _this.plotD3Chart();
                }, 0);
            }
        }
    };
    /**
     * @param {?} data
     * @return {?}
     */
    CombochartComponent.prototype.fetchData = /**
     * @param {?} data
     * @return {?}
     */
    function (data) {
        var _this = this;
        /** @type {?} */
        var requestJson;
        /** @type {?} */
        var key = this.drillabledatakey;
        /** @type {?} */
        var resp;
        if (this.drillabledatakey.length) {
            /** @type {?} */
            var drillabledata = this.getMultipleDrillbleKeyData(data, key);
            requestJson = drillabledata;
        }
        else {
            requestJson = data;
        }
        if (this.httpmethod && this.httpurl) {
            this.myservice.postfetchData(this.httpurl, this.httpmethod, requestJson).subscribe(function (response) {
                resp = response;
                _this.httpresponse = response;
            }, function (error) {
            }, function () {
                setTimeout(function () {
                    // this.data = this.getResponseData(resp);
                    _this.drawChart();
                }, 0);
            });
        }
    };
    /**
     * @return {?}
     */
    CombochartComponent.prototype.drawChart = /**
     * @return {?}
     */
    function () {
        var _this = this;
        setTimeout(function () {
            _this.data = _this.getResponseData(_this.httpresponse);
            _this.transformData(_this.data);
            _this.initializeData();
            _this.plotD3Chart();
        }, 0);
    };
    /**
     * @param {?} httpResponse
     * @return {?}
     */
    CombochartComponent.prototype.getResponseData = /**
     * @param {?} httpResponse
     * @return {?}
     */
    function (httpResponse) {
        /** @type {?} */
        var responsedata = httpResponse;
        if (this.datareader != null) {
            /** @type {?} */
            var dr = this.datareader.split('.');
            try {
                for (var dr_1 = tslib_1.__values(dr), dr_1_1 = dr_1.next(); !dr_1_1.done; dr_1_1 = dr_1.next()) {
                    var ir = dr_1_1.value;
                    responsedata = responsedata[ir];
                }
            }
            catch (e_1_1) { e_1 = { error: e_1_1 }; }
            finally {
                try {
                    if (dr_1_1 && !dr_1_1.done && (_a = dr_1.return)) _a.call(dr_1);
                }
                finally { if (e_1) throw e_1.error; }
            }
        }
        else {
            responsedata = httpResponse;
        }
        return responsedata;
        var e_1, _a;
    };
    /**
     * @return {?}
     */
    CombochartComponent.prototype.plotD3Chart = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.formLegendData();
        if (this.resizeflag == false) {
            if (this.chartId) {
                this.svgwidth = this.chartId.nativeElement.offsetWidth;
            }
            else {
                this.svgwidth = this.svgwidth;
            }
        }
        /** @type {?} */
        var lineName = this.lineInput;
        /** @type {?} */
        var tooltip = this.toolTip(d3);
        this.svg = d3.select("#" + this.componentId);
        /** @type {?} */
        var margin = { top: 20, right: 20, bottom: 85, left: 60 };
        /** @type {?} */
        var width = this.svgwidth - margin.left - margin.right;
        /** @type {?} */
        var height;
        console.log("offsetheight", this.offsetheight);
        if (this.device.IsDesktop() == true) {
            this.offsetheight = this.chartId.nativeElement.offsetHeight - 20 - 90;
            height = this.offsetheight;
        }
        else {
            height = this.svgheight - margin.top - margin.bottom;
        }
        /** @type {?} */
        var x;
        /** @type {?} */
        var y;
        /** @type {?} */
        var g = this.svg.append("g")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
        if (this.horizontal == false) {
            x = d3.scaleBand()
                .rangeRound([0, width])
                .padding(0.1);
            y = d3.scaleLinear()
                .rangeRound([height, 0]);
            //setting content for x and y axis
            x.domain(this.data.map(function (d) {
                return d[Object.keys(d)[0]];
            }));
            /** @type {?} */
            var barRange = d3.max(this.data, function (d) {
                return d[Object.keys(d)[1]];
            });
            /** @type {?} */
            var lineRange = d3.max(this.data, function (d) {
                return d[_this.lineInput];
            });
            /** @type {?} */
            var range = void 0;
            if (barRange > lineRange) {
                range = barRange;
            }
            else {
                range = lineRange;
            }
            y.domain([0, range]);
            if (this.device.IsDesktop() == true) {
                g.append("g")
                    .attr("transform", "translate(0," + height + ")")
                    .call(d3.axisBottom(x));
            }
            else {
                g.append("g")
                    .attr("transform", "translate(0," + height + ")")
                    .call(d3.axisBottom(x)).
                    selectAll("text")
                    .attr("y", 0)
                    .attr("x", 9)
                    .attr("dy", ".35em")
                    .attr("transform", "rotate(65)")
                    .style("text-anchor", "start");
            }
            //add y axis to svg
            g.append("g")
                .call(d3.axisLeft(y)
                .ticks(10));
            this.plotLine(g, x, y, height, width);
            //add bar chart
            g.selectAll(".bar")
                .data(this.data)
                .enter()
                .append("rect")
                .attr("class", "bar")
                .attr("x", function (d) {
                return x(d[Object.keys(d)[0]]);
            })
                .attr("y", function (d) {
                return y(d[Object.keys(d)[1]]);
            })
                .attr("cursor", "pointer")
                .attr("width", x.bandwidth())
                .attr("height", function (d) { return height - y(d[Object.keys(d)[1]]); })
                .style("fill", function (d) {
                return d.color;
            })
                .on("mouseover", function (d) {
                return tooltip.style("visibility", "visible");
            })
                .on("mousemove", function (d) {
                return tooltip.html(_this.formTooltipData(d))
                    .style("top", (d3.event.pageY - 10) + "px")
                    .style("left", (d3.event.pageX + 10) + "px");
            })
                .on("mouseout", function (d) {
                return tooltip.style("visibility", "hidden");
            })
                .on("click", function (d) {
                _this.barChartClick(d);
                _this.fordrillableClick(_this, d, event);
                return tooltip.style("visibility", "hidden");
            });
            //line code start
            /** @type {?} */
            var valueline = d3.line()
                .x(function (d) {
                return x(d[Object.keys(d)[0]]);
            })
                .y(function (d) {
                return y(d[lineName]);
            });
            /** @type {?} */
            var shift = margin.left + x.bandwidth() / 2;
            this.svg.append("path")
                .data([this.data])
                .attr("fill", "none")
                .style("stroke", this.lineColor)
                .attr("stroke-width", 1.5)
                .attr("transform", "translate( " + shift + ", 20 )")
                .attr("d", valueline);
            /** @type {?} */
            var points1 = this.svg.selectAll("circle.point1")
                .data(this.data);
            points1.enter().append("circle")
                .merge(points1)
                .attr("class", "point1")
                .attr("cursor", "pointer")
                .style("stroke", this.lineColor)
                .style("fill", this.lineColor)
                .attr("cx", function (d) {
                return x(d[Object.keys(d)[0]]);
            })
                .attr("cy", function (d) {
                return y(d[lineName]);
            })
                .attr("r", function (d) { return 5; })
                .attr("transform", "translate( " + shift + ", 20 )")
                .on("mouseover", function (d) {
                return tooltip.style("visibility", "visible");
            })
                .on("mousemove", function (d) {
                return tooltip.html(_this.formTooltipLineData(d))
                    .style("top", (d3.event.pageY - 10) + "px")
                    .style("left", (d3.event.pageX + 10) + "px");
            })
                .on("mouseout", function (d) {
                return tooltip.style("visibility", "hidden");
            })
                .on("click", function (d) {
                _this.onComboLineClick(d);
                _this.fordrillableClick(_this, d, event);
                return tooltip.style("visibility", "hidden");
            });
            //line code ends
        }
    };
    /**
     * @param {?} g
     * @param {?} x
     * @param {?} y
     * @param {?} height
     * @param {?} width
     * @return {?}
     */
    CombochartComponent.prototype.plotLine = /**
     * @param {?} g
     * @param {?} x
     * @param {?} y
     * @param {?} height
     * @param {?} width
     * @return {?}
     */
    function (g, x, y, height, width) {
        if (this.hScale) {
            g.append('g')
                .attr("color", "lightgrey")
                .call(d3.axisLeft(y)
                .tickSize(-width).tickFormat(''));
        }
    };
    /**
     * @param {?} tooltipData
     * @return {?}
     */
    CombochartComponent.prototype.formTooltipData = /**
     * @param {?} tooltipData
     * @return {?}
     */
    function (tooltipData) {
        /** @type {?} */
        var object = {};
        try {
            for (var _a = tslib_1.__values(Object.entries(tooltipData)), _b = _a.next(); !_b.done; _b = _a.next()) {
                var _c = tslib_1.__read(_b.value, 2), key = _c[0], value = _c[1];
                if (key != 'color') {
                    object[key] = value;
                }
            }
        }
        catch (e_2_1) { e_2 = { error: e_2_1 }; }
        finally {
            try {
                if (_b && !_b.done && (_d = _a.return)) _d.call(_a);
            }
            finally { if (e_2) throw e_2.error; }
        }
        return this.toolTipForBar(object);
        var e_2, _d;
    };
    /**
     * @param {?} data
     * @return {?}
     */
    CombochartComponent.prototype.transformData = /**
     * @param {?} data
     * @return {?}
     */
    function (data) {
        var _this = this;
        this.transformeddata = [];
        this.keyArray = data[0];
        data.forEach(function (element, index) {
            if (index > 0) {
                /** @type {?} */
                var DummyObject_1 = {};
                element.forEach(function (individualvalue, keyindex) {
                    DummyObject_1[_this.keyArray[keyindex]] = individualvalue;
                }); //inner for loop ends
                _this.transformeddata.push(DummyObject_1);
            } //if ends
        }); //outer for loop ends
        this.data = this.transformeddata;
    };
    /**
     * @return {?}
     */
    CombochartComponent.prototype.formLegendData = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.legendArray = [];
        this.data.forEach(function (element) {
            /** @type {?} */
            var legendobject = {};
            legendobject['label'] = element[Object.keys(element)[0]];
            legendobject['value'] = element[Object.keys(element)[1]];
            legendobject['color'] = element.color;
            _this.legendArray.push(legendobject);
        });
    };
    /**
     * @param {?} legendevent
     * @return {?}
     */
    CombochartComponent.prototype.onBarLegendClick = /**
     * @param {?} legendevent
     * @return {?}
     */
    function (legendevent) {
        /** @type {?} */
        var obj = {};
        obj[this.keyArray[0]] = legendevent.label;
        obj[this.keyArray[1]] = legendevent.value;
        this.legendClick(obj);
    };
    /**
     * @param {?} event
     * @return {?}
     */
    CombochartComponent.prototype.barChartClick = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        /** @type {?} */
        var object = {};
        try {
            for (var _a = tslib_1.__values(Object.entries(event)), _b = _a.next(); !_b.done; _b = _a.next()) {
                var _c = tslib_1.__read(_b.value, 2), key = _c[0], value = _c[1];
                if (key != 'color') {
                    object[key] = value;
                }
            }
        }
        catch (e_3_1) { e_3 = { error: e_3_1 }; }
        finally {
            try {
                if (_b && !_b.done && (_d = _a.return)) _d.call(_a);
            }
            finally { if (e_3) throw e_3.error; }
        }
        this.chartClick(object);
        var e_3, _d;
    };
    /**
     * @param {?} data
     * @return {?}
     */
    CombochartComponent.prototype.onComboLineClick = /**
     * @param {?} data
     * @return {?}
     */
    function (data) {
        /** @type {?} */
        var object = {};
        try {
            for (var _a = tslib_1.__values(Object.entries(data)), _b = _a.next(); !_b.done; _b = _a.next()) {
                var _c = tslib_1.__read(_b.value, 2), key = _c[0], value = _c[1];
                if (key != "color") {
                    object[key] = value;
                }
            }
        }
        catch (e_4_1) { e_4 = { error: e_4_1 }; }
        finally {
            try {
                if (_b && !_b.done && (_d = _a.return)) _d.call(_a);
            }
            finally { if (e_4) throw e_4.error; }
        }
        this.comboLineClick(object);
        var e_4, _d;
        //this.chartClick(object);
    };
    /**
     * @param {?} data
     * @return {?}
     */
    CombochartComponent.prototype.formTooltipLineData = /**
     * @param {?} data
     * @return {?}
     */
    function (data) {
        /** @type {?} */
        var object = {};
        try {
            for (var _a = tslib_1.__values(Object.entries(data)), _b = _a.next(); !_b.done; _b = _a.next()) {
                var _c = tslib_1.__read(_b.value, 2), key = _c[0], value = _c[1];
                if (key == this.lineInput) {
                    object[key] = value;
                }
            }
        }
        catch (e_5_1) { e_5 = { error: e_5_1 }; }
        finally {
            try {
                if (_b && !_b.done && (_d = _a.return)) _d.call(_a);
            }
            finally { if (e_5) throw e_5.error; }
        }
        return this.toolTipForBar(object);
        var e_5, _d;
    };
    /**
     * @return {?}
     */
    CombochartComponent.prototype.resize = /**
     * @return {?}
     */
    function () {
        this.svgwidth = 0;
        this.svg.selectAll("*").remove();
        this.resizeflag = true;
        this.svgwidth = this.divid.nativeElement.offsetWidth;
        //  this.svgheight=this.offsetheight;
        this.plotD3Chart();
    };
    CombochartComponent.decorators = [
        { type: Component, args: [{
                    selector: 'amexio-d3-combochart',
                    template: "<div *ngIf=\"drillableFlag\" #divid (window:resize)=\"resize()\">\n<table style=\"width: 100%;\" #chartId >\n  <tr>\n      <td style=\"font-size: 18px; font-weight: bold; \"> {{title}} </td>\n  </tr>\n  <tr>\n      <td>\n          <svg [attr.height]=\"svgheight\" [attr.width]=\"svgwidth\" [attr.id]=\"componentId\">\n          </svg>\n      </td>\n  </tr>\n  <tr>\n      <td style=\"display: block; padding: 5px;\">\n          <amexio-d3-legend *ngIf=\"legend\" [horizontal]=\"true\" (onClick)=\"onBarLegendClick($event)\" [data]=\"legendArray\" style=\"height:100%;\">\n          </amexio-d3-legend>\n      </td>\n  </tr>\n</table>\n</div>",
                    styles: [""]
                },] },
    ];
    CombochartComponent.ctorParameters = function () { return [
        { type: CommanDataService },
        { type: DeviceQueryService }
    ]; };
    CombochartComponent.propDecorators = {
        svgwidth: [{ type: Input, args: ['width',] }],
        svgheight: [{ type: Input, args: ['height',] }],
        lineColor: [{ type: Input, args: ['line-color',] }],
        horizontal: [{ type: Input }],
        chartId: [{ type: ViewChild, args: ['chartId',] }],
        divid: [{ type: ViewChild, args: ['divid',] }],
        datareader: [{ type: Input, args: ['data-reader',] }],
        level: [{ type: Input, args: ['level',] }],
        target: [{ type: Input, args: ['target',] }],
        drillabledatakey: [{ type: Input, args: ['drillable-data',] }],
        lineInput: [{ type: Input, args: ['line-data-index',] }],
        hScale: [{ type: Input, args: ['horizontal-scale',] }]
    };
    return CombochartComponent;
}(AmexioD3BaseChartComponent));
export { CombochartComponent };
if (false) {
    /** @type {?} */
    CombochartComponent.prototype.svgwidth;
    /** @type {?} */
    CombochartComponent.prototype.svgheight;
    /** @type {?} */
    CombochartComponent.prototype.lineColor;
    /** @type {?} */
    CombochartComponent.prototype.horizontal;
    /** @type {?} */
    CombochartComponent.prototype.chartId;
    /** @type {?} */
    CombochartComponent.prototype.divid;
    /** @type {?} */
    CombochartComponent.prototype.datareader;
    /** @type {?} */
    CombochartComponent.prototype.level;
    /** @type {?} */
    CombochartComponent.prototype.target;
    /** @type {?} */
    CombochartComponent.prototype.drillabledatakey;
    /** @type {?} */
    CombochartComponent.prototype.lineInput;
    /** @type {?} */
    CombochartComponent.prototype.hScale;
    /** @type {?} */
    CombochartComponent.prototype.drillableFlag;
    /** @type {?} */
    CombochartComponent.prototype.resizeflag;
    /** @type {?} */
    CombochartComponent.prototype.data;
    /** @type {?} */
    CombochartComponent.prototype.svg;
    /** @type {?} */
    CombochartComponent.prototype.colorflag;
    /** @type {?} */
    CombochartComponent.prototype.keyArray;
    /** @type {?} */
    CombochartComponent.prototype.transformeddata;
    /** @type {?} */
    CombochartComponent.prototype.object;
    /** @type {?} */
    CombochartComponent.prototype.legendArray;
    /** @type {?} */
    CombochartComponent.prototype.httpresponse;
    /** @type {?} */
    CombochartComponent.prototype.offsetheight;
    /** @type {?} */
    CombochartComponent.prototype.myservice;
    /** @type {?} */
    CombochartComponent.prototype.device;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tYm9jaGFydC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9hbWV4aW8tY2hhcnQtZDMvIiwic291cmNlcyI6WyJsaWIvY29tYm9jaGFydC9jb21ib2NoYXJ0LmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFFLFNBQVMsRUFBRSxVQUFVLEdBQUcsTUFBTSxlQUFlLENBQUM7QUFDekUsT0FBTyxFQUFFLDBCQUEwQixFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFFcEUsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0saUNBQWlDLENBQUM7QUFDcEUsT0FBTyxLQUFLLEVBQUUsTUFBTSxJQUFJLENBQUM7QUFFekIsT0FBTSxFQUFDLGtCQUFrQixFQUFDLE1BQU0sa0NBQWtDLENBQUM7QUFDbkU7SUF1QnlDLCtDQUEwQjtJQXlCL0QsNkJBQW9CLFNBQTRCLEVBQVMsTUFBeUI7UUFBbEYsWUFDSSxrQkFBTSxZQUFZLENBQUMsU0FDdEI7UUFGbUIsZUFBUyxHQUFULFNBQVMsQ0FBbUI7UUFBUyxZQUFNLEdBQU4sTUFBTSxDQUFtQjtRQXhCbEUsY0FBUSxHQUFXLEdBQUcsQ0FBQztRQUN0QixlQUFTLEdBQVcsR0FBRyxDQUFDO1FBQ3BCLGVBQVMsR0FBVyxPQUFPLENBQUM7UUFDeEMsZ0JBQVUsR0FBWSxLQUFLLENBQUM7UUFJckIsV0FBSyxHQUFXLENBQUMsQ0FBQztRQUVULHNCQUFnQixHQUFVLEVBQUUsQ0FBQTtRQUUxQixZQUFNLEdBQWEsSUFBSSxDQUFDO1FBQ25ELG1CQUFhLEdBQVksSUFBSSxDQUFDO1FBQzlCLGdCQUFVLEdBQVMsS0FBSyxDQUFDO1FBR3pCLGVBQVMsR0FBWSxLQUFLLENBQUM7UUFDM0IsY0FBUSxHQUFVLEVBQUUsQ0FBQztRQUNyQixxQkFBZSxHQUFVLEVBQUUsQ0FBQztRQUU1QixpQkFBVyxHQUFVLEVBQUUsQ0FBQzs7SUFNeEIsQ0FBQzs7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OzsyQkF5QnBCLEtBQUssU0FBQyxPQUFPOzRCQUNiLEtBQUssU0FBQyxRQUFROzRCQUNkLEtBQUssU0FBQyxZQUFZOzZCQUNsQixLQUFLOzBCQUNMLFNBQVMsU0FBQyxTQUFTO3dCQUNuQixTQUFTLFNBQUMsT0FBTzs2QkFDakIsS0FBSyxTQUFDLGFBQWE7d0JBQ25CLEtBQUssU0FBQyxPQUFPO3lCQUNiLEtBQUssU0FBQyxRQUFRO21DQUNkLEtBQUssU0FBQyxnQkFBZ0I7NEJBQ3RCLEtBQUssU0FBQyxpQkFBaUI7eUJBQ3ZCLEtBQUssU0FBQyxrQkFBa0I7O0lBaVk3QiwwQkFBQztDQUFBLEFBcGFELENBdUJ5QywwQkFBMEIsR0E2WWxFO1NBN1lZLG1CQUFtQjs7O0lBQzVCLHVDQUF1Qzs7SUFDdkMsd0NBQXlDOztJQUN6Qyx3Q0FBaUQ7O0lBQ2pELHlDQUFxQzs7SUFDckMsc0NBQTBDOztJQUMxQyxvQ0FBc0M7O0lBQ3RDLHlDQUF5Qzs7SUFDekMsb0NBQWtDOztJQUNsQyxxQ0FBZ0M7O0lBQ2hDLCtDQUFxRDs7SUFDckQsd0NBQXlDOztJQUN6QyxxQ0FBbUQ7O0lBQ25ELDRDQUE4Qjs7SUFDOUIseUNBQXlCOztJQUN6QixtQ0FBVTs7SUFDVixrQ0FBUTs7SUFDUix3Q0FBMkI7O0lBQzNCLHVDQUFxQjs7SUFDckIsOENBQTRCOztJQUM1QixxQ0FBWTs7SUFDWiwwQ0FBd0I7O0lBQ3hCLDJDQUFpQjs7SUFDakIsMkNBQWlCOztJQUVMLHdDQUFvQzs7SUFBQyxxQ0FBaUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIElucHV0LCBWaWV3Q2hpbGQsIEVsZW1lbnRSZWYsIH0gZnJvbSBcIkBhbmd1bGFyL2NvcmVcIjtcbmltcG9ydCB7IEFtZXhpb0QzQmFzZUNoYXJ0Q29tcG9uZW50IH0gZnJvbSBcIi4uL2Jhc2UvYmFzZS5jb21wb25lbnRcIjtcbmltcG9ydCB7IFBsb3RDYXJ0IH0gZnJvbSBcIi4uL2Jhc2UvY2hhcnQuY29tcG9uZW50XCI7XG5pbXBvcnQgeyBDb21tYW5EYXRhU2VydmljZSB9IGZyb20gJy4uL3NlcnZpY2VzL2NvbW1hbi5kYXRhLnNlcnZpY2UnO1xuaW1wb3J0ICogYXMgZDMgZnJvbSAnZDMnO1xuaW1wb3J0IHsgc3RyaW5naWZ5IH0gZnJvbSBcIkBhbmd1bGFyL2NvcmUvc3JjL3JlbmRlcjMvdXRpbFwiO1xuaW1wb3J0e0RldmljZVF1ZXJ5U2VydmljZX0gZnJvbSAnLi4vc2VydmljZXMvZGV2aWNlLnF1ZXJ5LnNlcnZpY2UnO1xuQENvbXBvbmVudCh7XG4gICAgc2VsZWN0b3I6ICdhbWV4aW8tZDMtY29tYm9jaGFydCcsXG4gICAgdGVtcGxhdGU6IGA8ZGl2ICpuZ0lmPVwiZHJpbGxhYmxlRmxhZ1wiICNkaXZpZCAod2luZG93OnJlc2l6ZSk9XCJyZXNpemUoKVwiPlxuPHRhYmxlIHN0eWxlPVwid2lkdGg6IDEwMCU7XCIgI2NoYXJ0SWQgPlxuICA8dHI+XG4gICAgICA8dGQgc3R5bGU9XCJmb250LXNpemU6IDE4cHg7IGZvbnQtd2VpZ2h0OiBib2xkOyBcIj4ge3t0aXRsZX19IDwvdGQ+XG4gIDwvdHI+XG4gIDx0cj5cbiAgICAgIDx0ZD5cbiAgICAgICAgICA8c3ZnIFthdHRyLmhlaWdodF09XCJzdmdoZWlnaHRcIiBbYXR0ci53aWR0aF09XCJzdmd3aWR0aFwiIFthdHRyLmlkXT1cImNvbXBvbmVudElkXCI+XG4gICAgICAgICAgPC9zdmc+XG4gICAgICA8L3RkPlxuICA8L3RyPlxuICA8dHI+XG4gICAgICA8dGQgc3R5bGU9XCJkaXNwbGF5OiBibG9jazsgcGFkZGluZzogNXB4O1wiPlxuICAgICAgICAgIDxhbWV4aW8tZDMtbGVnZW5kICpuZ0lmPVwibGVnZW5kXCIgW2hvcml6b250YWxdPVwidHJ1ZVwiIChvbkNsaWNrKT1cIm9uQmFyTGVnZW5kQ2xpY2soJGV2ZW50KVwiIFtkYXRhXT1cImxlZ2VuZEFycmF5XCIgc3R5bGU9XCJoZWlnaHQ6MTAwJTtcIj5cbiAgICAgICAgICA8L2FtZXhpby1kMy1sZWdlbmQ+XG4gICAgICA8L3RkPlxuICA8L3RyPlxuPC90YWJsZT5cbjwvZGl2PmAsXG4gICAgc3R5bGVzOiBbYGBdXG59KVxuZXhwb3J0IGNsYXNzIENvbWJvY2hhcnRDb21wb25lbnQgZXh0ZW5kcyBBbWV4aW9EM0Jhc2VDaGFydENvbXBvbmVudCBpbXBsZW1lbnRzIFBsb3RDYXJ0IHtcbiAgICBASW5wdXQoJ3dpZHRoJykgc3Znd2lkdGg6IG51bWJlciA9IDMwMDtcbiAgICBASW5wdXQoJ2hlaWdodCcpIHN2Z2hlaWdodDogbnVtYmVyID0gMzAwO1xuICAgIEBJbnB1dCgnbGluZS1jb2xvcicpIGxpbmVDb2xvcjogc3RyaW5nID0gXCJibGFja1wiO1xuICAgIEBJbnB1dCgpIGhvcml6b250YWw6IGJvb2xlYW4gPSBmYWxzZTtcbiAgICBAVmlld0NoaWxkKCdjaGFydElkJykgY2hhcnRJZDogRWxlbWVudFJlZjtcbiAgICBAVmlld0NoaWxkKCdkaXZpZCcpIGRpdmlkOiBFbGVtZW50UmVmO1xuICAgIEBJbnB1dCgnZGF0YS1yZWFkZXInKSBkYXRhcmVhZGVyOiBzdHJpbmc7XG4gICAgQElucHV0KCdsZXZlbCcpIGxldmVsOiBudW1iZXIgPSAwO1xuICAgIEBJbnB1dCgndGFyZ2V0JykgdGFyZ2V0OiBudW1iZXI7XG4gICAgQElucHV0KCdkcmlsbGFibGUtZGF0YScpIGRyaWxsYWJsZWRhdGFrZXk6IGFueVtdID0gW11cbiAgICBASW5wdXQoJ2xpbmUtZGF0YS1pbmRleCcpIGxpbmVJbnB1dDogYW55O1xuICAgIEBJbnB1dCgnaG9yaXpvbnRhbC1zY2FsZScpIGhTY2FsZSA6IGJvb2xlYW4gPSB0cnVlO1xuICAgIGRyaWxsYWJsZUZsYWc6IGJvb2xlYW4gPSB0cnVlO1xuICAgIHJlc2l6ZWZsYWc6Ym9vbGVhbj1mYWxzZTtcbiAgICBkYXRhOiBhbnk7XG4gICAgc3ZnOmFueTtcbiAgICBjb2xvcmZsYWc6IGJvb2xlYW4gPSBmYWxzZTtcbiAgICBrZXlBcnJheTogYW55W10gPSBbXTtcbiAgICB0cmFuc2Zvcm1lZGRhdGE6IGFueVtdID0gW107XG4gICAgb2JqZWN0OiBhbnk7XG4gICAgbGVnZW5kQXJyYXk6IGFueVtdID0gW107XG4gICAgaHR0cHJlc3BvbnNlOmFueTtcbiAgICBvZmZzZXRoZWlnaHQ6YW55O1xuICAgXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBteXNlcnZpY2U6IENvbW1hbkRhdGFTZXJ2aWNlLHByaXZhdGUgZGV2aWNlOkRldmljZVF1ZXJ5U2VydmljZSkge1xuICAgICAgICBzdXBlcignY29tYm9jaGFydCcpO1xuICAgIH1cbiAgICBuZ09uSW5pdCgpIHtcbiAgICAgIFxuICAgICAgICBpZiAodGhpcy5sZXZlbCA8PSAxKSB7XG4gICAgICAgICAgICBsZXQgcmVzcDogYW55O1xuICAgICAgICAgICAgaWYgKHRoaXMuaHR0cG1ldGhvZCAmJiB0aGlzLmh0dHB1cmwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLm15c2VydmljZS5mZXRjaFVybERhdGEodGhpcy5odHRwdXJsLCB0aGlzLmh0dHBtZXRob2QpLnN1YnNjcmliZSgocmVzcG9uc2UpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgcmVzcCA9IHJlc3BvbnNlO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmh0dHByZXNwb25zZT1yZXNwb25zZTtcbiAgICAgICAgICAgICAgICB9LCAoZXJyb3IpID0+IHtcbiAgICAgICAgICAgICAgICB9LCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kYXRhID0gdGhpcy5nZXRSZXNwb25zZURhdGEocmVzcCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRyYW5zZm9ybURhdGEodGhpcy5kYXRhKVxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbml0aWFsaXplRGF0YSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wbG90RDNDaGFydCgpO1xuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgfSwgMCk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5kYXRhKSB7XG5cbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kYXRhID0gdGhpcy5nZXRSZXNwb25zZURhdGEodGhpcy5kYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50cmFuc2Zvcm1EYXRhKHRoaXMuZGF0YSlcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbml0aWFsaXplRGF0YSgpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBsb3REM0NoYXJ0KCk7XG5cbiAgICAgICAgICAgICAgICB9LCAwKTtcblxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIGZldGNoRGF0YShkYXRhOiBhbnkpIHtcblxuICAgICAgICBsZXQgcmVxdWVzdEpzb247XG4gICAgICAgIGxldCBrZXkgPSB0aGlzLmRyaWxsYWJsZWRhdGFrZXk7XG4gICAgICAgIGxldCByZXNwOiBhbnk7XG4gICAgICAgIGlmICh0aGlzLmRyaWxsYWJsZWRhdGFrZXkubGVuZ3RoKSB7XG4gICAgICAgICAgICBsZXQgZHJpbGxhYmxlZGF0YSA9IHRoaXMuZ2V0TXVsdGlwbGVEcmlsbGJsZUtleURhdGEoZGF0YSwga2V5KTtcbiAgICAgICAgICAgIHJlcXVlc3RKc29uID0gZHJpbGxhYmxlZGF0YTtcblxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmVxdWVzdEpzb24gPSBkYXRhO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmh0dHBtZXRob2QgJiYgdGhpcy5odHRwdXJsKSB7XG4gICAgICAgICAgICB0aGlzLm15c2VydmljZS5wb3N0ZmV0Y2hEYXRhKHRoaXMuaHR0cHVybCwgdGhpcy5odHRwbWV0aG9kLCByZXF1ZXN0SnNvbikuc3Vic2NyaWJlKChyZXNwb25zZSkgPT4ge1xuICAgICAgICAgICAgICAgIHJlc3AgPSByZXNwb25zZTtcbiAgICAgICAgICAgICAgICB0aGlzLmh0dHByZXNwb25zZT1yZXNwb25zZTtcbiAgICAgICAgICAgIH0sIChlcnJvcikgPT4ge1xuICAgICAgICAgICAgfSwgKCkgPT4ge1xuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgIC8vIHRoaXMuZGF0YSA9IHRoaXMuZ2V0UmVzcG9uc2VEYXRhKHJlc3ApO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmRyYXdDaGFydCgpO1xuICAgICAgICAgICAgICAgIH0sIDApO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBkcmF3Q2hhcnQoKSB7XG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4geyBcbiAgICAgICAgICAgIHRoaXMuZGF0YSA9IHRoaXMuZ2V0UmVzcG9uc2VEYXRhKHRoaXMuaHR0cHJlc3BvbnNlKTtcbiAgICAgICAgICAgIHRoaXMudHJhbnNmb3JtRGF0YSh0aGlzLmRhdGEpXG4gICAgICAgICAgICB0aGlzLmluaXRpYWxpemVEYXRhKCk7XG4gICAgICAgICAgICB0aGlzLnBsb3REM0NoYXJ0KCk7XG4gICAgICAgIH0sIDApO1xuXG4gICAgfVxuICAgIGdldFJlc3BvbnNlRGF0YShodHRwUmVzcG9uc2U6IGFueSkge1xuICAgICAgICBsZXQgcmVzcG9uc2VkYXRhID0gaHR0cFJlc3BvbnNlO1xuICAgICAgICBpZiAodGhpcy5kYXRhcmVhZGVyICE9IG51bGwpIHtcbiAgICAgICAgICAgIGNvbnN0IGRyID0gdGhpcy5kYXRhcmVhZGVyLnNwbGl0KCcuJyk7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGlyIG9mIGRyKSB7XG4gICAgICAgICAgICAgICAgcmVzcG9uc2VkYXRhID0gcmVzcG9uc2VkYXRhW2lyXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJlc3BvbnNlZGF0YSA9IGh0dHBSZXNwb25zZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVzcG9uc2VkYXRhO1xuICAgIH1cblxuICAgIHBsb3REM0NoYXJ0KCkge1xuXG4gICAgICAgIHRoaXMuZm9ybUxlZ2VuZERhdGEoKTtcbiAgICAgICAgaWYodGhpcy5yZXNpemVmbGFnPT1mYWxzZSlcbiAgICAgICAge1xuICAgICAgICBpZiAodGhpcy5jaGFydElkKSB7XG4gICAgICAgICAgICB0aGlzLnN2Z3dpZHRoID0gdGhpcy5jaGFydElkLm5hdGl2ZUVsZW1lbnQub2Zmc2V0V2lkdGg7XG4gICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgIHRoaXMuc3Znd2lkdGggPSB0aGlzLnN2Z3dpZHRoO1xuICAgICAgICB9XG4gICAgfSAgXG4gICAgICAgIGxldCBsaW5lTmFtZTogYW55ID0gdGhpcy5saW5lSW5wdXQ7XG5cbiAgICAgICAgY29uc3QgdG9vbHRpcCA9IHRoaXMudG9vbFRpcChkMyk7XG4gICAgICAgIHRoaXMuc3ZnID0gZDMuc2VsZWN0KFwiI1wiICsgdGhpcy5jb21wb25lbnRJZCk7XG4gICAgICAgIGNvbnN0IG1hcmdpbiA9IHsgdG9wOiAyMCwgcmlnaHQ6IDIwLCBib3R0b206IDg1LCBsZWZ0OiA2MCB9O1xuICAgICAgICBjb25zdCB3aWR0aCA9IHRoaXMuc3Znd2lkdGggLSBtYXJnaW4ubGVmdCAtIG1hcmdpbi5yaWdodDtcbiAgICAgICAgbGV0IGhlaWdodDtcbiAgICAgXG5cbiAgICAgICAgY29uc29sZS5sb2coXCJvZmZzZXRoZWlnaHRcIix0aGlzLm9mZnNldGhlaWdodCk7XG4gICAgICAgIGlmKHRoaXMuZGV2aWNlLklzRGVza3RvcCgpPT10cnVlKVxuICAgICAgICB7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHRoaXMub2Zmc2V0aGVpZ2h0ID0gdGhpcy5jaGFydElkLm5hdGl2ZUVsZW1lbnQub2Zmc2V0SGVpZ2h0LTIwLTkwO1xuICAgICAgICAgICAgICAgaGVpZ2h0ID0gIHRoaXMub2Zmc2V0aGVpZ2h0O1xuICAgICAgICB9XG4gICAgICAgIGVsc2V7XG4gICAgICAgICAgICAgICAgIGhlaWdodD10aGlzLnN2Z2hlaWdodC1tYXJnaW4udG9wLW1hcmdpbi5ib3R0b207XG4gICAgICAgICAgfVxuICAgICAgICBsZXQgeCwgeTtcbiAgICAgICAgY29uc3QgZyA9IHRoaXMuc3ZnLmFwcGVuZChcImdcIilcbiAgICAgICAgICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIFwidHJhbnNsYXRlKFwiICsgbWFyZ2luLmxlZnQgKyBcIixcIiArIG1hcmdpbi50b3AgKyBcIilcIik7XG4gICAgICAgIGlmICh0aGlzLmhvcml6b250YWwgPT0gZmFsc2UpIHtcbiAgICAgICAgICAgIHggPSBkMy5zY2FsZUJhbmQoKVxuICAgICAgICAgICAgICAgIC5yYW5nZVJvdW5kKFswLCB3aWR0aF0pXG4gICAgICAgICAgICAgICAgLnBhZGRpbmcoMC4xKTtcbiAgICAgICAgICAgIHkgPSBkMy5zY2FsZUxpbmVhcigpXG4gICAgICAgICAgICAgICAgLnJhbmdlUm91bmQoW2hlaWdodCwgMF0pO1xuXG4gICAgICAgICAgICAvL3NldHRpbmcgY29udGVudCBmb3IgeCBhbmQgeSBheGlzXG4gICAgICAgICAgICB4LmRvbWFpbih0aGlzLmRhdGEubWFwKChkKSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRbT2JqZWN0LmtleXMoZClbMF1dO1xuICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgbGV0IGJhclJhbmdlID0gZDMubWF4KHRoaXMuZGF0YSwgKGQpID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZFtPYmplY3Qua2V5cyhkKVsxXV07XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgbGV0IGxpbmVSYW5nZSA9IGQzLm1heCh0aGlzLmRhdGEsIChkKSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRbdGhpcy5saW5lSW5wdXRdO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIGxldCByYW5nZTtcbiAgICAgICAgICAgIGlmIChiYXJSYW5nZSA+IGxpbmVSYW5nZSkge1xuICAgICAgICAgICAgICAgIHJhbmdlID0gYmFyUmFuZ2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICByYW5nZSA9IGxpbmVSYW5nZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHkuZG9tYWluKFswLCByYW5nZV0pO1xuXG5cbiAgICAgICAgICAgIGlmKHRoaXMuZGV2aWNlLklzRGVza3RvcCgpPT10cnVlKVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBnLmFwcGVuZChcImdcIilcbiAgICAgICAgICAgICAgICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIFwidHJhbnNsYXRlKDAsXCIgKyBoZWlnaHQgKyBcIilcIilcbiAgICAgICAgICAgICAgICAgIC5jYWxsKGQzLmF4aXNCb3R0b20oeCkpXG4gICAgICAgICAgICB9XG4gICAgICAgICAgZWxzZVxuICAgICAgICAgICB7XG4gICAgICAgICAgICBnLmFwcGVuZChcImdcIilcbiAgICAgICAgICAgICAgICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIFwidHJhbnNsYXRlKDAsXCIgKyBoZWlnaHQgKyBcIilcIilcbiAgICAgICAgICAgICAgICAgIC5jYWxsKGQzLmF4aXNCb3R0b20oeCkpLlxuICAgICAgICAgICAgICAgICAgIHNlbGVjdEFsbChcInRleHRcIilcbiAgICAgICAgICAgICAgICAgICAuYXR0cihcInlcIiwgMClcbiAgICAgICAgICAgICAgICAgICAuYXR0cihcInhcIiwgOSlcbiAgICAgICAgICAgICAgICAgICAuYXR0cihcImR5XCIsIFwiLjM1ZW1cIilcbiAgICAgICAgICAgICAgICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBcInJvdGF0ZSg2NSlcIilcbiAgICAgICAgICAgICAgICAgICAuc3R5bGUoXCJ0ZXh0LWFuY2hvclwiLCBcInN0YXJ0XCIpO1xuICAgICBcbiAgICAgICAgICB9XG4gICAgICAgICAgICAvL2FkZCB5IGF4aXMgdG8gc3ZnXG4gICAgICAgICAgICBnLmFwcGVuZChcImdcIilcbiAgICAgICAgICAgICAgICAuY2FsbChkMy5heGlzTGVmdCh5KVxuICAgICAgICAgICAgICAgICAgICAudGlja3MoMTApKVxuXG4gICAgICAgICAgIHRoaXMucGxvdExpbmUoZyx4LHksaGVpZ2h0LHdpZHRoKTsgXG4gICAgICAgICAgIFxuICAgICAgICAgICAgLy9hZGQgYmFyIGNoYXJ0XG4gICAgICAgICAgICBnLnNlbGVjdEFsbChcIi5iYXJcIilcbiAgICAgICAgICAgICAgICAuZGF0YSh0aGlzLmRhdGEpXG4gICAgICAgICAgICAgICAgLmVudGVyKClcbiAgICAgICAgICAgICAgICAuYXBwZW5kKFwicmVjdFwiKVxuICAgICAgICAgICAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJiYXJcIilcbiAgICAgICAgICAgICAgICAuYXR0cihcInhcIiwgKGQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHgoZFtPYmplY3Qua2V5cyhkKVswXV0pO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmF0dHIoXCJ5XCIsIChkKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB5KGRbT2JqZWN0LmtleXMoZClbMV1dKTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5hdHRyKFwiY3Vyc29yXCIsIFwicG9pbnRlclwiKVxuICAgICAgICAgICAgICAgIC5hdHRyKFwid2lkdGhcIiwgeC5iYW5kd2lkdGgoKSlcbiAgICAgICAgICAgICAgICAuYXR0cihcImhlaWdodFwiLCAoZCkgPT4geyByZXR1cm4gaGVpZ2h0IC0geShkW09iamVjdC5rZXlzKGQpWzFdXSk7IH0pXG4gICAgICAgICAgICAgICAgLnN0eWxlKFwiZmlsbFwiLCAoZCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZC5jb2xvcjtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5vbihcIm1vdXNlb3ZlclwiLCAoZCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdG9vbHRpcC5zdHlsZShcInZpc2liaWxpdHlcIiwgXCJ2aXNpYmxlXCIpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLm9uKFwibW91c2Vtb3ZlXCIsIChkKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0b29sdGlwLmh0bWwoXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZvcm1Ub29sdGlwRGF0YShkKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIC5zdHlsZShcInRvcFwiLCAoZDMuZXZlbnQucGFnZVkgLSAxMCkgKyBcInB4XCIpXG4gICAgICAgICAgICAgICAgICAgICAgICAuc3R5bGUoXCJsZWZ0XCIsIChkMy5ldmVudC5wYWdlWCArIDEwKSArIFwicHhcIik7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAub24oXCJtb3VzZW91dFwiLCAoZCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdG9vbHRpcC5zdHlsZShcInZpc2liaWxpdHlcIiwgXCJoaWRkZW5cIik7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAub24oXCJjbGlja1wiLCAoZCkgPT4ge1xuXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYmFyQ2hhcnRDbGljayhkKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5mb3JkcmlsbGFibGVDbGljayh0aGlzLCBkLGV2ZW50KTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRvb2x0aXAuc3R5bGUoXCJ2aXNpYmlsaXR5XCIsIFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgLy9saW5lIGNvZGUgc3RhcnRcbiAgICAgICAgICAgIGxldCB2YWx1ZWxpbmUgPSBkMy5saW5lKClcbiAgICAgICAgICAgICAgICAueChmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4geChcbiAgICAgICAgICAgICAgICAgICAgICAgIGRbT2JqZWN0LmtleXMoZClbMF1dXG4gICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAueShmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4geShcbiAgICAgICAgICAgICAgICAgICAgICAgIGRbbGluZU5hbWVdXG4gICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGxldCBzaGlmdCA9IG1hcmdpbi5sZWZ0ICsgeC5iYW5kd2lkdGgoKSAvIDI7XG4gICAgICAgICAgICB0aGlzLnN2Zy5hcHBlbmQoXCJwYXRoXCIpXG4gICAgICAgICAgICAgICAgLmRhdGEoW3RoaXMuZGF0YV0pXG4gICAgICAgICAgICAgICAgLmF0dHIoXCJmaWxsXCIsIFwibm9uZVwiKVxuICAgICAgICAgICAgICAgIC5zdHlsZShcInN0cm9rZVwiLCB0aGlzLmxpbmVDb2xvcilcbiAgICAgICAgICAgICAgICAuYXR0cihcInN0cm9rZS13aWR0aFwiLCAxLjUpXG4gICAgICAgICAgICAgICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgXCJ0cmFuc2xhdGUoIFwiICsgc2hpZnQgKyBcIiwgMjAgKVwiKVxuICAgICAgICAgICAgICAgIC5hdHRyKFwiZFwiLCB2YWx1ZWxpbmUpO1xuICAgICAgICAgICAgbGV0IHBvaW50czEgPSB0aGlzLnN2Zy5zZWxlY3RBbGwoXCJjaXJjbGUucG9pbnQxXCIpXG4gICAgICAgICAgICAgICAgLmRhdGEodGhpcy5kYXRhKVxuXG4gICAgICAgICAgICBwb2ludHMxLmVudGVyKCkuYXBwZW5kKFwiY2lyY2xlXCIpXG4gICAgICAgICAgICAgICAgLm1lcmdlKHBvaW50czEpXG4gICAgICAgICAgICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcInBvaW50MVwiKVxuICAgICAgICAgICAgICAgIC5hdHRyKFwiY3Vyc29yXCIsIFwicG9pbnRlclwiKVxuICAgICAgICAgICAgICAgIC5zdHlsZShcInN0cm9rZVwiLCB0aGlzLmxpbmVDb2xvcilcbiAgICAgICAgICAgICAgICAuc3R5bGUoXCJmaWxsXCIsIHRoaXMubGluZUNvbG9yKVxuICAgICAgICAgICAgICAgIC5hdHRyKFwiY3hcIiwgKGQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHgoXG4gICAgICAgICAgICAgICAgICAgICAgICBkW09iamVjdC5rZXlzKGQpWzBdXVxuICAgICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmF0dHIoXCJjeVwiLCAoZCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4geShcbiAgICAgICAgICAgICAgICAgICAgICAgIGRbbGluZU5hbWVdXG4gICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuYXR0cihcInJcIiwgKGQpID0+IHsgcmV0dXJuIDU7IH0pXG4gICAgICAgICAgICAgICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgXCJ0cmFuc2xhdGUoIFwiICsgc2hpZnQgKyBcIiwgMjAgKVwiKVxuICAgICAgICAgICAgICAgIC5vbihcIm1vdXNlb3ZlclwiLCAoZCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdG9vbHRpcC5zdHlsZShcInZpc2liaWxpdHlcIiwgXCJ2aXNpYmxlXCIpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLm9uKFwibW91c2Vtb3ZlXCIsIChkKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0b29sdGlwLmh0bWwoXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZvcm1Ub29sdGlwTGluZURhdGEoZCkpXG4gICAgICAgICAgICAgICAgICAgICAgICAuc3R5bGUoXCJ0b3BcIiwgKGQzLmV2ZW50LnBhZ2VZIC0gMTApICsgXCJweFwiKVxuICAgICAgICAgICAgICAgICAgICAgICAgLnN0eWxlKFwibGVmdFwiLCAoZDMuZXZlbnQucGFnZVggKyAxMCkgKyBcInB4XCIpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLm9uKFwibW91c2VvdXRcIiwgKGQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRvb2x0aXAuc3R5bGUoXCJ2aXNpYmlsaXR5XCIsIFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLm9uKFwiY2xpY2tcIiwgKGQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5vbkNvbWJvTGluZUNsaWNrKGQpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmZvcmRyaWxsYWJsZUNsaWNrKHRoaXMsIGQsZXZlbnQpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdG9vbHRpcC5zdHlsZShcInZpc2liaWxpdHlcIiwgXCJoaWRkZW5cIik7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAvL2xpbmUgY29kZSBlbmRzXG4gICAgICAgIH1cblxuXG4gICAgfVxuXG4gICAgcGxvdExpbmUoZyx4LHksaGVpZ2h0LHdpZHRoKVxue1xuXG4gICAgaWYodGhpcy5oU2NhbGUpe1xuICAgICAgICBnLmFwcGVuZCgnZycpXG4gICAgICAgICAgICAuYXR0cihcImNvbG9yXCIsIFwibGlnaHRncmV5XCIpXG4gICAgICAgICAgICAuY2FsbChkMy5heGlzTGVmdCh5KVxuICAgICAgICAgICAgLiB0aWNrU2l6ZSgtd2lkdGgpLnRpY2tGb3JtYXQoJycpKTsgICAgIFxuICAgIH1cbn1cbiAgICBmb3JtVG9vbHRpcERhdGEodG9vbHRpcERhdGE6IGFueSkge1xuICAgICAgICBsZXQgb2JqZWN0ID0ge307XG4gICAgICAgIGZvciAobGV0IFtrZXksIHZhbHVlXSBvZiBPYmplY3QuZW50cmllcyh0b29sdGlwRGF0YSkpIHtcbiAgICAgICAgICAgIGlmIChrZXkgIT0gJ2NvbG9yJykge1xuICAgICAgICAgICAgICAgIG9iamVjdFtrZXldID0gdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMudG9vbFRpcEZvckJhcihvYmplY3QpO1xuICAgIH1cblxuICAgIHRyYW5zZm9ybURhdGEoZGF0YTogYW55KSB7XG4gICAgICAgIHRoaXMudHJhbnNmb3JtZWRkYXRhPVtdO1xuICAgICAgICB0aGlzLmtleUFycmF5ID0gZGF0YVswXTtcbiAgIFxuICAgICAgICBkYXRhLmZvckVhY2goKGVsZW1lbnQsIGluZGV4KSA9PiB7XG4gICAgICAgICAgICBpZiAoaW5kZXggPiAwKSB7XG4gICAgICAgICAgICAgICAgbGV0IER1bW15T2JqZWN0ID0ge307XG4gICAgICAgICAgICAgICAgZWxlbWVudC5mb3JFYWNoKChpbmRpdmlkdWFsdmFsdWUsIGtleWluZGV4KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIER1bW15T2JqZWN0W3RoaXMua2V5QXJyYXlba2V5aW5kZXhdXSA9IGluZGl2aWR1YWx2YWx1ZTtcbiAgICAgICAgICAgICAgICB9KTsvL2lubmVyIGZvciBsb29wIGVuZHNcbiAgICAgICAgICAgICAgICB0aGlzLnRyYW5zZm9ybWVkZGF0YS5wdXNoKER1bW15T2JqZWN0KTtcbiAgICAgICAgICAgIH0vL2lmIGVuZHNcbiAgICAgICAgfSk7Ly9vdXRlciBmb3IgbG9vcCBlbmRzXG4gICAgICAgIHRoaXMuZGF0YSA9IHRoaXMudHJhbnNmb3JtZWRkYXRhO1xuICAgIH1cblxuICAgIGZvcm1MZWdlbmREYXRhKCkge1xuICAgICAgICB0aGlzLmxlZ2VuZEFycmF5ID0gW107XG4gICAgICAgIHRoaXMuZGF0YS5mb3JFYWNoKGVsZW1lbnQgPT4ge1xuICAgICAgICAgICAgbGV0IGxlZ2VuZG9iamVjdCA9IHt9O1xuICAgICAgICAgICAgbGVnZW5kb2JqZWN0WydsYWJlbCddID0gZWxlbWVudFtPYmplY3Qua2V5cyhlbGVtZW50KVswXV07XG4gICAgICAgICAgICBsZWdlbmRvYmplY3RbJ3ZhbHVlJ10gPSBlbGVtZW50W09iamVjdC5rZXlzKGVsZW1lbnQpWzFdXTtcbiAgICAgICAgICAgIGxlZ2VuZG9iamVjdFsnY29sb3InXSA9IGVsZW1lbnQuY29sb3I7XG4gICAgICAgICAgICB0aGlzLmxlZ2VuZEFycmF5LnB1c2gobGVnZW5kb2JqZWN0KTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgb25CYXJMZWdlbmRDbGljayhsZWdlbmRldmVudDogYW55KSB7XG4gICAgICAgIGxldCBvYmogPSB7fTtcbiAgICAgICAgb2JqW3RoaXMua2V5QXJyYXlbMF1dID0gbGVnZW5kZXZlbnQubGFiZWw7XG4gICAgICAgIG9ialt0aGlzLmtleUFycmF5WzFdXSA9IGxlZ2VuZGV2ZW50LnZhbHVlO1xuICAgICAgICB0aGlzLmxlZ2VuZENsaWNrKG9iaik7XG4gICAgfVxuXG5cbiAgICBiYXJDaGFydENsaWNrKGV2ZW50OiBhbnkpIHtcbiAgICAgICAgbGV0IG9iamVjdCA9IHt9O1xuICAgICAgICBmb3IgKGxldCBba2V5LCB2YWx1ZV0gb2YgT2JqZWN0LmVudHJpZXMoZXZlbnQpKSB7XG4gICAgICAgICAgICBpZiAoa2V5ICE9ICdjb2xvcicpIHtcbiAgICAgICAgICAgICAgICBvYmplY3Rba2V5XSA9IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMuY2hhcnRDbGljayhvYmplY3QpO1xuICAgIH1cblxuICAgIG9uQ29tYm9MaW5lQ2xpY2soZGF0YTogYW55KSB7XG4gICAgICAgIGxldCBvYmplY3QgPSB7fTtcbiAgICAgICAgZm9yIChsZXQgW2tleSwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKGRhdGEpKSB7XG4gICAgICAgICAgICBpZiAoa2V5ICE9IFwiY29sb3JcIikge1xuICAgICAgICAgICAgICAgIG9iamVjdFtrZXldID0gdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5jb21ib0xpbmVDbGljayhvYmplY3QpO1xuICAgICAgICAvL3RoaXMuY2hhcnRDbGljayhvYmplY3QpO1xuICAgIH1cblxuICAgIGZvcm1Ub29sdGlwTGluZURhdGEoZGF0YTogYW55KSB7XG4gICAgICAgIGxldCBvYmplY3QgPSB7fTtcbiAgICAgICAgZm9yIChsZXQgW2tleSwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKGRhdGEpKSB7XG4gICAgICAgICAgICBpZiAoa2V5ID09IHRoaXMubGluZUlucHV0KSB7XG4gICAgICAgICAgICAgICAgb2JqZWN0W2tleV0gPSB2YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy50b29sVGlwRm9yQmFyKG9iamVjdCk7XG4gICAgfVxuXG4gICAgcmVzaXplKCkge1xuXG4gICAgICAgIHRoaXMuc3Znd2lkdGggPSAwO1xuICAgICAgdGhpcy5zdmcuc2VsZWN0QWxsKFwiKlwiKS5yZW1vdmUoKTtcblxuICAgICB0aGlzLnJlc2l6ZWZsYWcgPSB0cnVlO1xuICAgICB0aGlzLnN2Z3dpZHRoID0gdGhpcy5kaXZpZC5uYXRpdmVFbGVtZW50Lm9mZnNldFdpZHRoO1xuICAgLy8gIHRoaXMuc3ZnaGVpZ2h0PXRoaXMub2Zmc2V0aGVpZ2h0O1xuICAgICB0aGlzLnBsb3REM0NoYXJ0KCk7XG5cbiAgICB9XG5cblxufVxuIl19