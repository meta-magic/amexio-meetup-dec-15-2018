/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Input } from "@angular/core";
import * as d3 from 'd3';
import { AmexioD3BaseChartComponent } from "../base/base.component";
var AmexioD3BaseLineComponent = /** @class */ (function (_super) {
    tslib_1.__extends(AmexioD3BaseLineComponent, _super);
    function AmexioD3BaseLineComponent(deviceQueryService) {
        var _this = _super.call(this, 'line') || this;
        _this.deviceQueryService = deviceQueryService;
        _this.svgheight = 300;
        _this.hScale = true;
        _this.vScale = false;
        return _this;
    }
    Object.defineProperty(AmexioD3BaseLineComponent.prototype, "data", {
        get: /**
         * @return {?}
         */
        function () {
            return this._data;
        },
        set: /**
         * @param {?} v
         * @return {?}
         */
        function (v) {
            this._data = v;
            this.createXYAxisData();
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    AmexioD3BaseLineComponent.prototype.createXYAxisData = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.xaxisdata = [];
        this.yaxisdata = [];
        this.multiseriesdata = [];
        this.legenddata = [];
        this.legends = [];
        this.xaxisname = this.data[0][0].label;
        /** @type {?} */
        var msdarray = [];
        for (var index = 0; index < this._data[0].length; index++) {
            /** @type {?} */
            var legend = this._data[0][index];
            msdarray[index] = [];
            this.legenddata.push({ 'label': legend.label, 'color': this.predefinedcolors[index + 1] });
            if (index > 0)
                this.legends.push({ 'label': legend.label, 'color': this.predefinedcolors[index] });
        }
        /** @type {?} */
        var i = 0;
        this._data.forEach(function (object) {
            if (i > 0) {
                /** @type {?} */
                var j_1 = 0;
                object.forEach(function (a) {
                    if (j_1 === 0) {
                        _this.xaxisdata.push({ 'label': a, 'value': a });
                    }
                    else {
                        _this.yaxisdata.push({ 'label': a, 'value': a });
                    }
                    msdarray[j_1].push(a);
                    j_1++;
                });
            }
            i++;
        });
        for (var index = 0; index < msdarray.length; index++) {
            /** @type {?} */
            var element = msdarray[index];
            if (index > 0) {
                /** @type {?} */
                var md = [];
                for (var j = 0; j < element.length; j++) {
                    /** @type {?} */
                    var v = element[j];
                    md.push({ 'legend': this.legenddata[index].label, 'label': this.xaxisdata[j].value, 'value': v });
                }
                this.multiseriesdata.push(md);
                this.legends[index - 1].data = md;
            }
        }
    };
    /**
     * @return {?}
     */
    AmexioD3BaseLineComponent.prototype.initChart = /**
     * @return {?}
     */
    function () {
        this.svg = d3.select("#" + this.componentId);
        /** @type {?} */
        var margin = { top: 40, right: 20, bottom: 30, left: 40 };
        /** @type {?} */
        var width = +this.svgwidth - margin.left - margin.right;
        /** @type {?} */
        var height = +this.svgheight - margin.top - margin.bottom;
        /** @type {?} */
        var g = this.svg.append("g").attr("transform", "translate(" + margin.left + "," + margin.top + ")");
        /** @type {?} */
        var x = d3.scaleBand()
            .rangeRound([0, width])
            .padding(0.1);
        /** @type {?} */
        var y = d3.scaleLinear()
            .rangeRound([height, 0]);
        x.domain(this.xaxisdata.map(function (d) { return d.label; }));
        y.domain([0, d3.max(this.yaxisdata, function (d) { return d.value; })]);
        //add axis 
        if (this.deviceQueryService.IsDesktop() == true) {
            g.append("g")
                .attr("transform", "translate(0," + height + ")")
                .attr("color", "grey")
                .call(d3.axisBottom(x));
        }
        else {
            g.append("g")
                .attr("transform", "translate(0," + height + ")")
                .attr("color", "grey")
                .call(d3.axisBottom(x)).
                selectAll("text")
                .attr("y", 0)
                .attr("x", 9)
                .attr("dy", ".35em")
                .attr("transform", "rotate(60)")
                .style("text-anchor", "start");
        }
        g.append("g")
            .attr("color", "grey")
            .call(d3.axisLeft(y));
        return {
            g: g, x: x, y: y, height: height, width: width
        };
    };
    /**
     * @param {?} g
     * @param {?} x
     * @param {?} y
     * @param {?} height
     * @param {?} width
     * @return {?}
     */
    AmexioD3BaseLineComponent.prototype.plotScale = /**
     * @param {?} g
     * @param {?} x
     * @param {?} y
     * @param {?} height
     * @param {?} width
     * @return {?}
     */
    function (g, x, y, height, width) {
        if (this.vScale) {
            g.append('g')
                .attr("color", "lightgrey")
                .attr('transform', 'translate(0,' + height + ')')
                .call(d3.axisBottom(x).
                tickSize(-this.width).tickFormat(''));
        }
        if (this.hScale) {
            g.append('g')
                .attr("color", "lightgrey")
                .call(d3.axisLeft(y)
                .tickSize(-width).tickFormat(''));
        }
    };
    /**
     * @param {?} node
     * @return {?}
     */
    AmexioD3BaseLineComponent.prototype.legendClick = /**
     * @param {?} node
     * @return {?}
     */
    function (node) {
        // const legendNode = JSON.parse(JSON.stringify(node));
        // delete legendNode.color;
        // legendNode.data.forEach(element => {
        //     delete element.legend;
        // });
        var _this = this;
        // const legendNode = JSON.parse(JSON.stringify(node));
        // delete legendNode.color;
        // legendNode.data.forEach(element => {
        //     delete element.legend;
        // });
        /** @type {?} */
        var obj = {};
        obj["label"] = node.label;
        /** @type {?} */
        var data = [];
        node.data.forEach(function (element) {
            /** @type {?} */
            var object = {};
            object[element.legend] = element.value;
            object[_this.xaxisname] = element.label;
            //   object[element.label] = element.value;
            data.push(object);
        });
        obj["data"] = data;
        this.onLegendClick.emit(obj);
        // this.onLegendClick.emit(legendNode);
    };
    AmexioD3BaseLineComponent.propDecorators = {
        hScale: [{ type: Input, args: ['horizontal-scale',] }],
        vScale: [{ type: Input, args: ['vertical-scale',] }],
        httpurl: [{ type: Input, args: ['data',] }, { type: Input, args: ['http-url',] }],
        httpmethod: [{ type: Input, args: ['http-method',] }]
    };
    return AmexioD3BaseLineComponent;
}(AmexioD3BaseChartComponent));
export { AmexioD3BaseLineComponent };
if (false) {
    /** @type {?} */
    AmexioD3BaseLineComponent.prototype.svgwidth;
    /** @type {?} */
    AmexioD3BaseLineComponent.prototype.svgheight;
    /** @type {?} */
    AmexioD3BaseLineComponent.prototype._data;
    /** @type {?} */
    AmexioD3BaseLineComponent.prototype.xaxisdata;
    /** @type {?} */
    AmexioD3BaseLineComponent.prototype.yaxisdata;
    /** @type {?} */
    AmexioD3BaseLineComponent.prototype.legenddata;
    /** @type {?} */
    AmexioD3BaseLineComponent.prototype.legends;
    /** @type {?} */
    AmexioD3BaseLineComponent.prototype.xaxisname;
    /** @type {?} */
    AmexioD3BaseLineComponent.prototype.multiseriesdata;
    /** @type {?} */
    AmexioD3BaseLineComponent.prototype.svg;
    /** @type {?} */
    AmexioD3BaseLineComponent.prototype.hScale;
    /** @type {?} */
    AmexioD3BaseLineComponent.prototype.vScale;
    /** @type {?} */
    AmexioD3BaseLineComponent.prototype.httpurl;
    /** @type {?} */
    AmexioD3BaseLineComponent.prototype.httpmethod;
    /** @type {?} */
    AmexioD3BaseLineComponent.prototype.deviceQueryService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmFzZWxpbmUuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vYW1leGlvLWNoYXJ0LWQzLyIsInNvdXJjZXMiOlsibGliL2xpbmUvYmFzZWxpbmUuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUN0QyxPQUFPLEtBQUssRUFBRSxNQUFNLElBQUksQ0FBQztBQUN6QixPQUFPLEVBQUUsMEJBQTBCLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUdwRTtJQUErQyxxREFBMEI7SUF1QnJFLG1DQUFtQixrQkFBc0M7UUFBekQsWUFDSSxrQkFBTSxNQUFNLENBQUMsU0FDaEI7UUFGa0Isd0JBQWtCLEdBQWxCLGtCQUFrQixDQUFvQjtRQXBCekQsZUFBUyxHQUFDLEdBQUcsQ0FBQztRQVVhLFlBQU0sR0FBYSxJQUFJLENBQUM7UUFFeEIsWUFBTSxHQUFhLEtBQUssQ0FBQzs7SUFVcEQsQ0FBQztJQUdELHNCQUFJLDJDQUFJOzs7O1FBS1I7WUFDSSxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQztRQUN0QixDQUFDOzs7OztRQVBELFVBQVMsQ0FBSztZQUNWLElBQUksQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDO1lBQ2YsSUFBSSxDQUFDLGdCQUFnQixFQUFFLENBQUM7UUFDNUIsQ0FBQzs7O09BQUE7Ozs7SUFPUyxvREFBZ0I7OztJQUExQjtRQUFBLGlCQThDQztRQTVDRyxJQUFJLENBQUMsU0FBUyxHQUFHLEVBQUUsQ0FBQztRQUNwQixJQUFJLENBQUMsU0FBUyxHQUFHLEVBQUUsQ0FBQztRQUNwQixJQUFJLENBQUMsZUFBZSxHQUFHLEVBQUUsQ0FBQztRQUMxQixJQUFJLENBQUMsVUFBVSxHQUFHLEVBQUUsQ0FBQztRQUNyQixJQUFJLENBQUMsT0FBTyxHQUFHLEVBQUUsQ0FBQztRQUNsQixJQUFJLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQyxJQUFJ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cEQsNENBRWdDOztJQUVoQywrQ0FBc0M7O0lBRTFCLHVEQUE2QyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IElucHV0IH0gZnJvbSBcIkBhbmd1bGFyL2NvcmVcIjtcbmltcG9ydCAqIGFzIGQzIGZyb20gJ2QzJztcbmltcG9ydCB7IEFtZXhpb0QzQmFzZUNoYXJ0Q29tcG9uZW50IH0gZnJvbSBcIi4uL2Jhc2UvYmFzZS5jb21wb25lbnRcIjtcbmltcG9ydHtEZXZpY2VRdWVyeVNlcnZpY2V9IGZyb20gJy4uL3NlcnZpY2VzL2RldmljZS5xdWVyeS5zZXJ2aWNlJztcblxuZXhwb3J0IGNsYXNzIEFtZXhpb0QzQmFzZUxpbmVDb21wb25lbnQgZXh0ZW5kcyBBbWV4aW9EM0Jhc2VDaGFydENvbXBvbmVudFxue1xuICAgIHN2Z3dpZHRoIDogYW55O1xuICAgIHN2Z2hlaWdodD0zMDA7XG4gICAgcHJpdmF0ZSBfZGF0YSAgICAgIDogYW55O1xuICAgIHByaXZhdGUgeGF4aXNkYXRhICA6IGFueVtdO1xuICAgIHByaXZhdGUgeWF4aXNkYXRhICA6IGFueVtdO1xuICAgIHByaXZhdGUgbGVnZW5kZGF0YSA6IGFueVtdO1xuICAgIGxlZ2VuZHMgICAgOiBhbnlbXTtcbiAgICBwcm90ZWN0ZWQgeGF4aXNuYW1lIDogYW55O1xuICAgIHByb3RlY3RlZCBtdWx0aXNlcmllc2RhdGEgOiBhbnlbXTtcbiAgICBzdmc6YW55O1xuXG4gICAgQElucHV0KCdob3Jpem9udGFsLXNjYWxlJykgaFNjYWxlIDogYm9vbGVhbiA9IHRydWU7XG5cbiAgICBASW5wdXQoJ3ZlcnRpY2FsLXNjYWxlJykgICB2U2NhbGUgOiBib29sZWFuID0gZmFsc2U7XG5cbiAgICBASW5wdXQoJ2RhdGEnKSBcblxuICAgIEBJbnB1dCgnaHR0cC11cmwnKSBodHRwdXJsOiBhbnk7XG4gICAgXG4gICAgQElucHV0KCdodHRwLW1ldGhvZCcpIGh0dHBtZXRob2Q6IGFueTtcblxuICAgIGNvbnN0cnVjdG9yKHB1YmxpYyBkZXZpY2VRdWVyeVNlcnZpY2U6IERldmljZVF1ZXJ5U2VydmljZSkge1xuICAgICAgICBzdXBlcignbGluZScpO1xuICAgIH1cblxuXG4gICAgc2V0IGRhdGEodjphbnkpe1xuICAgICAgICB0aGlzLl9kYXRhID0gdjtcbiAgICAgICAgdGhpcy5jcmVhdGVYWUF4aXNEYXRhKCk7XG4gICAgfVxuXG4gICAgZ2V0IGRhdGEoKXtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2RhdGE7XG4gICAgfVxuXG5cbiAgICBwcm90ZWN0ZWQgY3JlYXRlWFlBeGlzRGF0YSgpIDogdm9pZCB7XG5cbiAgICAgICAgdGhpcy54YXhpc2RhdGEgPSBbXTtcbiAgICAgICAgdGhpcy55YXhpc2RhdGEgPSBbXTtcbiAgICAgICAgdGhpcy5tdWx0aXNlcmllc2RhdGEgPSBbXTtcbiAgICAgICAgdGhpcy5sZWdlbmRkYXRhID0gW107XG4gICAgICAgIHRoaXMubGVnZW5kcyA9IFtdO1xuICAgICAgICB0aGlzLnhheGlzbmFtZSA9IHRoaXMuZGF0YVswXVswXS5sYWJlbDtcbiAgICAgICAgIGNvbnN0IG1zZGFycmF5IDogYW55IFtdID1bXTtcbiAgICAgICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCB0aGlzLl9kYXRhWzBdLmxlbmd0aDsgaW5kZXgrKykge1xuICAgICAgICAgICAgY29uc3QgbGVnZW5kID0gdGhpcy5fZGF0YVswXVtpbmRleF07XG4gICAgICAgICAgICBtc2RhcnJheVtpbmRleF09W107XG4gICAgICAgICAgICB0aGlzLmxlZ2VuZGRhdGEucHVzaCh7J2xhYmVsJzpsZWdlbmQubGFiZWwsJ2NvbG9yJzp0aGlzLnByZWRlZmluZWRjb2xvcnNbaW5kZXgrMV19KTtcbiAgICAgICAgICAgIGlmKGluZGV4ID4gMClcbiAgICAgICAgICAgICAgICB0aGlzLmxlZ2VuZHMucHVzaCh7J2xhYmVsJzpsZWdlbmQubGFiZWwsJ2NvbG9yJzp0aGlzLnByZWRlZmluZWRjb2xvcnNbaW5kZXhdfSk7XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgaSA9IDA7XG4gICAgICAgIHRoaXMuX2RhdGEuZm9yRWFjaChvYmplY3QgPT4ge1xuICAgICAgICAgICAgaWYoaT4wKXtcbiAgICAgICAgICAgICAgICBsZXQgaiA9IDA7XG4gICAgICAgICAgICAgICAgb2JqZWN0LmZvckVhY2goYSA9PntcbiAgICAgICAgICAgICAgICAgICAgIGlmKGo9PT0wKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMueGF4aXNkYXRhLnB1c2goeydsYWJlbCc6YSwgJ3ZhbHVlJzphfSk7XG4gICAgICAgICAgICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy55YXhpc2RhdGEucHVzaCh7J2xhYmVsJzphLCAndmFsdWUnOmF9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBtc2RhcnJheVtqXS5wdXNoKGEpO1xuICAgICAgICAgICAgICAgICAgICBqKys7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpKys7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCBtc2RhcnJheS5sZW5ndGg7IGluZGV4KyspIHtcbiAgICAgICAgICAgIGNvbnN0IGVsZW1lbnQgPSBtc2RhcnJheVtpbmRleF07XG4gICAgICAgICAgICBpZihpbmRleCA+MCl7XG4gICAgICAgICAgICAgICAgbGV0IG1kIDogYW55IFtdID0gW107XG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBlbGVtZW50Lmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHYgPSBlbGVtZW50W2pdO1xuICAgICAgICAgICAgICAgICAgICBtZC5wdXNoKHsnbGVnZW5kJzp0aGlzLmxlZ2VuZGRhdGFbaW5kZXhdLmxhYmVsLCdsYWJlbCc6dGhpcy54YXhpc2RhdGFbal0udmFsdWUsICd2YWx1ZSc6dn0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLm11bHRpc2VyaWVzZGF0YS5wdXNoKG1kKTtcbiAgICAgICAgICAgICAgICB0aGlzLmxlZ2VuZHNbaW5kZXgtMV0uZGF0YSA9IG1kO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIGluaXRDaGFydCgpIDogYW55IHtcblxuICAgICAgICB0aGlzLnN2ZyAgICAgICA9IGQzLnNlbGVjdChcIiNcIit0aGlzLmNvbXBvbmVudElkKTtcbiAgICAgICAgY29uc3QgbWFyZ2luICAgID0geyB0b3A6IDQwLCByaWdodDogMjAsIGJvdHRvbTogMzAsIGxlZnQ6IDQwIH07XG4gICAgICAgIGNvbnN0IHdpZHRoICAgICA9ICt0aGlzLnN2Z3dpZHRoIC0gbWFyZ2luLmxlZnQgLSBtYXJnaW4ucmlnaHQ7XG4gICAgICAgIGNvbnN0IGhlaWdodCAgICA9ICt0aGlzLnN2Z2hlaWdodCAtIG1hcmdpbi50b3AgLSBtYXJnaW4uYm90dG9tO1xuICAgICAgICBjb25zdCBnICAgICAgICAgPSB0aGlzLnN2Zy5hcHBlbmQoXCJnXCIpLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgXCJ0cmFuc2xhdGUoXCIgKyBtYXJnaW4ubGVmdCArIFwiLFwiICsgbWFyZ2luLnRvcCArIFwiKVwiKTtcblxuICAgICAgICBjb25zdCB4ID0gZDMuc2NhbGVCYW5kKClcbiAgICAgICAgICAgICAgICAgICAgLnJhbmdlUm91bmQoWzAsIHdpZHRoXSlcbiAgICAgICAgICAgICAgICAgICAgLnBhZGRpbmcoMC4xKTsgICAgICAgICAgICAgICAgICAgIFxuICAgIFxuICAgICAgICBjb25zdCB5ID0gZDMuc2NhbGVMaW5lYXIoKVxuICAgICAgICAgICAgICAgICAgICAgLnJhbmdlUm91bmQoW2hlaWdodCwgMF0pO1xuXG4gICAgICAgIHguZG9tYWluKHRoaXMueGF4aXNkYXRhLm1hcCggKGQpID0+IHsgcmV0dXJuIGQubGFiZWw7fSkpO1xuICAgICAgICB5LmRvbWFpbihbMCwgZDMubWF4KHRoaXMueWF4aXNkYXRhLCAgKGQpID0+IHsgcmV0dXJuIGQudmFsdWU7IH0pXSk7XG5cbiAgICAgICAgLy9hZGQgYXhpcyBcbiAgICAgICAgaWYodGhpcy5kZXZpY2VRdWVyeVNlcnZpY2UuSXNEZXNrdG9wKCk9PXRydWUpXG4gICAgICAgIHtcbiAgICAgICAgICBnLmFwcGVuZChcImdcIilcbiAgICAgICAgICAgICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgXCJ0cmFuc2xhdGUoMCxcIiArIGhlaWdodCArIFwiKVwiKVxuICAgICAgICAgICAgICAuYXR0cihcImNvbG9yXCIsIFwiZ3JleVwiKVxuICAgICAgICAgICAgICAuY2FsbChkMy5heGlzQm90dG9tKHgpKVxuICAgICAgICB9XG4gICAgICBlbHNlXG4gICAgICAge1xuICAgICAgICBnLmFwcGVuZChcImdcIilcbiAgICAgICAgICAgICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgXCJ0cmFuc2xhdGUoMCxcIiArIGhlaWdodCArIFwiKVwiKVxuICAgICAgICAgICAgICAuYXR0cihcImNvbG9yXCIsIFwiZ3JleVwiKVxuICAgICAgICAgICAgICAuY2FsbChkMy5heGlzQm90dG9tKHgpKS5cbiAgICAgICAgICAgICAgIHNlbGVjdEFsbChcInRleHRcIilcbiAgICAgICAgICAgICAgIC5hdHRyKFwieVwiLCAwKVxuICAgICAgICAgICAgICAgLmF0dHIoXCJ4XCIsIDkpXG4gICAgICAgICAgICAgICAuYXR0cihcImR5XCIsIFwiLjM1ZW1cIilcbiAgICAgICAgICAgICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIFwicm90YXRlKDYwKVwiKVxuICAgICAgICAgICAgICAgLnN0eWxlKFwidGV4dC1hbmNob3JcIiwgXCJzdGFydFwiKTtcbiAgICAgIH1cbiAgICAgXG4gICAgICAgIGcuYXBwZW5kKFwiZ1wiKVxuICAgICAgICAgICAgLmF0dHIoXCJjb2xvclwiLCBcImdyZXlcIilcbiAgICAgICAgICAgIC5jYWxsKGQzLmF4aXNMZWZ0KHkpKTtcblxuXG4gICAgICAgIHJldHVybntcbiAgICAgICAgICAgICBnLCB4LCB5LCBoZWlnaHQsIHdpZHRoXG4gICAgICAgIH1cblxuICAgIH0gICAgXG5cblxuICAgIHByb3RlY3RlZCBwbG90U2NhbGUoZzphbnkseDphbnksIHk6YW55LGhlaWdodDphbnksd2lkdGg6YW55KSA6IHZvaWQgXG4gICAge1xuICAgICAgICBpZih0aGlzLnZTY2FsZSl7XG4gICAgICAgICAgICBnLmFwcGVuZCgnZycpXG4gICAgICAgICAgICAgICAgLmF0dHIoXCJjb2xvclwiLCBcImxpZ2h0Z3JleVwiKVxuICAgICAgICAgICAgICAgIC5hdHRyKCd0cmFuc2Zvcm0nLCAndHJhbnNsYXRlKDAsJyArIGhlaWdodCArICcpJylcbiAgICAgICAgICAgICAgICAuY2FsbChkMy5heGlzQm90dG9tKHgpLlxuICAgICAgICAgICAgICAgICB0aWNrU2l6ZSgtdGhpcy53aWR0aCkudGlja0Zvcm1hdCgnJylcbiAgICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgaWYodGhpcy5oU2NhbGUpe1xuICAgICAgICAgICAgZy5hcHBlbmQoJ2cnKVxuICAgICAgICAgICAgICAgIC5hdHRyKFwiY29sb3JcIiwgXCJsaWdodGdyZXlcIilcbiAgICAgICAgICAgICAgICAuY2FsbChkMy5heGlzTGVmdCh5KVxuICAgICAgICAgICAgICAgIC4gdGlja1NpemUoLXdpZHRoKS50aWNrRm9ybWF0KCcnKSk7ICAgICBcbiAgICAgICAgfVxuICAgIH1cblxuIFxuICAgIGxlZ2VuZENsaWNrKG5vZGU6YW55KXtcbiBcbiAgICAgICAgLy8gY29uc3QgbGVnZW5kTm9kZSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkobm9kZSkpO1xuICAgICAgICAvLyBkZWxldGUgbGVnZW5kTm9kZS5jb2xvcjtcbiAgICAgICAgLy8gbGVnZW5kTm9kZS5kYXRhLmZvckVhY2goZWxlbWVudCA9PiB7XG4gICAgICAgIC8vICAgICBkZWxldGUgZWxlbWVudC5sZWdlbmQ7XG4gICAgICAgIC8vIH0pO1xuXG4gICAgICAgIGxldCBvYmogPSB7fTtcbiAgICBvYmpbXCJsYWJlbFwiXSA9IG5vZGUubGFiZWw7XG4gICAgbGV0IGRhdGEgPSBbXTtcbiAgICBub2RlLmRhdGEuZm9yRWFjaChlbGVtZW50ID0+IHtcbiAgICAgIGxldCBvYmplY3QgPSB7fTtcbiAgICAgXG4gICAgICBvYmplY3RbZWxlbWVudC5sZWdlbmRdID0gZWxlbWVudC52YWx1ZTtcbiAgICAgIG9iamVjdFt0aGlzLnhheGlzbmFtZV0gPSBlbGVtZW50LmxhYmVsO1xuICAgIC8vICAgb2JqZWN0W2VsZW1lbnQubGFiZWxdID0gZWxlbWVudC52YWx1ZTtcbiAgICAgIGRhdGEucHVzaChvYmplY3QpO1xuICAgIH0pO1xuICAgIG9ialtcImRhdGFcIl0gPSBkYXRhO1xuICAgIHRoaXMub25MZWdlbmRDbGljay5lbWl0KG9iaik7XG4gICAgXG4gICAgICAgIC8vIHRoaXMub25MZWdlbmRDbGljay5lbWl0KGxlZ2VuZE5vZGUpO1xuICAgIH1cbn0iXX0=