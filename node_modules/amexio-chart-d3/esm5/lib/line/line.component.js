/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Component, ViewChild, ElementRef, Input } from "@angular/core";
import * as d3 from 'd3';
import { AmexioD3BaseLineComponent } from "./baseline.component";
import { CommanDataService } from '../services/comman.data.service';
import { DeviceQueryService } from "../services/device.query.service";
var AmexioD3LineComponent = /** @class */ (function (_super) {
    tslib_1.__extends(AmexioD3LineComponent, _super);
    function AmexioD3LineComponent(deviceQueryService, myservice) {
        var _this = _super.call(this, deviceQueryService) || this;
        _this.deviceQueryService = deviceQueryService;
        _this.myservice = myservice;
        _this.level = 0;
        _this.labelflag = false;
        _this.labelcolor = "black";
        _this.drillabledatakey = [];
        _this.drillableFlag = true;
        _this.resizeflag = false;
        return _this;
    }
    /**
     * @return {?}
     */
    AmexioD3LineComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        if (this.level <= 1) {
            /** @type {?} */
            var resp_1;
            if (this.httpmethod && this.httpurl) {
                this.myservice.fetchUrlData(this.httpurl, this.httpmethod).subscribe(function (response) {
                    resp_1 = response;
                }, function (error) {
                }, function () {
                    setTimeout(function () {
                        _this.data = _this.getResponseData(resp_1);
                        _this.plotD3Chart();
                    }, 0);
                });
            }
            else if (this.data) {
                setTimeout(function () {
                    _this.data = _this.getResponseData(_this.data);
                    _this.plotD3Chart();
                }, 0);
            }
        }
    };
    /**
     * @param {?} data
     * @return {?}
     */
    AmexioD3LineComponent.prototype.fetchData = /**
     * @param {?} data
     * @return {?}
     */
    function (data) {
        var _this = this;
        /** @type {?} */
        var requestJson;
        /** @type {?} */
        var key = this.drillabledatakey;
        /** @type {?} */
        var resp;
        if (this.drillabledatakey.length) {
            /** @type {?} */
            var drillabledata = this.getMultipleDrillbleKeyData(data, key);
            requestJson = drillabledata;
        }
        else {
            requestJson = data;
        }
        if (this.httpmethod && this.httpurl) {
            this.myservice.postfetchData(this.httpurl, this.httpmethod, requestJson).subscribe(function (response) {
                resp = response;
            }, function (error) {
            }, function () {
                setTimeout(function () {
                    _this.data = _this.getResponseData(resp);
                    _this.drawChart();
                }, 0);
            });
        }
    };
    /**
     * @return {?}
     */
    AmexioD3LineComponent.prototype.drawChart = /**
     * @return {?}
     */
    function () {
        var _this = this;
        setTimeout(function () {
            _this.plotD3Chart();
        }, 0);
    };
    /**
     * @return {?}
     */
    AmexioD3LineComponent.prototype.resize = /**
     * @return {?}
     */
    function () {
        this.svgwidth = 0;
        this.svg.selectAll("*").remove();
        this.resizeflag = true;
        this.svgwidth = this.divid.nativeElement.offsetWidth;
        this.plotD3Chart();
    };
    /**
     * @param {?} httpResponse
     * @return {?}
     */
    AmexioD3LineComponent.prototype.getResponseData = /**
     * @param {?} httpResponse
     * @return {?}
     */
    function (httpResponse) {
        /** @type {?} */
        var responsedata = httpResponse;
        if (this.datareader != null) {
            /** @type {?} */
            var dr = this.datareader.split('.');
            try {
                for (var dr_1 = tslib_1.__values(dr), dr_1_1 = dr_1.next(); !dr_1_1.done; dr_1_1 = dr_1.next()) {
                    var ir = dr_1_1.value;
                    responsedata = responsedata[ir];
                }
            }
            catch (e_1_1) { e_1 = { error: e_1_1 }; }
            finally {
                try {
                    if (dr_1_1 && !dr_1_1.done && (_a = dr_1.return)) _a.call(dr_1);
                }
                finally { if (e_1) throw e_1.error; }
            }
        }
        else {
            responsedata = httpResponse;
        }
        return responsedata;
        var e_1, _a;
    };
    /**
     * @return {?}
     */
    AmexioD3LineComponent.prototype.plotD3Chart = /**
     * @return {?}
     */
    function () {
        if (this.resizeflag == false) {
            if (this.chartId) {
                this.svgwidth = this.chartId.nativeElement.offsetWidth;
            }
            else {
                this.svgwidth = this.svgwidth;
            }
        }
        /** @type {?} */
        var tooltip = this.toolTip(d3);
        /** @type {?} */
        var linechart = this.initChart();
        this.plotScale(linechart.g, linechart.x, linechart.y, linechart.height, linechart.width);
        this.plotLine(linechart.g, linechart.x, linechart.y, linechart.height, linechart.width, [], tooltip, (1));
        for (var index = 0; index < this.multiseriesdata.length; index++) {
            this.plotLine(linechart.g, linechart.x, linechart.y, linechart.height, linechart.width, this.multiseriesdata[index], tooltip, (index + 1));
        }
    };
    /**
     * @param {?} g
     * @param {?} x
     * @param {?} y
     * @param {?} height
     * @param {?} width
     * @param {?} data
     * @param {?} tooltip
     * @param {?} i
     * @return {?}
     */
    AmexioD3LineComponent.prototype.plotLine = /**
     * @param {?} g
     * @param {?} x
     * @param {?} y
     * @param {?} height
     * @param {?} width
     * @param {?} data
     * @param {?} tooltip
     * @param {?} i
     * @return {?}
     */
    function (g, x, y, height, width, data, tooltip, i) {
        var _this = this;
        /** @type {?} */
        var line = d3.line()
            .x(function (d) { return x(d.label); })
            .y(function (d) { return y(d.value); });
        g.append("path")
            .datum(data)
            .attr("fill", "none")
            .attr("stroke", this.predefinedcolors[i])
            .attr("stroke-width", 1.5)
            .attr("d", line);
        g.selectAll('dot')
            .data(data)
            .enter()
            .append('circle')
            .attr("cx", function (d) { return x(d.label); })
            .attr("cy", function (d) { return y(d.value); })
            .attr('r', 2)
            .attr("cursor", "pointer")
            .on("mouseover", function (d) {
            return tooltip.style("visibility", "visible");
        })
            .on("mousemove", function (d) {
            return tooltip.html(_this.callTooltip(d)
            //  this.toolTipForLine(d)
            //  this.toolTipWithLegendandAxis(d.legend,d.label,d.value)
            )
                .style("top", (d3.event.pageY - 10) + "px")
                .style("left", (d3.event.pageX + 10) + "px");
        })
            .on("mouseout", function (d) {
            return tooltip.style("visibility", "hidden");
        })
            .on("click", function (d) {
            _this.lineChartClick(d);
            _this.fordrillableClick(_this, d, event);
            return tooltip.style("visibility", "hidden");
        });
        //lets plot labels here
        if (this.labelflag) {
            g.selectAll('label')
                .data(data)
                .enter()
                .append('text')
                .style("font-weight", "bold")
                .attr("text-anchor", "middle")
                .attr("fill", function (d) {
                if (_this.labelcolor.length > 0) {
                    return _this.labelcolor;
                }
                else {
                    return "black";
                }
            })
                .attr("x", function (d, i) {
                return x(d.label);
            })
                .attr("y", function (d, i) {
                return y(d.value) - 10;
            })
                .text(function (d) {
                return d.value;
            });
        }
    };
    /**
     * @param {?} d
     * @return {?}
     */
    AmexioD3LineComponent.prototype.lineChartClick = /**
     * @param {?} d
     * @return {?}
     */
    function (d) {
        /** @type {?} */
        var obj = {};
        obj[d.legend] = d.value;
        obj[this.xaxisname] = d.label;
        this.chartClick(obj);
    };
    /**
     * @param {?} tooltipdata
     * @return {?}
     */
    AmexioD3LineComponent.prototype.callTooltip = /**
     * @param {?} tooltipdata
     * @return {?}
     */
    function (tooltipdata) {
        /** @type {?} */
        var obj = {};
        obj[tooltipdata.legend] = tooltipdata.value;
        obj[this.xaxisname] = tooltipdata.label;
        return this.toolTipForBar(obj);
    };
    AmexioD3LineComponent.decorators = [
        { type: Component, args: [{
                    selector: 'amexio-d3-chart-line',
                    template: "\n<div *ngIf=\"drillableFlag\" #divid (window:resize)=\"resize()\"> \n<table style=\"width: 100%;\" #chartId  >\n        <tr><td style=\"font-size: 18px; font-weight: bold; \"> {{title}} </td></tr>\n        <tr>\n            <td>\n                <svg [attr.height]=\"height\" [attr.width]=\"svgwidth\" [attr.id]=\"componentId\">\n                </svg>            \n            </td>\n        </tr>\n        <tr>\n            <td style=\"display: block; padding: 5px;\">\n                    <amexio-d3-legend *ngIf=\"legend\" [horizontal]=\"true\" (onClick)=\"legendClick($event)\" \n                                        [data]=\"legends\" style=\"height:100%;\">\n                    </amexio-d3-legend>\n            </td>\n        \n        </tr>\n</table>\n</div>\n    "
                },] },
    ];
    AmexioD3LineComponent.ctorParameters = function () { return [
        { type: DeviceQueryService },
        { type: CommanDataService }
    ]; };
    AmexioD3LineComponent.propDecorators = {
        chartId: [{ type: ViewChild, args: ['chartId',] }],
        divid: [{ type: ViewChild, args: ['divid',] }],
        drillid: [{ type: ViewChild, args: ['drillid',] }],
        datareader: [{ type: Input, args: ['data-reader',] }],
        level: [{ type: Input, args: ['level',] }],
        labelflag: [{ type: Input, args: ['label',] }],
        labelcolor: [{ type: Input, args: ['label-color',] }],
        target: [{ type: Input, args: ['target',] }],
        drillabledatakey: [{ type: Input, args: ['drillable-data',] }]
    };
    return AmexioD3LineComponent;
}(AmexioD3BaseLineComponent));
export { AmexioD3LineComponent };
if (false) {
    /** @type {?} */
    AmexioD3LineComponent.prototype.chartId;
    /** @type {?} */
    AmexioD3LineComponent.prototype.divid;
    /** @type {?} */
    AmexioD3LineComponent.prototype.drillid;
    /** @type {?} */
    AmexioD3LineComponent.prototype.datareader;
    /** @type {?} */
    AmexioD3LineComponent.prototype.level;
    /** @type {?} */
    AmexioD3LineComponent.prototype.labelflag;
    /** @type {?} */
    AmexioD3LineComponent.prototype.labelcolor;
    /** @type {?} */
    AmexioD3LineComponent.prototype.target;
    /** @type {?} */
    AmexioD3LineComponent.prototype.drillabledatakey;
    /** @type {?} */
    AmexioD3LineComponent.prototype.drillableFlag;
    /** @type {?} */
    AmexioD3LineComponent.prototype.resizeflag;
    /** @type {?} */
    AmexioD3LineComponent.prototype.deviceQueryService;
    /** @type {?} */
    AmexioD3LineComponent.prototype.myservice;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGluZS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9hbWV4aW8tY2hhcnQtZDMvIiwic291cmNlcyI6WyJsaWIvbGluZS9saW5lLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSxLQUFLLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDeEUsT0FBTyxLQUFLLEVBQUUsTUFBTSxJQUFJLENBQUM7QUFDekIsT0FBTyxFQUFFLHlCQUF5QixFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFJakUsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0saUNBQWlDLENBQUM7QUFDcEUsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0sa0NBQWtDLENBQUM7QUFFdEU7SUF3QjJDLGlEQUF5QjtJQWNoRSwrQkFBbUIsa0JBQXNDLEVBQVEsU0FBMkI7UUFBNUYsWUFDTSxrQkFBTSxrQkFBa0IsQ0FBQyxTQUM5QjtRQUZrQix3QkFBa0IsR0FBbEIsa0JBQWtCLENBQW9CO1FBQVEsZUFBUyxHQUFULFNBQVMsQ0FBa0I7UUFSNUUsV0FBSyxHQUFRLENBQUMsQ0FBQztRQUNmLGVBQVMsR0FBWSxLQUFLLENBQUM7UUFDckIsZ0JBQVUsR0FBVyxPQUFPLENBQUM7UUFFMUIsc0JBQWdCLEdBQU8sRUFBRSxDQUFBO1FBQ2xELG1CQUFhLEdBQVcsSUFBSSxDQUFDO1FBQzdCLGdCQUFVLEdBQVMsS0FBSyxDQUFDOztJQUl6QixDQUFDOzs7O0lBRUQsd0NBQVE7OztJQUFSO1FBQUEsaUJBc0JDO1FBcEJHLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLElBQUksQ0FBQyxDQUFDLENBQUEsQ0FBQzs7Z0JBQ2pCLE1BQVM7WUFDYixFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsVUFBVSxJQUFJLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO2dCQUNsQyxJQUFJLENBQUMsU0FB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QUFTOzZCQUNuQixLQUFLLFNBQUMsYUFBYTt3QkFDbkIsS0FBSyxTQUFDLE9BQU87NEJBQ2IsS0FBSyxTQUFDLE9BQU87NkJBQ2IsS0FBSyxTQUFDLGFBQWE7eUJBQ25CLEtBQUssU0FBQyxRQUFRO21DQUNkLEtBQUssU0FBQyxnQkFBZ0I7O0lBNE0zQiw0QkFBQztDQUFBLEFBOU9ELENBd0IyQyx5QkFBeUIsR0FzTm5FO1NBdE5ZLHFCQUFxQjs7O0lBRTlCLHdDQUEwQzs7SUFDMUMsc0NBQXNDOztJQUN0Qyx3Q0FBa0M7O0lBQ2xDLDJDQUF5Qzs7SUFDekMsc0NBQStCOztJQUMvQiwwQ0FBMkM7O0lBQzNDLDJDQUFtRDs7SUFDbkQsdUNBQStCOztJQUMvQixpREFBa0Q7O0lBQ2xELDhDQUE2Qjs7SUFDN0IsMkNBQXlCOztJQUViLG1EQUE2Qzs7SUFBQywwQ0FBa0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIFZpZXdDaGlsZCwgRWxlbWVudFJlZiwgSW5wdXQgfSBmcm9tIFwiQGFuZ3VsYXIvY29yZVwiO1xuaW1wb3J0ICogYXMgZDMgZnJvbSAnZDMnO1xuaW1wb3J0IHsgQW1leGlvRDNCYXNlTGluZUNvbXBvbmVudCB9IGZyb20gXCIuL2Jhc2VsaW5lLmNvbXBvbmVudFwiO1xuaW1wb3J0IHsgQW1leGlvRDNCYXNlQ2hhcnRDb21wb25lbnQgfSBmcm9tIFwiLi4vYmFzZS9iYXNlLmNvbXBvbmVudFwiO1xuaW1wb3J0IHsgUGxvdENhcnQgfSBmcm9tIFwiLi4vYmFzZS9jaGFydC5jb21wb25lbnRcIjtcbmltcG9ydCB7IEh0dHBDbGllbnQsIEh0dHBDbGllbnRNb2R1bGUgfSBmcm9tICdAYW5ndWxhci9jb21tb24vaHR0cCc7XG5pbXBvcnQgeyBDb21tYW5EYXRhU2VydmljZSB9IGZyb20gJy4uL3NlcnZpY2VzL2NvbW1hbi5kYXRhLnNlcnZpY2UnO1xuaW1wb3J0IHsgRGV2aWNlUXVlcnlTZXJ2aWNlIH0gZnJvbSBcIi4uL3NlcnZpY2VzL2RldmljZS5xdWVyeS5zZXJ2aWNlXCI7XG5cbkBDb21wb25lbnQoe1xuICAgIHNlbGVjdG9yOiAnYW1leGlvLWQzLWNoYXJ0LWxpbmUnLFxuICAgIHRlbXBsYXRlOiBgXG48ZGl2ICpuZ0lmPVwiZHJpbGxhYmxlRmxhZ1wiICNkaXZpZCAod2luZG93OnJlc2l6ZSk9XCJyZXNpemUoKVwiPiBcbjx0YWJsZSBzdHlsZT1cIndpZHRoOiAxMDAlO1wiICNjaGFydElkICA+XG4gICAgICAgIDx0cj48dGQgc3R5bGU9XCJmb250LXNpemU6IDE4cHg7IGZvbnQtd2VpZ2h0OiBib2xkOyBcIj4ge3t0aXRsZX19IDwvdGQ+PC90cj5cbiAgICAgICAgPHRyPlxuICAgICAgICAgICAgPHRkPlxuICAgICAgICAgICAgICAgIDxzdmcgW2F0dHIuaGVpZ2h0XT1cImhlaWdodFwiIFthdHRyLndpZHRoXT1cInN2Z3dpZHRoXCIgW2F0dHIuaWRdPVwiY29tcG9uZW50SWRcIj5cbiAgICAgICAgICAgICAgICA8L3N2Zz4gICAgICAgICAgICBcbiAgICAgICAgICAgIDwvdGQ+XG4gICAgICAgIDwvdHI+XG4gICAgICAgIDx0cj5cbiAgICAgICAgICAgIDx0ZCBzdHlsZT1cImRpc3BsYXk6IGJsb2NrOyBwYWRkaW5nOiA1cHg7XCI+XG4gICAgICAgICAgICAgICAgICAgIDxhbWV4aW8tZDMtbGVnZW5kICpuZ0lmPVwibGVnZW5kXCIgW2hvcml6b250YWxdPVwidHJ1ZVwiIChvbkNsaWNrKT1cImxlZ2VuZENsaWNrKCRldmVudClcIiBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbZGF0YV09XCJsZWdlbmRzXCIgc3R5bGU9XCJoZWlnaHQ6MTAwJTtcIj5cbiAgICAgICAgICAgICAgICAgICAgPC9hbWV4aW8tZDMtbGVnZW5kPlxuICAgICAgICAgICAgPC90ZD5cbiAgICAgICAgXG4gICAgICAgIDwvdHI+XG48L3RhYmxlPlxuPC9kaXY+XG4gICAgYFxufSlcbmV4cG9ydCBjbGFzcyBBbWV4aW9EM0xpbmVDb21wb25lbnQgZXh0ZW5kcyBBbWV4aW9EM0Jhc2VMaW5lQ29tcG9uZW50IGltcGxlbWVudHMgUGxvdENhcnQge1xuXG4gICAgQFZpZXdDaGlsZCgnY2hhcnRJZCcpIGNoYXJ0SWQ6IEVsZW1lbnRSZWY7XG4gICAgQFZpZXdDaGlsZCgnZGl2aWQnKSBkaXZpZDogRWxlbWVudFJlZjtcbiAgICBAVmlld0NoaWxkKCdkcmlsbGlkJykgZHJpbGxpZDphbnk7XG4gICAgQElucHV0KCdkYXRhLXJlYWRlcicpIGRhdGFyZWFkZXI6IHN0cmluZztcbiAgICBASW5wdXQoJ2xldmVsJykgbGV2ZWw6bnVtYmVyPTA7XG4gICAgQElucHV0KCdsYWJlbCcpIGxhYmVsZmxhZzogYm9vbGVhbiA9IGZhbHNlO1xuICAgIEBJbnB1dCgnbGFiZWwtY29sb3InKSBsYWJlbGNvbG9yOiBzdHJpbmcgPSBcImJsYWNrXCI7XG4gICAgQElucHV0KCd0YXJnZXQnKSB0YXJnZXQ6bnVtYmVyO1xuICAgIEBJbnB1dCgnZHJpbGxhYmxlLWRhdGEnKSBkcmlsbGFibGVkYXRha2V5OmFueVtdPVtdXG4gICAgZHJpbGxhYmxlRmxhZzpib29sZWFuID0gdHJ1ZTtcbiAgICByZXNpemVmbGFnOmJvb2xlYW49ZmFsc2U7XG4gXG4gICAgY29uc3RydWN0b3IocHVibGljIGRldmljZVF1ZXJ5U2VydmljZTogRGV2aWNlUXVlcnlTZXJ2aWNlLHB1YmxpYyBteXNlcnZpY2U6Q29tbWFuRGF0YVNlcnZpY2UpIHtcbiAgICAgICAgICBzdXBlcihkZXZpY2VRdWVyeVNlcnZpY2UpO1xuICAgIH1cblxuICAgIG5nT25Jbml0KCkge1xuXG4gICAgICAgIGlmICh0aGlzLmxldmVsIDw9IDEpe1xuICAgICAgICBsZXQgcmVzcDogYW55XG4gICAgICAgIGlmICh0aGlzLmh0dHBtZXRob2QgJiYgdGhpcy5odHRwdXJsKSB7XG4gICAgICAgICAgICB0aGlzLm15c2VydmljZS5mZXRjaFVybERhdGEodGhpcy5odHRwdXJsLCB0aGlzLmh0dHBtZXRob2QpLnN1YnNjcmliZSgocmVzcG9uc2UpID0+IHtcbiAgICAgICAgICAgICAgICByZXNwID0gcmVzcG9uc2U7XG4gICAgICAgICAgICB9LCAoZXJyb3IpID0+IHtcbiAgICAgICAgICAgIH0sICgpID0+IHtcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kYXRhID0gdGhpcy5nZXRSZXNwb25zZURhdGEocmVzcCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGxvdEQzQ2hhcnQoKTtcbiAgICAgICAgICAgICAgICB9LCAwKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2VcbiAgICAgICAgICAgIGlmICh0aGlzLmRhdGEpIHtcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kYXRhID0gdGhpcy5nZXRSZXNwb25zZURhdGEodGhpcy5kYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wbG90RDNDaGFydCgpO1xuICAgICAgICAgICAgICAgIH0sIDApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9ICAgICAgXG4gICAgfVxuXG5cbiAgICBmZXRjaERhdGEoZGF0YTogYW55KSB7XG4gICBcbiAgICAgICAgbGV0IHJlcXVlc3RKc29uO1xuICAgICAgICBsZXQga2V5PXRoaXMuZHJpbGxhYmxlZGF0YWtleTtcbiAgICAgICAgbGV0IHJlc3A6IGFueTtcbiAgICAgICAgaWYodGhpcy5kcmlsbGFibGVkYXRha2V5Lmxlbmd0aClcbiAgICAgICAge1xuICAgICAgICAgICAgIGxldCBkcmlsbGFibGVkYXRhPSB0aGlzLmdldE11bHRpcGxlRHJpbGxibGVLZXlEYXRhKGRhdGEsa2V5KTtcbiAgICAgICAgICAgICByZXF1ZXN0SnNvbj1kcmlsbGFibGVkYXRhO1xuICAgICAgICB9XG4gICAgICAgIGVsc2V7XG4gICAgICAgICAgICAgICAgIHJlcXVlc3RKc29uPWRhdGE7XG4gICAgICAgICAgICAgfVxuICAgICAgXG4gICBpZiAodGhpcy5odHRwbWV0aG9kICYmIHRoaXMuaHR0cHVybCkge1xuICAgICB0aGlzLm15c2VydmljZS5wb3N0ZmV0Y2hEYXRhKHRoaXMuaHR0cHVybCx0aGlzLmh0dHBtZXRob2QsIHJlcXVlc3RKc29uKS5zdWJzY3JpYmUoKHJlc3BvbnNlKSA9PiB7XG4gICAgICAgICAgICAgICAgcmVzcCA9IHJlc3BvbnNlO1xuICAgICAgICAgICAgfSwgKGVycm9yKSA9PiB7XG4gICAgICAgICAgICB9LCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGF0YSA9IHRoaXMuZ2V0UmVzcG9uc2VEYXRhKHJlc3ApO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmRyYXdDaGFydCgpOyAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICB9LCAwKTtcbiAgICAgICAgICAgfSk7ICAgIFxuICAgICAgICB9XG4gICAgfVxuICAgIFxuICAgIGRyYXdDaGFydCgpIHtcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgdGhpcy5wbG90RDNDaGFydCgpO1xuICAgICAgfSwgMCk7XG4gICAgfSBcblxuICAgIHJlc2l6ZSgpIHtcblxuICAgIHRoaXMuc3Znd2lkdGggPSAwO1xuICAgIHRoaXMuc3ZnLnNlbGVjdEFsbChcIipcIikucmVtb3ZlKCk7XG5cbiAgICB0aGlzLnJlc2l6ZWZsYWcgPSB0cnVlO1xuICAgIHRoaXMuc3Znd2lkdGggPSB0aGlzLmRpdmlkLm5hdGl2ZUVsZW1lbnQub2Zmc2V0V2lkdGg7XG4gICAgdGhpcy5wbG90RDNDaGFydCgpO1xuICBcblxuICAgIH1cblxuICAgIGdldFJlc3BvbnNlRGF0YShodHRwUmVzcG9uc2U6IGFueSkge1xuICAgICAgICBsZXQgcmVzcG9uc2VkYXRhID0gaHR0cFJlc3BvbnNlO1xuICAgICAgICBpZiAodGhpcy5kYXRhcmVhZGVyICE9IG51bGwpIHtcbiAgICAgICAgICAgIGNvbnN0IGRyID0gdGhpcy5kYXRhcmVhZGVyLnNwbGl0KCcuJyk7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGlyIG9mIGRyKSB7XG4gICAgICAgICAgICAgICAgcmVzcG9uc2VkYXRhID0gcmVzcG9uc2VkYXRhW2lyXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJlc3BvbnNlZGF0YSA9IGh0dHBSZXNwb25zZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVzcG9uc2VkYXRhO1xuICAgIH1cblxuICBwbG90RDNDaGFydCgpOiB2b2lkIHtcblxuICAgIFxuICAgICAgIGlmKHRoaXMucmVzaXplZmxhZz09ZmFsc2UpXG4gICAgICAge1xuICBpZih0aGlzLmNoYXJ0SWQpe1xuICAgICAgICAgICAgdGhpcy5zdmd3aWR0aCA9IHRoaXMuY2hhcnRJZC5uYXRpdmVFbGVtZW50Lm9mZnNldFdpZHRoO1xuICAgIH0gZWxzZXtcbiAgICAgICAgICAgICAgIHRoaXMuc3Znd2lkdGggPSB0aGlzLnN2Z3dpZHRoO1xuICAgICAgICB9XG4gICAgfVxuICAgICAgICBjb25zdCB0b29sdGlwID0gdGhpcy50b29sVGlwKGQzKTtcblxuICAgICAgICBjb25zdCBsaW5lY2hhcnQgPSB0aGlzLmluaXRDaGFydCgpO1xuXG4gICAgICAgIHRoaXMucGxvdFNjYWxlKGxpbmVjaGFydC5nLCBsaW5lY2hhcnQueCwgbGluZWNoYXJ0LnksIGxpbmVjaGFydC5oZWlnaHQsIGxpbmVjaGFydC53aWR0aCk7XG5cbiAgICAgICAgdGhpcy5wbG90TGluZShsaW5lY2hhcnQuZywgbGluZWNoYXJ0LngsIGxpbmVjaGFydC55LCBsaW5lY2hhcnQuaGVpZ2h0LFxuICAgICAgICAgICAgbGluZWNoYXJ0LndpZHRoLCBbXSwgdG9vbHRpcCwgKDEpKTtcblxuICAgICAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgdGhpcy5tdWx0aXNlcmllc2RhdGEubGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgICAgICAgICB0aGlzLnBsb3RMaW5lKGxpbmVjaGFydC5nLCBsaW5lY2hhcnQueCwgbGluZWNoYXJ0LnksIGxpbmVjaGFydC5oZWlnaHQsXG4gICAgICAgICAgICAgICAgbGluZWNoYXJ0LndpZHRoLCB0aGlzLm11bHRpc2VyaWVzZGF0YVtpbmRleF0sIHRvb2x0aXAsIChpbmRleCArIDEpKTtcbiAgICAgICAgfVxuXG5cbiAgICB9XG5cbiAgICBwcml2YXRlIHBsb3RMaW5lKGc6IGFueSwgeDogYW55LCB5OiBhbnksIGhlaWdodDogYW55LCB3aWR0aDogYW55LCBkYXRhOiBhbnksIHRvb2x0aXA6IGFueSwgaTogbnVtYmVyKTogdm9pZCB7XG5cbiAgICAgICAgY29uc3QgbGluZSA9IGQzLmxpbmUoKVxuICAgICAgICAgICAgLngoZnVuY3Rpb24gKGQpIHsgcmV0dXJuIHgoZC5sYWJlbCk7IH0pXG4gICAgICAgICAgICAueShmdW5jdGlvbiAoZCkgeyByZXR1cm4geShkLnZhbHVlKTsgfSk7XG5cbiAgICAgICAgZy5hcHBlbmQoXCJwYXRoXCIpXG4gICAgICAgICAgICAuZGF0dW0oZGF0YSlcbiAgICAgICAgICAgIC5hdHRyKFwiZmlsbFwiLCBcIm5vbmVcIilcbiAgICAgICAgICAgIC5hdHRyKFwic3Ryb2tlXCIsIHRoaXMucHJlZGVmaW5lZGNvbG9yc1tpXSlcbiAgICAgICAgICAgIC5hdHRyKFwic3Ryb2tlLXdpZHRoXCIsIDEuNSlcbiAgICAgICAgICAgIC5hdHRyKFwiZFwiLCBsaW5lKTtcblxuICAgICAgICBnLnNlbGVjdEFsbCgnZG90JylcbiAgICAgICAgICAgIC5kYXRhKGRhdGEpXG4gICAgICAgICAgICAuZW50ZXIoKVxuICAgICAgICAgICAgLmFwcGVuZCgnY2lyY2xlJylcbiAgICAgICAgICAgIC5hdHRyKFwiY3hcIiwgKGQpID0+IHsgcmV0dXJuIHgoZC5sYWJlbCk7IH0pXG4gICAgICAgICAgICAuYXR0cihcImN5XCIsIChkKSA9PiB7IHJldHVybiB5KGQudmFsdWUpOyB9KVxuICAgICAgICAgICAgLmF0dHIoJ3InLCAyKVxuICAgICAgICAgICAgLmF0dHIoXCJjdXJzb3JcIiwgXCJwb2ludGVyXCIpXG4gICAgICAgICAgICAub24oXCJtb3VzZW92ZXJcIiwgKGQpID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdG9vbHRpcC5zdHlsZShcInZpc2liaWxpdHlcIiwgXCJ2aXNpYmxlXCIpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5vbihcIm1vdXNlbW92ZVwiLCAoZCkgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiB0b29sdGlwLmh0bWwoXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2FsbFRvb2x0aXAoZClcbiAgICAgICAgICAgICAgICAgICAgLy8gIHRoaXMudG9vbFRpcEZvckxpbmUoZClcblxuICAgICAgICAgICAgICAgICAgICAvLyAgdGhpcy50b29sVGlwV2l0aExlZ2VuZGFuZEF4aXMoZC5sZWdlbmQsZC5sYWJlbCxkLnZhbHVlKVxuXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgICAuc3R5bGUoXCJ0b3BcIiwgKGQzLmV2ZW50LnBhZ2VZIC0gMTApICsgXCJweFwiKVxuICAgICAgICAgICAgICAgICAgICAuc3R5bGUoXCJsZWZ0XCIsIChkMy5ldmVudC5wYWdlWCArIDEwKSArIFwicHhcIik7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLm9uKFwibW91c2VvdXRcIiwgKGQpID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdG9vbHRpcC5zdHlsZShcInZpc2liaWxpdHlcIiwgXCJoaWRkZW5cIik7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLm9uKFwiY2xpY2tcIiwgKGQpID0+IHtcbiAgICAgICAgICAgICAgICAgdGhpcy5saW5lQ2hhcnRDbGljayhkKTtcbiAgICAgICAgICAgICAgICAgdGhpcy5mb3JkcmlsbGFibGVDbGljayh0aGlzLGQsZXZlbnQpO1xuICAgICAgICAgICAgICAgICByZXR1cm4gdG9vbHRpcC5zdHlsZShcInZpc2liaWxpdHlcIiwgXCJoaWRkZW5cIik7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgLy9sZXRzIHBsb3QgbGFiZWxzIGhlcmVcbiAgICAgIGlmICh0aGlzLmxhYmVsZmxhZykge1xuICAgICAgICBnLnNlbGVjdEFsbCgnbGFiZWwnKVxuICAgICAgICAgIC5kYXRhKGRhdGEpXG4gICAgICAgICAgLmVudGVyKClcbiAgICAgICAgICAuYXBwZW5kKCd0ZXh0JylcbiAgICAgICAgICAuc3R5bGUoXCJmb250LXdlaWdodFwiLCBcImJvbGRcIilcbiAgICAgICAgICAuYXR0cihcInRleHQtYW5jaG9yXCIsIFwibWlkZGxlXCIpXG4gICAgICAgICAgLmF0dHIoXCJmaWxsXCIsIChkKSA9PiB7XG4gICAgICAgICAgICBpZiAodGhpcy5sYWJlbGNvbG9yLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubGFiZWxjb2xvcjtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHJldHVybiBcImJsYWNrXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSlcbiAgICAgICAgICAuYXR0cihcInhcIiwgZnVuY3Rpb24gKGQsIGkpIHtcbiAgICAgICAgICAgIHJldHVybiB4KGQubGFiZWwpO1xuICAgICAgICAgIH0pXG4gICAgICAgICAgLmF0dHIoXCJ5XCIsIGZ1bmN0aW9uIChkLCBpKSB7XG4gICAgICAgICAgICByZXR1cm4geShkLnZhbHVlKSAtIDEwO1xuICAgICAgICAgIH0pXG4gICAgICAgICAgLnRleHQoZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgIHJldHVybiBkLnZhbHVlO1xuICAgICAgICAgIH0pXG4gICAgICB9XG5cbiAgICB9XG5cbmxpbmVDaGFydENsaWNrKGQ6IGFueSl7XG4gICAgbGV0IG9iaiA9IHt9O1xuICAgIG9ialtkLmxlZ2VuZF0gPSBkLnZhbHVlO1xuICAgIG9ialt0aGlzLnhheGlzbmFtZV0gPSBkLmxhYmVsO1xuICAgIHRoaXMuY2hhcnRDbGljayhvYmopO1xufVxuXG4gICAgY2FsbFRvb2x0aXAodG9vbHRpcGRhdGE6IGFueSkge1xuICAgICAgICBsZXQgb2JqID0ge307XG4gICAgICAgIG9ialt0b29sdGlwZGF0YS5sZWdlbmRdID0gdG9vbHRpcGRhdGEudmFsdWU7XG4gICAgICAgIG9ialt0aGlzLnhheGlzbmFtZV0gPSB0b29sdGlwZGF0YS5sYWJlbDtcbiAgICAgICAgcmV0dXJuIHRoaXMudG9vbFRpcEZvckJhcihvYmopO1xuICAgIH1cbn0iXX0=