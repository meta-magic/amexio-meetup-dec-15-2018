/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */
import { Component, ElementRef, Input, ViewChild, ChangeDetectorRef } from '@angular/core';
import { AmexioD3BaseChartComponent } from '../../base/base.component';
import { CommanDataService } from '../../services/comman.data.service';
import { DeviceQueryService } from '../../services/device.query.service';
import * as d3 from 'd3';
export class BubbleComponent extends AmexioD3BaseChartComponent {
    /**
     * @param {?} myservice
     * @param {?} cdf
     * @param {?} device
     */
    constructor(myservice, cdf, device) {
        super('bubble');
        this.myservice = myservice;
        this.cdf = cdf;
        this.device = device;
        this.svgwidth = 300;
        this.svgheight = 300;
        this.color = "blue";
        this.level = 0;
        this.drillabledatakey = [];
        this.hScale = true;
        this.vScale = true;
        this.drillableFlag = true;
        this.resizeflag = false;
        this.keyArray = [];
        this.transformeddata = [];
        this.colors = [];
        this.xaxisArray = [];
        this.xarray = [];
        this.legends = [];
        this.legendarray = [];
        this.legendData = [];
        this.minxvalue = 0;
        this.maxxvalue = 0;
        this.bubblechartdata = [];
        this.predefinedcolors = ["#3366cc", "#dc3912", "#ff9900", "#109618", "#990099", "#0099c6", "#dd4477", "#66aa00", "#b82e2e", "#316395", "#994499", "#22aa99", "#aaaa11", "#6633cc", "#e67300", "#8b0707", "#651067", "#329262", "#5574a6", "#3b3eac"];
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.data1 = [];
        if (this.level <= 1) {
            /** @type {?} */
            let resp;
            if (this.httpmethod && this.httpurl) {
                this.myservice.fetchUrlData(this.httpurl, this.httpmethod).subscribe((response) => {
                    resp = response;
                    this.httpresponse = resp;
                }, (error) => {
                }, () => {
                    setTimeout(() => {
                        this.data = this.getResponseData(resp);
                        this.data1 = this.data;
                        this.xaxisData();
                        this.transformData(this.data1);
                        this.transformdata();
                        this.colorGeneration();
                        this.formLegendData();
                        this.plotBubbleChart();
                    }, 0);
                });
            }
            else if (this.data) {
                setTimeout(() => {
                    this.data1 = this.data;
                    this.data = this.getResponseData(this.data);
                    this.xaxisData();
                    this.transformData(this.data);
                    this.transformdata();
                    this.colorGeneration();
                    this.formLegendData();
                    this.plotBubbleChart();
                }, 0);
            }
        }
    }
    /**
     * @param {?} data
     * @return {?}
     */
    fetchData(data) {
        /** @type {?} */
        let requestJson;
        /** @type {?} */
        let key = this.drillabledatakey;
        /** @type {?} */
        let resp;
        if (this.drillabledatakey.length) {
            /** @type {?} */
            let drillabledata = this.getMultipleDrillbleKeyData(data, key);
            requestJson = drillabledata;
        }
        else {
            requestJson = data;
        }
        if (this.httpmethod && this.httpurl) {
            this.myservice.postfetchData(this.httpurl, this.httpmethod, requestJson).subscribe((response) => {
                resp = response;
                this.httpresponse = response;
            }, (error) => {
            }, () => {
                setTimeout(() => {
                    //this.data = this.getResponseData(resp);
                    this.drawChart();
                }, 0);
            });
        }
    }
    /**
     * @return {?}
     */
    drawChart() {
        setTimeout(() => {
            this.data = this.getResponseData(this.httpresponse);
            this.data1 = this.data;
            this.xaxisData();
            this.transformData(this.data1);
            this.transformdata();
            this.colorGeneration();
            this.formLegendData();
            this.plotBubbleChart();
        }, 0);
    }
    /**
     * @param {?} httpResponse
     * @return {?}
     */
    getResponseData(httpResponse) {
        /** @type {?} */
        let responsedata = httpResponse;
        if (this.datareader != null) {
            /** @type {?} */
            const dr = this.datareader.split('.');
            for (const ir of dr) {
                responsedata = responsedata[ir];
            }
        }
        else {
            responsedata = httpResponse;
        }
        return responsedata;
    }
    /**
     * @param {?} data
     * @return {?}
     */
    transformData(data) {
        this.colordata = [];
        this.keyArray = data[0];
        data.forEach((element, index) => {
            if (index > 0) {
                /** @type {?} */
                let DummyObject = {};
                element.forEach((individualvalue, keyindex) => {
                    DummyObject[this.keyArray[keyindex]] = individualvalue;
                });
                this.transformeddata.push(DummyObject);
            }
        });
        this.data = this.transformeddata;
        this.colordata = this.transformeddata;
    }
    /**
     * @return {?}
     */
    plotBubbleChart() {
        /** @type {?} */
        let colors = this.predefinedcolors;
        if (this.resizeflag == false) {
            if (this.chartId) {
                this.svgwidth = this.chartId.nativeElement.offsetWidth;
            }
            else {
                this.svgwidth = this.svgwidth;
            }
        }
        /** @type {?} */
        const tooltip = this.toolTip(d3);
        /** @type {?} */
        const margin = { top: 20, right: 60, bottom: 50, left: 60 };
        /** @type {?} */
        const width = this.svgwidth - margin.left - margin.right;
        /** @type {?} */
        const height = this.svgheight - margin.top - margin.bottom;
        /** @type {?} */
        let x;
        /** @type {?} */
        let y;
        x = d3.scaleLinear()
            .rangeRound([0, width]);
        y = d3.scaleLinear()
            .rangeRound([height, 0]);
        /** @type {?} */
        let xAxis = d3.axisBottom(x);
        /** @type {?} */
        let yAxis = d3.axisLeft(y);
        this.svg = d3.select("#" + this.componentId)
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
        // x.domain([0, d3.max(this.data, function (d) { return d[Object.keys(d)[1]] })]);
        y.domain([0, d3.max(this.data, function (d) { return d[Object.keys(d)[2]]; })]);
        x.domain([this.minxvalue, this.maxxvalue]);
        /** @type {?} */
        var rScale = d3.scaleSqrt().rangeRound([6, 30]);
        rScale.domain([d3.min(this.data, function (d) { return d[Object.keys(d)[4]]; }), d3.max(this.data, function (d, i) { return d[Object.keys(d)[4]]; })]);
        if (this.device.IsDesktop() == true) {
            this.svg.append("g")
                .attr("transform", "translate(0," + height + ")")
                .call(xAxis)
                .append("text")
                .attr("y", 0)
                .attr("x", 9)
                .attr("dy", ".35em")
                .style("text-anchor", "start");
        }
        else {
            this.svg.append("g")
                .attr("class", "x axis")
                .attr("transform", "translate(0," + height + ")")
                .call(xAxis).
                selectAll("text")
                .attr("y", 0)
                .attr("x", 9)
                .attr("dy", ".35em")
                .attr("transform", "rotate(60)")
                .style("text-anchor", "start");
        }
        this.svg.append("g")
            .attr("class", "y axis")
            .call(yAxis)
            .append("text")
            .attr("class", "label")
            .attr("transform", "rotate(-90)")
            .attr("y", 6)
            .attr("dy", ".71em")
            .style("text-anchor", "end");
        this.plotLine(this.svg, x, y, height, width);
        /** @type {?} */
        let node = this.svg.selectAll(".dot")
            .data(this.bubblechartdata)
            .enter().append("circle")
            .attr("class", "dot")
            .attr("r", function (d) { return rScale(d[Object.keys(d)[4]]); })
            .attr("cursor", "pointer")
            .attr("cx", function (d) {
            return x(d[Object.keys(d)[1]]);
        })
            .attr("cy", function (d) { return y(d[Object.keys(d)[2]]); })
            .attr("fill", function (d) { return d[Object.keys(d)[5]]; })
            .attr('opacity', 0.7)
            .on("mouseover", (d) => {
            return tooltip.style("visibility", "visible");
        })
            .on("mousemove", (d) => {
            return tooltip.html(this.formTooltipData(d))
                .style("top", (d3.event.pageY - 10) + "px")
                .style("left", (d3.event.pageX + 10) + "px");
        })
            .on("mouseout", (d) => {
            return tooltip.style("visibility", "hidden");
        })
            .on("click", (d) => {
            this.bubbleChartClick(d);
            this.fordrillableClick(this, d, event);
            return tooltip.style("visibility", "hidden");
        });
    }
    /**
     * @param {?} tooltipData
     * @return {?}
     */
    formTooltipData(tooltipData) {
        /** @type {?} */
        let object = {};
        for (let [key, value] of Object.entries(tooltipData)) {
            if (key != 'color') {
                object[key] = value;
            }
        }
        return this.toolTipForBar(object);
    }
    // Method on chart click
    /**
     * @param {?} event
     * @return {?}
     */
    bubbleChartClick(event) {
        /** @type {?} */
        let object = {};
        for (let [key, value] of Object.entries(event)) {
            object[key] = value;
        }
        this.chartClick(object);
    }
    /**
     * @param {?} data
     * @return {?}
     */
    resize(data) {
        this.svgwidth = 0;
        this.svg.selectAll("*").remove();
        this.resizeflag = true;
        this.svgwidth = this.divid.nativeElement.offsetWidth;
        this.plotBubbleChart();
    }
    /**
     * @return {?}
     */
    xaxisData() {
        /** @type {?} */
        let array = [];
        this.minxvalue = 0;
        this.maxxvalue = 0;
        this.xaxisArray = [];
        this.xarray = [];
        this.data1.forEach(element => {
            array.push(element[1]);
        });
        for (let i = 1; i < array.length; i++) {
            this.xaxisArray.push(array[i]);
        }
        /** @type {?} */
        let minvalue = Math.floor(d3.min(this.xaxisArray));
        /** @type {?} */
        let maxvalue = Math.ceil(d3.max(this.xaxisArray));
        this.minxvalue = 5 * (Math.floor(Math.abs(minvalue / 5)));
        this.maxxvalue = 5 * (Math.ceil(Math.abs(maxvalue / 5)));
    }
    /**
     * @return {?}
     */
    colorGeneration() {
        this.legendarray = [];
        /** @type {?} */
        let i = 0;
        /** @type {?} */
        let names = this.data1
            .map(e => e[3])
            .filter((e, i, a) => a.indexOf(e) === i);
        for (let j = 1; j < names.length; j++) {
            /** @type {?} */
            let value = [];
            /** @type {?} */
            let obj = { "label": "", "color": "", "value": [] };
            this.colordata.forEach(element => {
                if (element[Object.keys(element)[3]] == names[j]) {
                    element['color'] = this.predefinedcolors[i];
                    value.push(element);
                }
            });
            obj["value"] = value;
            obj["label"] = names[j];
            obj["color"] = this.predefinedcolors[i];
            this.legendarray.push(obj);
            i++;
        }
    }
    /**
     * @return {?}
     */
    formLegendData() {
        this.legendData = [];
        this.legendarray.forEach(element => {
            /** @type {?} */
            let legendobject = {};
            legendobject['label'] = element.label;
            legendobject['color'] = element.color;
            this.legendData.push(legendobject);
        });
    }
    /**
     * @param {?} legendevent
     * @return {?}
     */
    onBubbleLegendClick(legendevent) {
        this.legendarray.forEach(element => {
            if (legendevent.label == element.label) {
                this.legendClick(element.value);
            }
        });
    }
    /**
     * @param {?} g
     * @param {?} x
     * @param {?} y
     * @param {?} height
     * @param {?} width
     * @return {?}
     */
    plotLine(g, x, y, height, width) {
        if (this.vScale) {
            g.append('g')
                .attr("color", "lightgrey")
                .attr('transform', 'translate(0,' + height + ')')
                .call(d3.axisBottom(x).
                tickSize(-this.width).tickFormat(''));
        }
        if (this.hScale) {
            g.append('g')
                .attr("color", "lightgrey")
                .call(d3.axisLeft(y)
                .tickSize(-width).tickFormat(''));
        }
    }
    /**
     * @return {?}
     */
    transformdata() {
        this.bubblechartdata = [];
        /** @type {?} */
        let buubledata = [];
        this.colordata.forEach((element, i) => {
            buubledata.push(element[Object.keys(element)[4]]);
        });
        /** @type {?} */
        let data = buubledata.sort(function (a, b) { return b - a; });
        for (let j = 0; j <= data.length; j++) {
            this.colordata.forEach(element => {
                if (data[j] == element[Object.keys(element)[4]])
                    this.bubblechartdata.push(element);
            });
        }
    }
}
BubbleComponent.decorators = [
    { type: Component, args: [{
                selector: 'amexio-d3-chart-bubble',
                template: `
<div   *ngIf="drillableFlag" #divid (window:resize)="resize($event)">
<table style="width: 100%;" #chartId >
  <tr>
      <td colspan="2" style="font-size: 18px; font-weight: bold; "> {{title}} </td>
  </tr>
  <tr>
      <td>
          <svg [attr.height]="svgheight" [attr.width]="svgwidth" [attr.id]="componentId">
          </svg>
      </td>
  </tr>
  <tr>
      <td style="display: block; padding: 5px;">
          <amexio-d3-legend *ngIf="legend" [horizontal]="true" (onClick)="onBubbleLegendClick($event)" [data]="legendData" style="height:100%;"></amexio-d3-legend>
      </td>
  </tr>
</table>
</div>`,
                styles: [``]
            },] },
];
BubbleComponent.ctorParameters = () => [
    { type: CommanDataService },
    { type: ChangeDetectorRef },
    { type: DeviceQueryService }
];
BubbleComponent.propDecorators = {
    svgwidth: [{ type: Input, args: ['width',] }],
    svgheight: [{ type: Input, args: ['height',] }],
    color: [{ type: Input, args: ['color',] }],
    chartId: [{ type: ViewChild, args: ['chartId',] }],
    divid: [{ type: ViewChild, args: ['divid',] }],
    datareader: [{ type: Input, args: ['data-reader',] }],
    level: [{ type: Input, args: ['level',] }],
    target: [{ type: Input, args: ['target',] }],
    drillabledatakey: [{ type: Input, args: ['drillable-data',] }],
    hScale: [{ type: Input, args: ['horizontal-scale',] }],
    vScale: [{ type: Input, args: ['vertical-scale',] }]
};
if (false) {
    /** @type {?} */
    BubbleComponent.prototype.svgwidth;
    /** @type {?} */
    BubbleComponent.prototype.svgheight;
    /** @type {?} */
    BubbleComponent.prototype.color;
    /** @type {?} */
    BubbleComponent.prototype.chartId;
    /** @type {?} */
    BubbleComponent.prototype.divid;
    /** @type {?} */
    BubbleComponent.prototype.datareader;
    /** @type {?} */
    BubbleComponent.prototype.level;
    /** @type {?} */
    BubbleComponent.prototype.target;
    /** @type {?} */
    BubbleComponent.prototype.drillabledatakey;
    /** @type {?} */
    BubbleComponent.prototype.hScale;
    /** @type {?} */
    BubbleComponent.prototype.vScale;
    /** @type {?} */
    BubbleComponent.prototype.drillableFlag;
    /** @type {?} */
    BubbleComponent.prototype.resizeflag;
    /** @type {?} */
    BubbleComponent.prototype.keyArray;
    /** @type {?} */
    BubbleComponent.prototype.transformeddata;
    /** @type {?} */
    BubbleComponent.prototype.colors;
    /** @type {?} */
    BubbleComponent.prototype.data1;
    /** @type {?} */
    BubbleComponent.prototype.xaxisArray;
    /** @type {?} */
    BubbleComponent.prototype.xarray;
    /** @type {?} */
    BubbleComponent.prototype.legends;
    /** @type {?} */
    BubbleComponent.prototype.legendarray;
    /** @type {?} */
    BubbleComponent.prototype.legendData;
    /** @type {?} */
    BubbleComponent.prototype.minxvalue;
    /** @type {?} */
    BubbleComponent.prototype.maxxvalue;
    /** @type {?} */
    BubbleComponent.prototype.colordata;
    /** @type {?} */
    BubbleComponent.prototype.bubblechartdata;
    /** @type {?} */
    BubbleComponent.prototype.httpresponse;
    /** @type {?} */
    BubbleComponent.prototype.svg;
    /** @type {?} */
    BubbleComponent.prototype.myservice;
    /** @type {?} */
    BubbleComponent.prototype.cdf;
    /** @type {?} */
    BubbleComponent.prototype.device;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYnViYmxlLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL2FtZXhpby1jaGFydC1kMy8iLCJzb3VyY2VzIjpbImxpYi9idWJibGUvYnViYmxlL2J1YmJsZS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsVUFBVSxFQUFFLEtBQUssRUFBVSxTQUFTLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDbkcsT0FBTyxFQUFFLDBCQUEwQixFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFDdkUsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sb0NBQW9DLENBQUM7QUFDdkUsT0FBTSxFQUFDLGtCQUFrQixFQUFDLE1BQU0scUNBQXFDLENBQUM7QUFDdEUsT0FBTyxLQUFLLEVBQUUsTUFBTSxJQUFJLENBQUM7QUF3QnpCLE1BQU0sc0JBQXVCLFNBQVEsMEJBQTBCOzs7Ozs7SUE2QjdELFlBQW9CLFNBQTRCLEVBQVUsR0FBc0IsRUFBUyxNQUF5QjtRQUVoSCxLQUFLLENBQUMsUUFBUSxDQUFDLENBQUM7UUFGRSxjQUFTLEdBQVQsU0FBUyxDQUFtQjtRQUFVLFFBQUcsR0FBSCxHQUFHLENBQW1CO1FBQVMsV0FBTSxHQUFOLE1BQU0sQ0FBbUI7UUE1QmxHLGFBQVEsR0FBVyxHQUFHLENBQUM7UUFDdEIsY0FBUyxHQUFXLEdBQUcsQ0FBQztRQUN6QixVQUFLLEdBQVEsTUFBTSxDQUFDO1FBSXBCLFVBQUssR0FBVyxDQUFDLENBQUM7UUFFVCxxQkFBZ0IsR0FBVSxFQUFFLENBQUM7UUFDM0IsV0FBTSxHQUFZLElBQUksQ0FBQztRQUN6QixXQUFNLEdBQVksSUFBSSxDQUFDO1FBQ2hELGtCQUFhLEdBQVksSUFBSSxDQUFDO1FBQzlCLGVBQVUsR0FBWSxLQUFLLENBQUM7UUFDNUIsYUFBUSxHQUFVLEVBQUUsQ0FBQztRQUNyQixvQkFBZSxHQUFVLEVBQUUsQ0FBQztRQUM1QixXQUFNLEdB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aUJBQWlCO1lBR3BFLGtCQUFrQjs7O3VCQTBCdEIsS0FBSyxTQUFDLE9BQU87d0JBQ2IsS0FBSyxTQUFDLFFBQVE7b0JBQ2QsS0FBSyxTQUFDLE9BQU87c0JBQ2IsU0FBUyxTQUFDLFNBQVM7b0JBQ25CLFNBQVMsU0FBQyxPQUFPO3lCQUNqQixLQUFLLFNBQUMsYUFBYTtvQkFDbkIsS0FBSyxTQUFDLE9BQU87cUJBQ2IsS0FBSyxTQUFDLFFBQVE7K0JBQ2QsS0FBSyxTQUFDLGdCQUFnQjtxQkFDdEIsS0FBSyxTQUFDLGtCQUFrQjtxQkFDeEIsS0FBSyxTQUFDLGdCQUFnQjs7OztJQVZ2QixtQ0FBdUM7O0lBQ3ZDLG9DQUF5Qzs7SUFDekMsZ0NBQW9DOztJQUNwQyxrQ0FBMEM7O0lBQzFDLGdDQUFzQzs7SUFDdEMscUNBQXlDOztJQUN6QyxnQ0FBa0M7O0lBQ2xDLGlDQUFnQzs7SUFDaEMsMkNBQXNEOztJQUN0RCxpQ0FBa0Q7O0lBQ2xELGlDQUFnRDs7SUFDaEQsd0NBQThCOztJQUM5QixxQ0FBNEI7O0lBQzVCLG1DQUFxQjs7SUFDckIsMENBQTRCOztJQUM1QixpQ0FBbUI7O0lBQ25CLGdDQUFXOztJQUNYLHFDQUF1Qjs7SUFDdkIsaUNBQW1COztJQUNuQixrQ0FBb0I7O0lBQ3BCLHNDQUF3Qjs7SUFDeEIscUNBQXVCOztJQUN2QixvQ0FBc0I7O0lBQ3RCLG9DQUFzQjs7SUFDdEIsb0NBQWU7O0lBQ2YsMENBQTRCOztJQUM1Qix1Q0FBa0I7O0lBQ2xCLDhCQUFTOztJQUNHLG9DQUFvQzs7SUFBRSw4QkFBOEI7O0lBQUMsaUNBQWlDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBFbGVtZW50UmVmLCBJbnB1dCwgT25Jbml0LCBWaWV3Q2hpbGQsIENoYW5nZURldGVjdG9yUmVmIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBBbWV4aW9EM0Jhc2VDaGFydENvbXBvbmVudCB9IGZyb20gJy4uLy4uL2Jhc2UvYmFzZS5jb21wb25lbnQnO1xuaW1wb3J0IHsgQ29tbWFuRGF0YVNlcnZpY2UgfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy9jb21tYW4uZGF0YS5zZXJ2aWNlJztcbmltcG9ydHtEZXZpY2VRdWVyeVNlcnZpY2V9IGZyb20gJy4uLy4uL3NlcnZpY2VzL2RldmljZS5xdWVyeS5zZXJ2aWNlJztcbmltcG9ydCAqIGFzIGQzIGZyb20gJ2QzJztcbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2FtZXhpby1kMy1jaGFydC1idWJibGUnLFxuICB0ZW1wbGF0ZTogYFxuPGRpdiAgICpuZ0lmPVwiZHJpbGxhYmxlRmxhZ1wiICNkaXZpZCAod2luZG93OnJlc2l6ZSk9XCJyZXNpemUoJGV2ZW50KVwiPlxuPHRhYmxlIHN0eWxlPVwid2lkdGg6IDEwMCU7XCIgI2NoYXJ0SWQgPlxuICA8dHI+XG4gICAgICA8dGQgY29sc3Bhbj1cIjJcIiBzdHlsZT1cImZvbnQtc2l6ZTogMThweDsgZm9udC13ZWlnaHQ6IGJvbGQ7IFwiPiB7e3RpdGxlfX0gPC90ZD5cbiAgPC90cj5cbiAgPHRyPlxuICAgICAgPHRkPlxuICAgICAgICAgIDxzdmcgW2F0dHIuaGVpZ2h0XT1cInN2Z2hlaWdodFwiIFthdHRyLndpZHRoXT1cInN2Z3dpZHRoXCIgW2F0dHIuaWRdPVwiY29tcG9uZW50SWRcIj5cbiAgICAgICAgICA8L3N2Zz5cbiAgICAgIDwvdGQ+XG4gIDwvdHI+XG4gIDx0cj5cbiAgICAgIDx0ZCBzdHlsZT1cImRpc3BsYXk6IGJsb2NrOyBwYWRkaW5nOiA1cHg7XCI+XG4gICAgICAgICAgPGFtZXhpby1kMy1sZWdlbmQgKm5nSWY9XCJsZWdlbmRcIiBbaG9yaXpvbnRhbF09XCJ0cnVlXCIgKG9uQ2xpY2spPVwib25CdWJibGVMZWdlbmRDbGljaygkZXZlbnQpXCIgW2RhdGFdPVwibGVnZW5kRGF0YVwiIHN0eWxlPVwiaGVpZ2h0OjEwMCU7XCI+PC9hbWV4aW8tZDMtbGVnZW5kPlxuICAgICAgPC90ZD5cbiAgPC90cj5cbjwvdGFibGU+XG48L2Rpdj5gLFxuICBzdHlsZXM6IFtgYF1cbn0pXG5leHBvcnQgY2xhc3MgQnViYmxlQ29tcG9uZW50IGV4dGVuZHMgQW1leGlvRDNCYXNlQ2hhcnRDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xuICBASW5wdXQoJ3dpZHRoJykgc3Znd2lkdGg6IG51bWJlciA9IDMwMDtcbiAgQElucHV0KCdoZWlnaHQnKSBzdmdoZWlnaHQ6IG51bWJlciA9IDMwMDtcbiAgQElucHV0KCdjb2xvcicpIGNvbG9yOiBhbnkgPSBcImJsdWVcIjtcbiAgQFZpZXdDaGlsZCgnY2hhcnRJZCcpIGNoYXJ0SWQ6IEVsZW1lbnRSZWY7XG4gIEBWaWV3Q2hpbGQoJ2RpdmlkJykgZGl2aWQ6IEVsZW1lbnRSZWY7XG4gIEBJbnB1dCgnZGF0YS1yZWFkZXInKSBkYXRhcmVhZGVyOiBzdHJpbmc7XG4gIEBJbnB1dCgnbGV2ZWwnKSBsZXZlbDogbnVtYmVyID0gMDtcbiAgQElucHV0KCd0YXJnZXQnKSB0YXJnZXQ6IG51bWJlcjtcbiAgQElucHV0KCdkcmlsbGFibGUtZGF0YScpIGRyaWxsYWJsZWRhdGFrZXk6IGFueVtdID0gW107XG4gIEBJbnB1dCgnaG9yaXpvbnRhbC1zY2FsZScpIGhTY2FsZTogYm9vbGVhbiA9IHRydWU7XG4gIEBJbnB1dCgndmVydGljYWwtc2NhbGUnKSB2U2NhbGU6IGJvb2xlYW4gPSB0cnVlO1xuICBkcmlsbGFibGVGbGFnOiBib29sZWFuID0gdHJ1ZTtcbiAgcmVzaXplZmxhZzogYm9vbGVhbiA9IGZhbHNlO1xuICBrZXlBcnJheTogYW55W10gPSBbXTtcbiAgdHJhbnNmb3JtZWRkYXRhOiBhbnlbXSA9IFtdO1xuICBjb2xvcnM6IGFueVtdID0gW107XG4gIGRhdGExOiBhbnk7XG4gIHhheGlzQXJyYXk6IGFueVtdID0gW107XG4gIHhhcnJheTogYW55W10gPSBbXTtcbiAgbGVnZW5kczogYW55W10gPSBbXTtcbiAgbGVnZW5kYXJyYXk6IGFueVtdID0gW107XG4gIGxlZ2VuZERhdGE6IGFueVtdID0gW107XG4gIG1pbnh2YWx1ZTogbnVtYmVyID0gMDtcbiAgbWF4eHZhbHVlOiBudW1iZXIgPSAwO1xuICBjb2xvcmRhdGE6IGFueTtcbiAgYnViYmxlY2hhcnRkYXRhOiBhbnlbXSA9IFtdO1xuICBodHRwcmVzcG9uc2U6IGFueTtcbiAgc3ZnOiBhbnk7XG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgbXlzZXJ2aWNlOiBDb21tYW5EYXRhU2VydmljZSwgcHJpdmF0ZSBjZGY6IENoYW5nZURldGVjdG9yUmVmLHByaXZhdGUgZGV2aWNlOkRldmljZVF1ZXJ5U2VydmljZSkge1xuXG4gICAgc3VwZXIoJ2J1YmJsZScpO1xuICAgIHRoaXMucHJlZGVmaW5lZGNvbG9ycyA9IFtcIiMzMzY2Y2NcIiwgXCIjZGMzOTEyXCIsIFwiI2ZmOTkwMFwiLCBcIiMxMDk2MThcIiwgXCIjOTkwMDk5XCIsIFwiIzAwOTljNlwiLCBcIiNkZDQ0NzdcIiwgXCIjNjZhYTAwXCIsIFwiI2I4MmUyZVwiLCBcIiMzMTYzOTVcIiwgXCIjOTk0NDk5XCIsIFwiIzIyYWE5OVwiLCBcIiNhYWFhMTFcIiwgXCIjNjYzM2NjXCIsIFwiI2U2NzMwMFwiLCBcIiM4YjA3MDdcIiwgXCIjNjUxMDY3XCIsIFwiIzMyOTI2MlwiLCBcIiM1NTc0YTZcIiwgXCIjM2IzZWFjXCJdO1xuXG4gIH1cblxuICBuZ09uSW5pdCgpIHtcblxuICAgIHRoaXMuZGF0YTEgPSBbXTtcblxuICAgIGlmICh0aGlzLmxldmVsIDw9IDEpIHtcbiAgICAgIGxldCByZXNwOiBhbnk7XG4gICAgICBpZiAodGhpcy5odHRwbWV0aG9kICYmIHRoaXMuaHR0cHVybCkge1xuICAgICAgICB0aGlzLm15c2VydmljZS5mZXRjaFVybERhdGEodGhpcy5odHRwdXJsLCB0aGlzLmh0dHBtZXRob2QpLnN1YnNjcmliZSgocmVzcG9uc2UpID0+IHtcbiAgICAgICAgICByZXNwID0gcmVzcG9uc2U7XG4gICAgICAgICAgdGhpcy5odHRwcmVzcG9uc2UgPSByZXNwO1xuICAgICAgICB9LCAoZXJyb3IpID0+IHtcbiAgICAgICAgfSwgKCkgPT4ge1xuICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5kYXRhID0gdGhpcy5nZXRSZXNwb25zZURhdGEocmVzcCk7XG4gICAgICAgICAgICB0aGlzLmRhdGExID0gdGhpcy5kYXRhO1xuXG4gICAgICAgICAgICB0aGlzLnhheGlzRGF0YSgpO1xuICAgICAgICAgICAgdGhpcy50cmFuc2Zvcm1EYXRhKHRoaXMuZGF0YTEpO1xuICAgICAgICAgICAgdGhpcy50cmFuc2Zvcm1kYXRhKCk7XG4gICAgICAgICAgICB0aGlzLmNvbG9yR2VuZXJhdGlvbigpO1xuICAgICAgICAgICAgdGhpcy5mb3JtTGVnZW5kRGF0YSgpO1xuICAgICAgICAgICAgdGhpcy5wbG90QnViYmxlQ2hhcnQoKTtcbiAgICAgICAgICB9LCAwKTtcbiAgICAgICAgfSk7XG5cbiAgICAgIH0gZWxzZSBpZiAodGhpcy5kYXRhKSB7XG5cbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgdGhpcy5kYXRhMSA9IHRoaXMuZGF0YTtcbiAgICAgICAgICB0aGlzLmRhdGEgPSB0aGlzLmdldFJlc3BvbnNlRGF0YSh0aGlzLmRhdGEpO1xuICAgICAgICAgIHRoaXMueGF4aXNEYXRhKCk7XG4gICAgICAgICAgdGhpcy50cmFuc2Zvcm1EYXRhKHRoaXMuZGF0YSk7XG4gICAgICAgICAgdGhpcy50cmFuc2Zvcm1kYXRhKCk7XG4gICAgICAgICAgdGhpcy5jb2xvckdlbmVyYXRpb24oKTtcbiAgICAgICAgICB0aGlzLmZvcm1MZWdlbmREYXRhKCk7XG4gICAgICAgICAgdGhpcy5wbG90QnViYmxlQ2hhcnQoKTtcblxuICAgICAgICB9LCAwKTtcblxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGZldGNoRGF0YShkYXRhOiBhbnkpIHtcblxuICAgIGxldCByZXF1ZXN0SnNvbjtcbiAgICBsZXQga2V5ID0gdGhpcy5kcmlsbGFibGVkYXRha2V5O1xuICAgIGxldCByZXNwOiBhbnk7XG4gICAgaWYgKHRoaXMuZHJpbGxhYmxlZGF0YWtleS5sZW5ndGgpIHtcbiAgICAgIGxldCBkcmlsbGFibGVkYXRhID0gdGhpcy5nZXRNdWx0aXBsZURyaWxsYmxlS2V5RGF0YShkYXRhLCBrZXkpO1xuICAgICAgcmVxdWVzdEpzb24gPSBkcmlsbGFibGVkYXRhO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIHJlcXVlc3RKc29uID0gZGF0YTtcbiAgICB9XG4gICAgaWYgKHRoaXMuaHR0cG1ldGhvZCAmJiB0aGlzLmh0dHB1cmwpIHtcbiAgICAgIHRoaXMubXlzZXJ2aWNlLnBvc3RmZXRjaERhdGEodGhpcy5odHRwdXJsLCB0aGlzLmh0dHBtZXRob2QsIHJlcXVlc3RKc29uKS5zdWJzY3JpYmUoKHJlc3BvbnNlKSA9PiB7XG4gICAgICAgIHJlc3AgPSByZXNwb25zZTtcbiAgICAgICAgdGhpcy5odHRwcmVzcG9uc2UgPSByZXNwb25zZTtcbiAgICAgIH0sIChlcnJvcikgPT4ge1xuICAgICAgfSwgKCkgPT4ge1xuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAvL3RoaXMuZGF0YSA9IHRoaXMuZ2V0UmVzcG9uc2VEYXRhKHJlc3ApO1xuICAgICAgICAgIHRoaXMuZHJhd0NoYXJ0KCk7XG4gICAgICAgIH0sIDApO1xuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgZHJhd0NoYXJ0KCkge1xuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgdGhpcy5kYXRhID0gdGhpcy5nZXRSZXNwb25zZURhdGEodGhpcy5odHRwcmVzcG9uc2UpO1xuICAgICAgdGhpcy5kYXRhMSA9IHRoaXMuZGF0YTtcblxuICAgICAgdGhpcy54YXhpc0RhdGEoKTtcbiAgICAgIHRoaXMudHJhbnNmb3JtRGF0YSh0aGlzLmRhdGExKTtcbiAgICAgIHRoaXMudHJhbnNmb3JtZGF0YSgpO1xuICAgICAgdGhpcy5jb2xvckdlbmVyYXRpb24oKTtcbiAgICAgIHRoaXMuZm9ybUxlZ2VuZERhdGEoKTtcbiAgICAgIHRoaXMucGxvdEJ1YmJsZUNoYXJ0KCk7XG4gICAgfSwgMCk7XG4gIH1cblxuICBnZXRSZXNwb25zZURhdGEoaHR0cFJlc3BvbnNlOiBhbnkpIHtcbiAgICBsZXQgcmVzcG9uc2VkYXRhID0gaHR0cFJlc3BvbnNlO1xuICAgIGlmICh0aGlzLmRhdGFyZWFkZXIgIT0gbnVsbCkge1xuICAgICAgY29uc3QgZHIgPSB0aGlzLmRhdGFyZWFkZXIuc3BsaXQoJy4nKTtcbiAgICAgIGZvciAoY29uc3QgaXIgb2YgZHIpIHtcbiAgICAgICAgcmVzcG9uc2VkYXRhID0gcmVzcG9uc2VkYXRhW2lyXTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgcmVzcG9uc2VkYXRhID0gaHR0cFJlc3BvbnNlO1xuICAgIH1cbiAgICByZXR1cm4gcmVzcG9uc2VkYXRhO1xuICB9XG5cblxuXG4gIHRyYW5zZm9ybURhdGEoZGF0YTogYW55KSB7XG4gICAgdGhpcy5jb2xvcmRhdGEgPSBbXTtcbiAgICB0aGlzLmtleUFycmF5ID0gZGF0YVswXTtcbiAgICBkYXRhLmZvckVhY2goKGVsZW1lbnQsIGluZGV4KSA9PiB7XG4gICAgICBpZiAoaW5kZXggPiAwKSB7XG4gICAgICAgIGxldCBEdW1teU9iamVjdCA9IHt9O1xuICAgICAgICBlbGVtZW50LmZvckVhY2goKGluZGl2aWR1YWx2YWx1ZSwga2V5aW5kZXgpID0+IHtcbiAgICAgICAgICBEdW1teU9iamVjdFt0aGlzLmtleUFycmF5W2tleWluZGV4XV0gPSBpbmRpdmlkdWFsdmFsdWU7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnRyYW5zZm9ybWVkZGF0YS5wdXNoKER1bW15T2JqZWN0KTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICB0aGlzLmRhdGEgPSB0aGlzLnRyYW5zZm9ybWVkZGF0YTtcbiAgICB0aGlzLmNvbG9yZGF0YSA9IHRoaXMudHJhbnNmb3JtZWRkYXRhO1xuXG4gIH1cblxuICBwbG90QnViYmxlQ2hhcnQoKSB7XG5cbiAgICBsZXQgY29sb3JzID0gdGhpcy5wcmVkZWZpbmVkY29sb3JzO1xuICAgIGlmICh0aGlzLnJlc2l6ZWZsYWcgPT0gZmFsc2UpIHtcbiAgICAgIGlmICh0aGlzLmNoYXJ0SWQpIHtcblxuICAgICAgICB0aGlzLnN2Z3dpZHRoID0gdGhpcy5jaGFydElkLm5hdGl2ZUVsZW1lbnQub2Zmc2V0V2lkdGg7XG4gICAgICB9IGVsc2Uge1xuXG4gICAgICAgIHRoaXMuc3Znd2lkdGggPSB0aGlzLnN2Z3dpZHRoO1xuICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0IHRvb2x0aXAgPSB0aGlzLnRvb2xUaXAoZDMpO1xuICAgIGNvbnN0IG1hcmdpbiA9IHsgdG9wOiAyMCwgcmlnaHQ6IDYwLCBib3R0b206IDUwLCBsZWZ0OiA2MCB9O1xuICAgIGNvbnN0IHdpZHRoID0gdGhpcy5zdmd3aWR0aCAtIG1hcmdpbi5sZWZ0IC0gbWFyZ2luLnJpZ2h0O1xuICAgIGNvbnN0IGhlaWdodCA9IHRoaXMuc3ZnaGVpZ2h0IC0gbWFyZ2luLnRvcCAtIG1hcmdpbi5ib3R0b207XG5cbiAgICBsZXQgeCwgeTtcblxuXG4gICAgeCA9IGQzLnNjYWxlTGluZWFyKClcbiAgICAgIC5yYW5nZVJvdW5kKFswLCB3aWR0aF0pO1xuXG4gICAgeSA9IGQzLnNjYWxlTGluZWFyKClcbiAgICAgIC5yYW5nZVJvdW5kKFtoZWlnaHQsIDBdKTtcblxuICAgIGxldCB4QXhpcyA9IGQzLmF4aXNCb3R0b20oeCk7XG5cbiAgICBsZXQgeUF4aXMgPSBkMy5heGlzTGVmdCh5KTtcblxuICAgIHRoaXMuc3ZnID0gZDMuc2VsZWN0KFwiI1wiICsgdGhpcy5jb21wb25lbnRJZClcbiAgICAgIC5hdHRyKFwid2lkdGhcIiwgd2lkdGggKyBtYXJnaW4ubGVmdCArIG1hcmdpbi5yaWdodClcbiAgICAgIC5hdHRyKFwiaGVpZ2h0XCIsIGhlaWdodCArIG1hcmdpbi50b3AgKyBtYXJnaW4uYm90dG9tKVxuICAgICAgLmFwcGVuZChcImdcIilcbiAgICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIFwidHJhbnNsYXRlKFwiICsgbWFyZ2luLmxlZnQgKyBcIixcIiArIG1hcmdpbi50b3AgKyBcIilcIik7XG5cbiAgICAvLyB4LmRvbWFpbihbMCwgZDMubWF4KHRoaXMuZGF0YSwgZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGRbT2JqZWN0LmtleXMoZClbMV1dIH0pXSk7XG4gICAgeS5kb21haW4oWzAsIGQzLm1heCh0aGlzLmRhdGEsIGZ1bmN0aW9uIChkKSB7IHJldHVybiBkW09iamVjdC5rZXlzKGQpWzJdXSB9KV0pO1xuXG4gICAgeC5kb21haW4oW3RoaXMubWlueHZhbHVlLCB0aGlzLm1heHh2YWx1ZV0pO1xuXG5cbiAgICB2YXIgclNjYWxlID0gZDMuc2NhbGVTcXJ0KCkucmFuZ2VSb3VuZChbNiwgMzBdKTtcblxuXG4gICAgclNjYWxlLmRvbWFpbihbZDMubWluKHRoaXMuZGF0YSwgZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGRbT2JqZWN0LmtleXMoZClbNF1dIH0pLCBkMy5tYXgodGhpcy5kYXRhLCBmdW5jdGlvbiAoZCwgaSkgeyByZXR1cm4gZFtPYmplY3Qua2V5cyhkKVs0XV0gfSldKVxuXG5cblxuICAgIGlmKHRoaXMuZGV2aWNlLklzRGVza3RvcCgpPT10cnVlKVxuICAgIHtcbiAgICAgIHRoaXMuc3ZnLmFwcGVuZChcImdcIilcbiAgICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIFwidHJhbnNsYXRlKDAsXCIgKyBoZWlnaHQgKyBcIilcIilcbiAgICAgIC5jYWxsKHhBeGlzKVxuICAgICAgIC5hcHBlbmQoXCJ0ZXh0XCIpXG4gICAgICAgLmF0dHIoXCJ5XCIsIDApXG4gICAgICAgLmF0dHIoXCJ4XCIsIDkpXG4gICAgICAgLmF0dHIoXCJkeVwiLCBcIi4zNWVtXCIpXG4gICAgICAgLnN0eWxlKFwidGV4dC1hbmNob3JcIiwgXCJzdGFydFwiKTtcbiAgICB9XG4gIGVsc2VcbiAgIHtcbiAgICB0aGlzLnN2Zy5hcHBlbmQoXCJnXCIpXG4gICAgLmF0dHIoXCJjbGFzc1wiLCBcInggYXhpc1wiKVxuICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIFwidHJhbnNsYXRlKDAsXCIgKyBoZWlnaHQgKyBcIilcIilcbiAgICAuY2FsbCh4QXhpcykuXG4gICAgIHNlbGVjdEFsbChcInRleHRcIilcbiAgICAgLmF0dHIoXCJ5XCIsIDApXG4gICAgIC5hdHRyKFwieFwiLCA5KVxuICAgICAuYXR0cihcImR5XCIsIFwiLjM1ZW1cIilcbiAgICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgXCJyb3RhdGUoNjApXCIpXG4gICAgIC5zdHlsZShcInRleHQtYW5jaG9yXCIsIFwic3RhcnRcIik7XG4gIH1cbiAgXG4gICAgdGhpcy5zdmcuYXBwZW5kKFwiZ1wiKVxuICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcInkgYXhpc1wiKVxuICAgICAgLmNhbGwoeUF4aXMpXG4gICAgICAuYXBwZW5kKFwidGV4dFwiKVxuICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcImxhYmVsXCIpXG4gICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBcInJvdGF0ZSgtOTApXCIpXG4gICAgICAuYXR0cihcInlcIiwgNilcbiAgICAgIC5hdHRyKFwiZHlcIiwgXCIuNzFlbVwiKVxuICAgICAgLnN0eWxlKFwidGV4dC1hbmNob3JcIiwgXCJlbmRcIilcblxuICAgIHRoaXMucGxvdExpbmUodGhpcy5zdmcsIHgsIHksIGhlaWdodCwgd2lkdGgpO1xuXG4gICAgbGV0IG5vZGUgPSB0aGlzLnN2Zy5zZWxlY3RBbGwoXCIuZG90XCIpXG4gICAgICAuZGF0YSh0aGlzLmJ1YmJsZWNoYXJ0ZGF0YSlcbiAgICAgIC5lbnRlcigpLmFwcGVuZChcImNpcmNsZVwiKVxuICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcImRvdFwiKVxuICAgICAgLmF0dHIoXCJyXCIsIGZ1bmN0aW9uIChkKSB7IHJldHVybiByU2NhbGUoZFtPYmplY3Qua2V5cyhkKVs0XV0pOyB9KVxuICAgICAgLmF0dHIoXCJjdXJzb3JcIiwgXCJwb2ludGVyXCIpXG4gICAgICAuYXR0cihcImN4XCIsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgIHJldHVybiB4KGRbT2JqZWN0LmtleXMoZClbMV1dKTtcbiAgICAgIH0pXG4gICAgICAuYXR0cihcImN5XCIsIGZ1bmN0aW9uIChkKSB7IHJldHVybiB5KGRbT2JqZWN0LmtleXMoZClbMl1dKTsgfSlcbiAgICAgIC5hdHRyKFwiZmlsbFwiLCBmdW5jdGlvbiAoZCwgKSB7IHJldHVybiBkW09iamVjdC5rZXlzKGQpWzVdXSB9KVxuICAgICAgLmF0dHIoJ29wYWNpdHknLCAwLjcpXG4gICAgICAub24oXCJtb3VzZW92ZXJcIiwgKGQpID0+IHtcbiAgICAgICAgcmV0dXJuIHRvb2x0aXAuc3R5bGUoXCJ2aXNpYmlsaXR5XCIsIFwidmlzaWJsZVwiKTtcbiAgICAgIH0pXG4gICAgICAub24oXCJtb3VzZW1vdmVcIiwgKGQpID0+IHtcbiAgICAgICAgcmV0dXJuIHRvb2x0aXAuaHRtbChcbiAgICAgICAgICB0aGlzLmZvcm1Ub29sdGlwRGF0YShkKVxuICAgICAgICApXG4gICAgICAgICAgLnN0eWxlKFwidG9wXCIsIChkMy5ldmVudC5wYWdlWSAtIDEwKSArIFwicHhcIilcbiAgICAgICAgICAuc3R5bGUoXCJsZWZ0XCIsIChkMy5ldmVudC5wYWdlWCArIDEwKSArIFwicHhcIik7XG4gICAgICB9KVxuICAgICAgLm9uKFwibW91c2VvdXRcIiwgKGQpID0+IHtcbiAgICAgICAgcmV0dXJuIHRvb2x0aXAuc3R5bGUoXCJ2aXNpYmlsaXR5XCIsIFwiaGlkZGVuXCIpO1xuICAgICAgfSlcbiAgICAgIC5vbihcImNsaWNrXCIsIChkKSA9PiB7XG4gICAgICAgIHRoaXMuYnViYmxlQ2hhcnRDbGljayhkKTtcbiAgICAgICAgdGhpcy5mb3JkcmlsbGFibGVDbGljayh0aGlzLCBkLCBldmVudCk7XG4gICAgICAgIHJldHVybiB0b29sdGlwLnN0eWxlKFwidmlzaWJpbGl0eVwiLCBcImhpZGRlblwiKTtcbiAgICAgIH0pO1xuICB9XG5cbiAgZm9ybVRvb2x0aXBEYXRhKHRvb2x0aXBEYXRhOiBhbnkpIHtcbiAgICBsZXQgb2JqZWN0ID0ge307XG4gICAgZm9yIChsZXQgW2tleSwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKHRvb2x0aXBEYXRhKSkge1xuICAgICAgaWYgKGtleSAhPSAnY29sb3InKSB7XG4gICAgICAgIG9iamVjdFtrZXldID0gdmFsdWU7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB0aGlzLnRvb2xUaXBGb3JCYXIob2JqZWN0KTtcbiAgfVxuXG4gIC8vIE1ldGhvZCBvbiBjaGFydCBjbGlja1xuICBidWJibGVDaGFydENsaWNrKGV2ZW50OiBhbnkpIHtcbiAgICBsZXQgb2JqZWN0ID0ge307XG4gICAgZm9yIChsZXQgW2tleSwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKGV2ZW50KSkge1xuICAgICAgb2JqZWN0W2tleV0gPSB2YWx1ZTtcbiAgICB9XG4gICAgdGhpcy5jaGFydENsaWNrKG9iamVjdCk7XG4gIH1cblxuICByZXNpemUoZGF0YTogYW55KSB7XG4gICAgdGhpcy5zdmd3aWR0aCA9IDA7XG4gICAgdGhpcy5zdmcuc2VsZWN0QWxsKFwiKlwiKS5yZW1vdmUoKTtcblxuICAgIHRoaXMucmVzaXplZmxhZyA9IHRydWU7XG4gICAgdGhpcy5zdmd3aWR0aCA9IHRoaXMuZGl2aWQubmF0aXZlRWxlbWVudC5vZmZzZXRXaWR0aDtcblxuICAgIHRoaXMucGxvdEJ1YmJsZUNoYXJ0KCk7XG5cbiAgfVxuICB4YXhpc0RhdGEoKSB7XG5cbiAgICBsZXQgYXJyYXkgPSBbXTtcbiAgICB0aGlzLm1pbnh2YWx1ZSA9IDA7XG4gICAgdGhpcy5tYXh4dmFsdWUgPSAwO1xuICAgIHRoaXMueGF4aXNBcnJheSA9IFtdO1xuICAgIHRoaXMueGFycmF5ID0gW107XG4gICAgdGhpcy5kYXRhMS5mb3JFYWNoKGVsZW1lbnQgPT4ge1xuICAgICAgYXJyYXkucHVzaChlbGVtZW50WzFdKTtcbiAgICB9KTtcbiAgICBmb3IgKGxldCBpID0gMTsgaSA8IGFycmF5Lmxlbmd0aDsgaSsrKSB7XG4gICAgICB0aGlzLnhheGlzQXJyYXkucHVzaChhcnJheVtpXSk7XG4gICAgfVxuXG4gICAgbGV0IG1pbnZhbHVlID0gTWF0aC5mbG9vcihkMy5taW4odGhpcy54YXhpc0FycmF5KSk7XG4gICAgbGV0IG1heHZhbHVlID0gTWF0aC5jZWlsKGQzLm1heCh0aGlzLnhheGlzQXJyYXkpKTtcbiAgICB0aGlzLm1pbnh2YWx1ZSA9IDUgKiAoTWF0aC5mbG9vcihNYXRoLmFicyhtaW52YWx1ZSAvIDUpKSk7XG4gICAgdGhpcy5tYXh4dmFsdWUgPSA1ICogKE1hdGguY2VpbChNYXRoLmFicyhtYXh2YWx1ZSAvIDUpKSk7XG5cbiAgfVxuXG4gIGNvbG9yR2VuZXJhdGlvbigpIHtcbiAgICBcbiAgICB0aGlzLmxlZ2VuZGFycmF5ID0gW107XG4gICAgbGV0IGkgPSAwO1xuICAgIGxldCBuYW1lcyA9IHRoaXMuZGF0YTFcbiAgICAgIC5tYXAoZSA9PiBlWzNdKVxuICAgICAgLmZpbHRlcigoZSwgaSwgYSkgPT4gYS5pbmRleE9mKGUpID09PSBpKTtcblxuICAgIGZvciAobGV0IGogPSAxOyBqIDwgbmFtZXMubGVuZ3RoOyBqKyspIHtcbiAgICAgIGxldCB2YWx1ZSA9IFtdO1xuICAgICAgbGV0IG9iaiA9IHsgXCJsYWJlbFwiOiBcIlwiLCBcImNvbG9yXCI6IFwiXCIsIFwidmFsdWVcIjogW10gfTtcbiAgICAgIHRoaXMuY29sb3JkYXRhLmZvckVhY2goZWxlbWVudCA9PiB7XG4gICAgICAgIGlmIChlbGVtZW50W09iamVjdC5rZXlzKGVsZW1lbnQpWzNdXSA9PSBuYW1lc1tqXSkge1xuICAgICAgICAgIGVsZW1lbnRbJ2NvbG9yJ10gPSB0aGlzLnByZWRlZmluZWRjb2xvcnNbaV07XG4gICAgICAgICAgdmFsdWUucHVzaChlbGVtZW50KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICBvYmpbXCJ2YWx1ZVwiXSA9IHZhbHVlO1xuICAgICAgb2JqW1wibGFiZWxcIl0gPSBuYW1lc1tqXTtcbiAgICAgIG9ialtcImNvbG9yXCJdID0gdGhpcy5wcmVkZWZpbmVkY29sb3JzW2ldO1xuICAgICAgdGhpcy5sZWdlbmRhcnJheS5wdXNoKG9iaik7XG4gICAgICBpKys7XG4gICAgfVxuICB9XG5cbiAgZm9ybUxlZ2VuZERhdGEoKSB7XG4gICAgdGhpcy5sZWdlbmREYXRhID0gW107XG4gICAgdGhpcy5sZWdlbmRhcnJheS5mb3JFYWNoKGVsZW1lbnQgPT4ge1xuICAgICAgbGV0IGxlZ2VuZG9iamVjdCA9IHt9O1xuICAgICAgbGVnZW5kb2JqZWN0WydsYWJlbCddID0gZWxlbWVudC5sYWJlbDtcbiAgICAgIGxlZ2VuZG9iamVjdFsnY29sb3InXSA9IGVsZW1lbnQuY29sb3I7XG4gICAgICB0aGlzLmxlZ2VuZERhdGEucHVzaChsZWdlbmRvYmplY3QpO1xuICAgIH0pO1xuICB9XG5cbiAgb25CdWJibGVMZWdlbmRDbGljayhsZWdlbmRldmVudDogYW55KSB7XG4gICAgdGhpcy5sZWdlbmRhcnJheS5mb3JFYWNoKGVsZW1lbnQgPT4ge1xuICAgICAgaWYgKGxlZ2VuZGV2ZW50LmxhYmVsID09IGVsZW1lbnQubGFiZWwpIHtcbiAgICAgICAgdGhpcy5sZWdlbmRDbGljayhlbGVtZW50LnZhbHVlKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICB9XG5cbiAgcGxvdExpbmUoZywgeCwgeSwgaGVpZ2h0LCB3aWR0aCkge1xuICAgIGlmICh0aGlzLnZTY2FsZSkge1xuICAgICAgZy5hcHBlbmQoJ2cnKVxuICAgICAgICAuYXR0cihcImNvbG9yXCIsIFwibGlnaHRncmV5XCIpXG4gICAgICAgIC5hdHRyKCd0cmFuc2Zvcm0nLCAndHJhbnNsYXRlKDAsJyArIGhlaWdodCArICcpJylcbiAgICAgICAgLmNhbGwoZDMuYXhpc0JvdHRvbSh4KS5cbiAgICAgICAgICB0aWNrU2l6ZSgtdGhpcy53aWR0aCkudGlja0Zvcm1hdCgnJylcbiAgICAgICAgKTtcbiAgICB9XG4gICAgaWYgKHRoaXMuaFNjYWxlKSB7XG4gICAgICBnLmFwcGVuZCgnZycpXG4gICAgICAgIC5hdHRyKFwiY29sb3JcIiwgXCJsaWdodGdyZXlcIilcbiAgICAgICAgLmNhbGwoZDMuYXhpc0xlZnQoeSlcbiAgICAgICAgICAudGlja1NpemUoLXdpZHRoKS50aWNrRm9ybWF0KCcnKSk7XG4gICAgfVxuICB9XG5cbiAgdHJhbnNmb3JtZGF0YSgpIHtcbiAgICB0aGlzLmJ1YmJsZWNoYXJ0ZGF0YSA9IFtdXG4gICAgbGV0IGJ1dWJsZWRhdGEgPSBbXTtcbiAgICB0aGlzLmNvbG9yZGF0YS5mb3JFYWNoKChlbGVtZW50LCBpKSA9PiB7XG5cbiAgICAgIGJ1dWJsZWRhdGEucHVzaChlbGVtZW50W09iamVjdC5rZXlzKGVsZW1lbnQpWzRdXSk7XG5cbiAgICB9KTtcblxuXG4gICAgbGV0IGRhdGEgPSBidXVibGVkYXRhLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHsgcmV0dXJuIGIgLSBhIH0pO1xuXG4gICAgZm9yIChsZXQgaiA9IDA7IGogPD0gZGF0YS5sZW5ndGg7IGorKykge1xuICAgICAgdGhpcy5jb2xvcmRhdGEuZm9yRWFjaChlbGVtZW50ID0+IHtcbiAgICAgICAgaWYgKGRhdGFbal0gPT0gZWxlbWVudFtPYmplY3Qua2V5cyhlbGVtZW50KVs0XV0pXG4gICAgICAgICAgdGhpcy5idWJibGVjaGFydGRhdGEucHVzaChlbGVtZW50KTtcbiAgICAgIH0pO1xuICAgIH1cblxuXG5cbiAgfVxuXG59XG4iXX0=