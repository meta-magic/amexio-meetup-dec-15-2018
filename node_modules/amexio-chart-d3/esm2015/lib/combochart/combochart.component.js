/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */
import { Component, Input, ViewChild, ElementRef, } from "@angular/core";
import { AmexioD3BaseChartComponent } from "../base/base.component";
import { CommanDataService } from '../services/comman.data.service';
import * as d3 from 'd3';
import { DeviceQueryService } from '../services/device.query.service';
export class CombochartComponent extends AmexioD3BaseChartComponent {
    /**
     * @param {?} myservice
     * @param {?} device
     */
    constructor(myservice, device) {
        super('combochart');
        this.myservice = myservice;
        this.device = device;
        this.svgwidth = 300;
        this.svgheight = 300;
        this.lineColor = "black";
        this.horizontal = false;
        this.level = 0;
        this.drillabledatakey = [];
        this.hScale = true;
        this.drillableFlag = true;
        this.resizeflag = false;
        this.colorflag = false;
        this.keyArray = [];
        this.transformeddata = [];
        this.legendArray = [];
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        if (this.level <= 1) {
            /** @type {?} */
            let resp;
            if (this.httpmethod && this.httpurl) {
                this.myservice.fetchUrlData(this.httpurl, this.httpmethod).subscribe((response) => {
                    resp = response;
                    this.httpresponse = response;
                }, (error) => {
                }, () => {
                    setTimeout(() => {
                        this.data = this.getResponseData(resp);
                        this.transformData(this.data);
                        this.initializeData();
                        this.plotD3Chart();
                    }, 0);
                });
            }
            else if (this.data) {
                setTimeout(() => {
                    this.data = this.getResponseData(this.data);
                    this.transformData(this.data);
                    this.initializeData();
                    this.plotD3Chart();
                }, 0);
            }
        }
    }
    /**
     * @param {?} data
     * @return {?}
     */
    fetchData(data) {
        /** @type {?} */
        let requestJson;
        /** @type {?} */
        let key = this.drillabledatakey;
        /** @type {?} */
        let resp;
        if (this.drillabledatakey.length) {
            /** @type {?} */
            let drillabledata = this.getMultipleDrillbleKeyData(data, key);
            requestJson = drillabledata;
        }
        else {
            requestJson = data;
        }
        if (this.httpmethod && this.httpurl) {
            this.myservice.postfetchData(this.httpurl, this.httpmethod, requestJson).subscribe((response) => {
                resp = response;
                this.httpresponse = response;
            }, (error) => {
            }, () => {
                setTimeout(() => {
                    // this.data = this.getResponseData(resp);
                    this.drawChart();
                }, 0);
            });
        }
    }
    /**
     * @return {?}
     */
    drawChart() {
        setTimeout(() => {
            this.data = this.getResponseData(this.httpresponse);
            this.transformData(this.data);
            this.initializeData();
            this.plotD3Chart();
        }, 0);
    }
    /**
     * @param {?} httpResponse
     * @return {?}
     */
    getResponseData(httpResponse) {
        /** @type {?} */
        let responsedata = httpResponse;
        if (this.datareader != null) {
            /** @type {?} */
            const dr = this.datareader.split('.');
            for (const ir of dr) {
                responsedata = responsedata[ir];
            }
        }
        else {
            responsedata = httpResponse;
        }
        return responsedata;
    }
    /**
     * @return {?}
     */
    plotD3Chart() {
        this.formLegendData();
        if (this.resizeflag == false) {
            if (this.chartId) {
                this.svgwidth = this.chartId.nativeElement.offsetWidth;
            }
            else {
                this.svgwidth = this.svgwidth;
            }
        }
        /** @type {?} */
        let lineName = this.lineInput;
        /** @type {?} */
        const tooltip = this.toolTip(d3);
        this.svg = d3.select("#" + this.componentId);
        /** @type {?} */
        const margin = { top: 20, right: 20, bottom: 85, left: 60 };
        /** @type {?} */
        const width = this.svgwidth - margin.left - margin.right;
        /** @type {?} */
        let height;
        console.log("offsetheight", this.offsetheight);
        if (this.device.IsDesktop() == true) {
            this.offsetheight = this.chartId.nativeElement.offsetHeight - 20 - 90;
            height = this.offsetheight;
        }
        else {
            height = this.svgheight - margin.top - margin.bottom;
        }
        /** @type {?} */
        let x;
        /** @type {?} */
        let y;
        /** @type {?} */
        const g = this.svg.append("g")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
        if (this.horizontal == false) {
            x = d3.scaleBand()
                .rangeRound([0, width])
                .padding(0.1);
            y = d3.scaleLinear()
                .rangeRound([height, 0]);
            //setting content for x and y axis
            x.domain(this.data.map((d) => {
                return d[Object.keys(d)[0]];
            }));
            /** @type {?} */
            let barRange = d3.max(this.data, (d) => {
                return d[Object.keys(d)[1]];
            });
            /** @type {?} */
            let lineRange = d3.max(this.data, (d) => {
                return d[this.lineInput];
            });
            /** @type {?} */
            let range;
            if (barRange > lineRange) {
                range = barRange;
            }
            else {
                range = lineRange;
            }
            y.domain([0, range]);
            if (this.device.IsDesktop() == true) {
                g.append("g")
                    .attr("transform", "translate(0," + height + ")")
                    .call(d3.axisBottom(x));
            }
            else {
                g.append("g")
                    .attr("transform", "translate(0," + height + ")")
                    .call(d3.axisBottom(x)).
                    selectAll("text")
                    .attr("y", 0)
                    .attr("x", 9)
                    .attr("dy", ".35em")
                    .attr("transform", "rotate(65)")
                    .style("text-anchor", "start");
            }
            //add y axis to svg
            g.append("g")
                .call(d3.axisLeft(y)
                .ticks(10));
            this.plotLine(g, x, y, height, width);
            //add bar chart
            g.selectAll(".bar")
                .data(this.data)
                .enter()
                .append("rect")
                .attr("class", "bar")
                .attr("x", (d) => {
                return x(d[Object.keys(d)[0]]);
            })
                .attr("y", (d) => {
                return y(d[Object.keys(d)[1]]);
            })
                .attr("cursor", "pointer")
                .attr("width", x.bandwidth())
                .attr("height", (d) => { return height - y(d[Object.keys(d)[1]]); })
                .style("fill", (d) => {
                return d.color;
            })
                .on("mouseover", (d) => {
                return tooltip.style("visibility", "visible");
            })
                .on("mousemove", (d) => {
                return tooltip.html(this.formTooltipData(d))
                    .style("top", (d3.event.pageY - 10) + "px")
                    .style("left", (d3.event.pageX + 10) + "px");
            })
                .on("mouseout", (d) => {
                return tooltip.style("visibility", "hidden");
            })
                .on("click", (d) => {
                this.barChartClick(d);
                this.fordrillableClick(this, d, event);
                return tooltip.style("visibility", "hidden");
            });
            //line code start
            /** @type {?} */
            let valueline = d3.line()
                .x(function (d) {
                return x(d[Object.keys(d)[0]]);
            })
                .y(function (d) {
                return y(d[lineName]);
            });
            /** @type {?} */
            let shift = margin.left + x.bandwidth() / 2;
            this.svg.append("path")
                .data([this.data])
                .attr("fill", "none")
                .style("stroke", this.lineColor)
                .attr("stroke-width", 1.5)
                .attr("transform", "translate( " + shift + ", 20 )")
                .attr("d", valueline);
            /** @type {?} */
            let points1 = this.svg.selectAll("circle.point1")
                .data(this.data);
            points1.enter().append("circle")
                .merge(points1)
                .attr("class", "point1")
                .attr("cursor", "pointer")
                .style("stroke", this.lineColor)
                .style("fill", this.lineColor)
                .attr("cx", (d) => {
                return x(d[Object.keys(d)[0]]);
            })
                .attr("cy", (d) => {
                return y(d[lineName]);
            })
                .attr("r", (d) => { return 5; })
                .attr("transform", "translate( " + shift + ", 20 )")
                .on("mouseover", (d) => {
                return tooltip.style("visibility", "visible");
            })
                .on("mousemove", (d) => {
                return tooltip.html(this.formTooltipLineData(d))
                    .style("top", (d3.event.pageY - 10) + "px")
                    .style("left", (d3.event.pageX + 10) + "px");
            })
                .on("mouseout", (d) => {
                return tooltip.style("visibility", "hidden");
            })
                .on("click", (d) => {
                this.onComboLineClick(d);
                this.fordrillableClick(this, d, event);
                return tooltip.style("visibility", "hidden");
            });
            //line code ends
        }
    }
    /**
     * @param {?} g
     * @param {?} x
     * @param {?} y
     * @param {?} height
     * @param {?} width
     * @return {?}
     */
    plotLine(g, x, y, height, width) {
        if (this.hScale) {
            g.append('g')
                .attr("color", "lightgrey")
                .call(d3.axisLeft(y)
                .tickSize(-width).tickFormat(''));
        }
    }
    /**
     * @param {?} tooltipData
     * @return {?}
     */
    formTooltipData(tooltipData) {
        /** @type {?} */
        let object = {};
        for (let [key, value] of Object.entries(tooltipData)) {
            if (key != 'color') {
                object[key] = value;
            }
        }
        return this.toolTipForBar(object);
    }
    /**
     * @param {?} data
     * @return {?}
     */
    transformData(data) {
        this.transformeddata = [];
        this.keyArray = data[0];
        data.forEach((element, index) => {
            if (index > 0) {
                /** @type {?} */
                let DummyObject = {};
                element.forEach((individualvalue, keyindex) => {
                    DummyObject[this.keyArray[keyindex]] = individualvalue;
                }); //inner for loop ends
                this.transformeddata.push(DummyObject);
            } //if ends
        }); //outer for loop ends
        this.data = this.transformeddata;
    }
    /**
     * @return {?}
     */
    formLegendData() {
        this.legendArray = [];
        this.data.forEach(element => {
            /** @type {?} */
            let legendobject = {};
            legendobject['label'] = element[Object.keys(element)[0]];
            legendobject['value'] = element[Object.keys(element)[1]];
            legendobject['color'] = element.color;
            this.legendArray.push(legendobject);
        });
    }
    /**
     * @param {?} legendevent
     * @return {?}
     */
    onBarLegendClick(legendevent) {
        /** @type {?} */
        let obj = {};
        obj[this.keyArray[0]] = legendevent.label;
        obj[this.keyArray[1]] = legendevent.value;
        this.legendClick(obj);
    }
    /**
     * @param {?} event
     * @return {?}
     */
    barChartClick(event) {
        /** @type {?} */
        let object = {};
        for (let [key, value] of Object.entries(event)) {
            if (key != 'color') {
                object[key] = value;
            }
        }
        this.chartClick(object);
    }
    /**
     * @param {?} data
     * @return {?}
     */
    onComboLineClick(data) {
        /** @type {?} */
        let object = {};
        for (let [key, value] of Object.entries(data)) {
            if (key != "color") {
                object[key] = value;
            }
        }
        this.comboLineClick(object);
        //this.chartClick(object);
    }
    /**
     * @param {?} data
     * @return {?}
     */
    formTooltipLineData(data) {
        /** @type {?} */
        let object = {};
        for (let [key, value] of Object.entries(data)) {
            if (key == this.lineInput) {
                object[key] = value;
            }
        }
        return this.toolTipForBar(object);
    }
    /**
     * @return {?}
     */
    resize() {
        this.svgwidth = 0;
        this.svg.selectAll("*").remove();
        this.resizeflag = true;
        this.svgwidth = this.divid.nativeElement.offsetWidth;
        //  this.svgheight=this.offsetheight;
        this.plotD3Chart();
    }
}
CombochartComponent.decorators = [
    { type: Component, args: [{
                selector: 'amexio-d3-combochart',
                template: `<div *ngIf="drillableFlag" #divid (window:resize)="resize()">
<table style="width: 100%;" #chartId >
  <tr>
      <td style="font-size: 18px; font-weight: bold; "> {{title}} </td>
  </tr>
  <tr>
      <td>
          <svg [attr.height]="svgheight" [attr.width]="svgwidth" [attr.id]="componentId">
          </svg>
      </td>
  </tr>
  <tr>
      <td style="display: block; padding: 5px;">
          <amexio-d3-legend *ngIf="legend" [horizontal]="true" (onClick)="onBarLegendClick($event)" [data]="legendArray" style="height:100%;">
          </amexio-d3-legend>
      </td>
  </tr>
</table>
</div>`,
                styles: [``]
            },] },
];
CombochartComponent.ctorParameters = () => [
    { type: CommanDataService },
    { type: DeviceQueryService }
];
CombochartComponent.propDecorators = {
    svgwidth: [{ type: Input, args: ['width',] }],
    svgheight: [{ type: Input, args: ['height',] }],
    lineColor: [{ type: Input, args: ['line-color',] }],
    horizontal: [{ type: Input }],
    chartId: [{ type: ViewChild, args: ['chartId',] }],
    divid: [{ type: ViewChild, args: ['divid',] }],
    datareader: [{ type: Input, args: ['data-reader',] }],
    level: [{ type: Input, args: ['level',] }],
    target: [{ type: Input, args: ['target',] }],
    drillabledatakey: [{ type: Input, args: ['drillable-data',] }],
    lineInput: [{ type: Input, args: ['line-data-index',] }],
    hScale: [{ type: Input, args: ['horizontal-scale',] }]
};
if (false) {
    /** @type {?} */
    CombochartComponent.prototype.svgwidth;
    /** @type {?} */
    CombochartComponent.prototype.svgheight;
    /** @type {?} */
    CombochartComponent.prototype.lineColor;
    /** @type {?} */
    CombochartComponent.prototype.horizontal;
    /** @type {?} */
    CombochartComponent.prototype.chartId;
    /** @type {?} */
    CombochartComponent.prototype.divid;
    /** @type {?} */
    CombochartComponent.prototype.datareader;
    /** @type {?} */
    CombochartComponent.prototype.level;
    /** @type {?} */
    CombochartComponent.prototype.target;
    /** @type {?} */
    CombochartComponent.prototype.drillabledatakey;
    /** @type {?} */
    CombochartComponent.prototype.lineInput;
    /** @type {?} */
    CombochartComponent.prototype.hScale;
    /** @type {?} */
    CombochartComponent.prototype.drillableFlag;
    /** @type {?} */
    CombochartComponent.prototype.resizeflag;
    /** @type {?} */
    CombochartComponent.prototype.data;
    /** @type {?} */
    CombochartComponent.prototype.svg;
    /** @type {?} */
    CombochartComponent.prototype.colorflag;
    /** @type {?} */
    CombochartComponent.prototype.keyArray;
    /** @type {?} */
    CombochartComponent.prototype.transformeddata;
    /** @type {?} */
    CombochartComponent.prototype.object;
    /** @type {?} */
    CombochartComponent.prototype.legendArray;
    /** @type {?} */
    CombochartComponent.prototype.httpresponse;
    /** @type {?} */
    CombochartComponent.prototype.offsetheight;
    /** @type {?} */
    CombochartComponent.prototype.myservice;
    /** @type {?} */
    CombochartComponent.prototype.device;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tYm9jaGFydC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9hbWV4aW8tY2hhcnQtZDMvIiwic291cmNlcyI6WyJsaWIvY29tYm9jaGFydC9jb21ib2NoYXJ0LmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQUUsU0FBUyxFQUFFLFVBQVUsR0FBRyxNQUFNLGVBQWUsQ0FBQztBQUN6RSxPQUFPLEVBQUUsMEJBQTBCLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUVwRSxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxpQ0FBaUMsQ0FBQztBQUNwRSxPQUFPLEtBQUssRUFBRSxNQUFNLElBQUksQ0FBQztBQUV6QixPQUFNLEVBQUMsa0JBQWtCLEVBQUMsTUFBTSxrQ0FBa0MsQ0FBQztBQXdCbkUsTUFBTSwwQkFBMkIsU0FBUSwwQkFBMEI7Ozs7O0lBeUIvRCxZQUFvQixTQUE0QixFQUFTLE1BQXlCO1FBQzlFLEtBQUssQ0FBQyxZQUFZLENBQUMsQ0FBQztRQURKLGNBQVMsR0FBVCxTQUFTLENBQW1CO1FBQVMsV0FBTSxHQUFOLE1BQU0sQ0FBbUI7UUF4QmxFLGFBQVEsR0FBVyxHQUFHLENBQUM7UUFDdEIsY0FBUyxHQUFXLEdBQUcsQ0FBQztRQUNwQixjQUFTLEdBQVcsT0FBTyxDQUFDO1FBQ3hDLGVBQVUsR0FBWSxLQUFLLENBQUM7UUFJckIsVUFBSyxHQUFXLENBQUMsQ0FBQztRQUVULHFCQUFnQixHQUFVLEVBQUUsQ0FBQTtRQUUxQixXQUFNLEdBQWEsSUFBSSxDQUFDO1FBQ25ELGtCQUFhLEdBQVksSUFBSSxDQUFDO1FBQzlCLGVBQVUsR0FBUyxLQUFLLENBQUM7UUFHekIsY0FBUyxHQUFZLEtBQUssQ0FBQztRQUMzQixhQUFRLEdBQVUsRUFBRSxDQUFDO1FBQ3JCLG9CQUFlLEdBQVUsRUFBRSxDQUFDO1FBRTVCLGdCQUFXLEdBQVUsRUFBRSxDQUFDO0lBTXhC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a0JBQWtCOzs7dUJBeUJwQixLQUFLLFNBQUMsT0FBTzt3QkFDYixLQUFLLFNBQUMsUUFBUTt3QkFDZCxLQUFLLFNBQUMsWUFBWTt5QkFDbEIsS0FBSztzQkFDTCxTQUFTLFNBQUMsU0FBUztvQkFDbkIsU0FBUyxTQUFDLE9BQU87eUJBQ2pCLEtBQUssU0FBQyxhQUFhO29CQUNuQixLQUFLLFNBQUMsT0FBTztxQkFDYixLQUFLLFNBQUMsUUFBUTsrQkFDZCxLQUFLLFNBQUMsZ0JBQWdCO3dCQUN0QixLQUFLLFNBQUMsaUJBQWlCO3FCQUN2QixLQUFLLFNBQUMsa0JBQWtCOzs7O0lBWHpCLHVDQUF1Qzs7SUFDdkMsd0NBQXlDOztJQUN6Qyx3Q0FBaUQ7O0lBQ2pELHlDQUFxQzs7SUFDckMsc0NBQTBDOztJQUMxQyxvQ0FBc0M7O0lBQ3RDLHlDQUF5Qzs7SUFDekMsb0NBQWtDOztJQUNsQyxxQ0FBZ0M7O0lBQ2hDLCtDQUFxRDs7SUFDckQsd0NBQXlDOztJQUN6QyxxQ0FBbUQ7O0lBQ25ELDRDQUE4Qjs7SUFDOUIseUNBQXlCOztJQUN6QixtQ0FBVTs7SUFDVixrQ0FBUTs7SUFDUix3Q0FBMkI7O0lBQzNCLHVDQUFxQjs7SUFDckIsOENBQTRCOztJQUM1QixxQ0FBWTs7SUFDWiwwQ0FBd0I7O0lBQ3hCLDJDQUFpQjs7SUFDakIsMkNBQWlCOztJQUVMLHdDQUFvQzs7SUFBQyxxQ0FBaUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIElucHV0LCBWaWV3Q2hpbGQsIEVsZW1lbnRSZWYsIH0gZnJvbSBcIkBhbmd1bGFyL2NvcmVcIjtcbmltcG9ydCB7IEFtZXhpb0QzQmFzZUNoYXJ0Q29tcG9uZW50IH0gZnJvbSBcIi4uL2Jhc2UvYmFzZS5jb21wb25lbnRcIjtcbmltcG9ydCB7IFBsb3RDYXJ0IH0gZnJvbSBcIi4uL2Jhc2UvY2hhcnQuY29tcG9uZW50XCI7XG5pbXBvcnQgeyBDb21tYW5EYXRhU2VydmljZSB9IGZyb20gJy4uL3NlcnZpY2VzL2NvbW1hbi5kYXRhLnNlcnZpY2UnO1xuaW1wb3J0ICogYXMgZDMgZnJvbSAnZDMnO1xuaW1wb3J0IHsgc3RyaW5naWZ5IH0gZnJvbSBcIkBhbmd1bGFyL2NvcmUvc3JjL3JlbmRlcjMvdXRpbFwiO1xuaW1wb3J0e0RldmljZVF1ZXJ5U2VydmljZX0gZnJvbSAnLi4vc2VydmljZXMvZGV2aWNlLnF1ZXJ5LnNlcnZpY2UnO1xuQENvbXBvbmVudCh7XG4gICAgc2VsZWN0b3I6ICdhbWV4aW8tZDMtY29tYm9jaGFydCcsXG4gICAgdGVtcGxhdGU6IGA8ZGl2ICpuZ0lmPVwiZHJpbGxhYmxlRmxhZ1wiICNkaXZpZCAod2luZG93OnJlc2l6ZSk9XCJyZXNpemUoKVwiPlxuPHRhYmxlIHN0eWxlPVwid2lkdGg6IDEwMCU7XCIgI2NoYXJ0SWQgPlxuICA8dHI+XG4gICAgICA8dGQgc3R5bGU9XCJmb250LXNpemU6IDE4cHg7IGZvbnQtd2VpZ2h0OiBib2xkOyBcIj4ge3t0aXRsZX19IDwvdGQ+XG4gIDwvdHI+XG4gIDx0cj5cbiAgICAgIDx0ZD5cbiAgICAgICAgICA8c3ZnIFthdHRyLmhlaWdodF09XCJzdmdoZWlnaHRcIiBbYXR0ci53aWR0aF09XCJzdmd3aWR0aFwiIFthdHRyLmlkXT1cImNvbXBvbmVudElkXCI+XG4gICAgICAgICAgPC9zdmc+XG4gICAgICA8L3RkPlxuICA8L3RyPlxuICA8dHI+XG4gICAgICA8dGQgc3R5bGU9XCJkaXNwbGF5OiBibG9jazsgcGFkZGluZzogNXB4O1wiPlxuICAgICAgICAgIDxhbWV4aW8tZDMtbGVnZW5kICpuZ0lmPVwibGVnZW5kXCIgW2hvcml6b250YWxdPVwidHJ1ZVwiIChvbkNsaWNrKT1cIm9uQmFyTGVnZW5kQ2xpY2soJGV2ZW50KVwiIFtkYXRhXT1cImxlZ2VuZEFycmF5XCIgc3R5bGU9XCJoZWlnaHQ6MTAwJTtcIj5cbiAgICAgICAgICA8L2FtZXhpby1kMy1sZWdlbmQ+XG4gICAgICA8L3RkPlxuICA8L3RyPlxuPC90YWJsZT5cbjwvZGl2PmAsXG4gICAgc3R5bGVzOiBbYGBdXG59KVxuZXhwb3J0IGNsYXNzIENvbWJvY2hhcnRDb21wb25lbnQgZXh0ZW5kcyBBbWV4aW9EM0Jhc2VDaGFydENvbXBvbmVudCBpbXBsZW1lbnRzIFBsb3RDYXJ0IHtcbiAgICBASW5wdXQoJ3dpZHRoJykgc3Znd2lkdGg6IG51bWJlciA9IDMwMDtcbiAgICBASW5wdXQoJ2hlaWdodCcpIHN2Z2hlaWdodDogbnVtYmVyID0gMzAwO1xuICAgIEBJbnB1dCgnbGluZS1jb2xvcicpIGxpbmVDb2xvcjogc3RyaW5nID0gXCJibGFja1wiO1xuICAgIEBJbnB1dCgpIGhvcml6b250YWw6IGJvb2xlYW4gPSBmYWxzZTtcbiAgICBAVmlld0NoaWxkKCdjaGFydElkJykgY2hhcnRJZDogRWxlbWVudFJlZjtcbiAgICBAVmlld0NoaWxkKCdkaXZpZCcpIGRpdmlkOiBFbGVtZW50UmVmO1xuICAgIEBJbnB1dCgnZGF0YS1yZWFkZXInKSBkYXRhcmVhZGVyOiBzdHJpbmc7XG4gICAgQElucHV0KCdsZXZlbCcpIGxldmVsOiBudW1iZXIgPSAwO1xuICAgIEBJbnB1dCgndGFyZ2V0JykgdGFyZ2V0OiBudW1iZXI7XG4gICAgQElucHV0KCdkcmlsbGFibGUtZGF0YScpIGRyaWxsYWJsZWRhdGFrZXk6IGFueVtdID0gW11cbiAgICBASW5wdXQoJ2xpbmUtZGF0YS1pbmRleCcpIGxpbmVJbnB1dDogYW55O1xuICAgIEBJbnB1dCgnaG9yaXpvbnRhbC1zY2FsZScpIGhTY2FsZSA6IGJvb2xlYW4gPSB0cnVlO1xuICAgIGRyaWxsYWJsZUZsYWc6IGJvb2xlYW4gPSB0cnVlO1xuICAgIHJlc2l6ZWZsYWc6Ym9vbGVhbj1mYWxzZTtcbiAgICBkYXRhOiBhbnk7XG4gICAgc3ZnOmFueTtcbiAgICBjb2xvcmZsYWc6IGJvb2xlYW4gPSBmYWxzZTtcbiAgICBrZXlBcnJheTogYW55W10gPSBbXTtcbiAgICB0cmFuc2Zvcm1lZGRhdGE6IGFueVtdID0gW107XG4gICAgb2JqZWN0OiBhbnk7XG4gICAgbGVnZW5kQXJyYXk6IGFueVtdID0gW107XG4gICAgaHR0cHJlc3BvbnNlOmFueTtcbiAgICBvZmZzZXRoZWlnaHQ6YW55O1xuICAgXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBteXNlcnZpY2U6IENvbW1hbkRhdGFTZXJ2aWNlLHByaXZhdGUgZGV2aWNlOkRldmljZVF1ZXJ5U2VydmljZSkge1xuICAgICAgICBzdXBlcignY29tYm9jaGFydCcpO1xuICAgIH1cbiAgICBuZ09uSW5pdCgpIHtcbiAgICAgIFxuICAgICAgICBpZiAodGhpcy5sZXZlbCA8PSAxKSB7XG4gICAgICAgICAgICBsZXQgcmVzcDogYW55O1xuICAgICAgICAgICAgaWYgKHRoaXMuaHR0cG1ldGhvZCAmJiB0aGlzLmh0dHB1cmwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLm15c2VydmljZS5mZXRjaFVybERhdGEodGhpcy5odHRwdXJsLCB0aGlzLmh0dHBtZXRob2QpLnN1YnNjcmliZSgocmVzcG9uc2UpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgcmVzcCA9IHJlc3BvbnNlO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmh0dHByZXNwb25zZT1yZXNwb25zZTtcbiAgICAgICAgICAgICAgICB9LCAoZXJyb3IpID0+IHtcbiAgICAgICAgICAgICAgICB9LCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kYXRhID0gdGhpcy5nZXRSZXNwb25zZURhdGEocmVzcCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRyYW5zZm9ybURhdGEodGhpcy5kYXRhKVxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbml0aWFsaXplRGF0YSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wbG90RDNDaGFydCgpO1xuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgfSwgMCk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5kYXRhKSB7XG5cbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kYXRhID0gdGhpcy5nZXRSZXNwb25zZURhdGEodGhpcy5kYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50cmFuc2Zvcm1EYXRhKHRoaXMuZGF0YSlcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbml0aWFsaXplRGF0YSgpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBsb3REM0NoYXJ0KCk7XG5cbiAgICAgICAgICAgICAgICB9LCAwKTtcblxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIGZldGNoRGF0YShkYXRhOiBhbnkpIHtcblxuICAgICAgICBsZXQgcmVxdWVzdEpzb247XG4gICAgICAgIGxldCBrZXkgPSB0aGlzLmRyaWxsYWJsZWRhdGFrZXk7XG4gICAgICAgIGxldCByZXNwOiBhbnk7XG4gICAgICAgIGlmICh0aGlzLmRyaWxsYWJsZWRhdGFrZXkubGVuZ3RoKSB7XG4gICAgICAgICAgICBsZXQgZHJpbGxhYmxlZGF0YSA9IHRoaXMuZ2V0TXVsdGlwbGVEcmlsbGJsZUtleURhdGEoZGF0YSwga2V5KTtcbiAgICAgICAgICAgIHJlcXVlc3RKc29uID0gZHJpbGxhYmxlZGF0YTtcblxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmVxdWVzdEpzb24gPSBkYXRhO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmh0dHBtZXRob2QgJiYgdGhpcy5odHRwdXJsKSB7XG4gICAgICAgICAgICB0aGlzLm15c2VydmljZS5wb3N0ZmV0Y2hEYXRhKHRoaXMuaHR0cHVybCwgdGhpcy5odHRwbWV0aG9kLCByZXF1ZXN0SnNvbikuc3Vic2NyaWJlKChyZXNwb25zZSkgPT4ge1xuICAgICAgICAgICAgICAgIHJlc3AgPSByZXNwb25zZTtcbiAgICAgICAgICAgICAgICB0aGlzLmh0dHByZXNwb25zZT1yZXNwb25zZTtcbiAgICAgICAgICAgIH0sIChlcnJvcikgPT4ge1xuICAgICAgICAgICAgfSwgKCkgPT4ge1xuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgIC8vIHRoaXMuZGF0YSA9IHRoaXMuZ2V0UmVzcG9uc2VEYXRhKHJlc3ApO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmRyYXdDaGFydCgpO1xuICAgICAgICAgICAgICAgIH0sIDApO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBkcmF3Q2hhcnQoKSB7XG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4geyBcbiAgICAgICAgICAgIHRoaXMuZGF0YSA9IHRoaXMuZ2V0UmVzcG9uc2VEYXRhKHRoaXMuaHR0cHJlc3BvbnNlKTtcbiAgICAgICAgICAgIHRoaXMudHJhbnNmb3JtRGF0YSh0aGlzLmRhdGEpXG4gICAgICAgICAgICB0aGlzLmluaXRpYWxpemVEYXRhKCk7XG4gICAgICAgICAgICB0aGlzLnBsb3REM0NoYXJ0KCk7XG4gICAgICAgIH0sIDApO1xuXG4gICAgfVxuICAgIGdldFJlc3BvbnNlRGF0YShodHRwUmVzcG9uc2U6IGFueSkge1xuICAgICAgICBsZXQgcmVzcG9uc2VkYXRhID0gaHR0cFJlc3BvbnNlO1xuICAgICAgICBpZiAodGhpcy5kYXRhcmVhZGVyICE9IG51bGwpIHtcbiAgICAgICAgICAgIGNvbnN0IGRyID0gdGhpcy5kYXRhcmVhZGVyLnNwbGl0KCcuJyk7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGlyIG9mIGRyKSB7XG4gICAgICAgICAgICAgICAgcmVzcG9uc2VkYXRhID0gcmVzcG9uc2VkYXRhW2lyXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJlc3BvbnNlZGF0YSA9IGh0dHBSZXNwb25zZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVzcG9uc2VkYXRhO1xuICAgIH1cblxuICAgIHBsb3REM0NoYXJ0KCkge1xuXG4gICAgICAgIHRoaXMuZm9ybUxlZ2VuZERhdGEoKTtcbiAgICAgICAgaWYodGhpcy5yZXNpemVmbGFnPT1mYWxzZSlcbiAgICAgICAge1xuICAgICAgICBpZiAodGhpcy5jaGFydElkKSB7XG4gICAgICAgICAgICB0aGlzLnN2Z3dpZHRoID0gdGhpcy5jaGFydElkLm5hdGl2ZUVsZW1lbnQub2Zmc2V0V2lkdGg7XG4gICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgIHRoaXMuc3Znd2lkdGggPSB0aGlzLnN2Z3dpZHRoO1xuICAgICAgICB9XG4gICAgfSAgXG4gICAgICAgIGxldCBsaW5lTmFtZTogYW55ID0gdGhpcy5saW5lSW5wdXQ7XG5cbiAgICAgICAgY29uc3QgdG9vbHRpcCA9IHRoaXMudG9vbFRpcChkMyk7XG4gICAgICAgIHRoaXMuc3ZnID0gZDMuc2VsZWN0KFwiI1wiICsgdGhpcy5jb21wb25lbnRJZCk7XG4gICAgICAgIGNvbnN0IG1hcmdpbiA9IHsgdG9wOiAyMCwgcmlnaHQ6IDIwLCBib3R0b206IDg1LCBsZWZ0OiA2MCB9O1xuICAgICAgICBjb25zdCB3aWR0aCA9IHRoaXMuc3Znd2lkdGggLSBtYXJnaW4ubGVmdCAtIG1hcmdpbi5yaWdodDtcbiAgICAgICAgbGV0IGhlaWdodDtcbiAgICAgXG5cbiAgICAgICAgY29uc29sZS5sb2coXCJvZmZzZXRoZWlnaHRcIix0aGlzLm9mZnNldGhlaWdodCk7XG4gICAgICAgIGlmKHRoaXMuZGV2aWNlLklzRGVza3RvcCgpPT10cnVlKVxuICAgICAgICB7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHRoaXMub2Zmc2V0aGVpZ2h0ID0gdGhpcy5jaGFydElkLm5hdGl2ZUVsZW1lbnQub2Zmc2V0SGVpZ2h0LTIwLTkwO1xuICAgICAgICAgICAgICAgaGVpZ2h0ID0gIHRoaXMub2Zmc2V0aGVpZ2h0O1xuICAgICAgICB9XG4gICAgICAgIGVsc2V7XG4gICAgICAgICAgICAgICAgIGhlaWdodD10aGlzLnN2Z2hlaWdodC1tYXJnaW4udG9wLW1hcmdpbi5ib3R0b207XG4gICAgICAgICAgfVxuICAgICAgICBsZXQgeCwgeTtcbiAgICAgICAgY29uc3QgZyA9IHRoaXMuc3ZnLmFwcGVuZChcImdcIilcbiAgICAgICAgICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIFwidHJhbnNsYXRlKFwiICsgbWFyZ2luLmxlZnQgKyBcIixcIiArIG1hcmdpbi50b3AgKyBcIilcIik7XG4gICAgICAgIGlmICh0aGlzLmhvcml6b250YWwgPT0gZmFsc2UpIHtcbiAgICAgICAgICAgIHggPSBkMy5zY2FsZUJhbmQoKVxuICAgICAgICAgICAgICAgIC5yYW5nZVJvdW5kKFswLCB3aWR0aF0pXG4gICAgICAgICAgICAgICAgLnBhZGRpbmcoMC4xKTtcbiAgICAgICAgICAgIHkgPSBkMy5zY2FsZUxpbmVhcigpXG4gICAgICAgICAgICAgICAgLnJhbmdlUm91bmQoW2hlaWdodCwgMF0pO1xuXG4gICAgICAgICAgICAvL3NldHRpbmcgY29udGVudCBmb3IgeCBhbmQgeSBheGlzXG4gICAgICAgICAgICB4LmRvbWFpbih0aGlzLmRhdGEubWFwKChkKSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRbT2JqZWN0LmtleXMoZClbMF1dO1xuICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgbGV0IGJhclJhbmdlID0gZDMubWF4KHRoaXMuZGF0YSwgKGQpID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZFtPYmplY3Qua2V5cyhkKVsxXV07XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgbGV0IGxpbmVSYW5nZSA9IGQzLm1heCh0aGlzLmRhdGEsIChkKSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRbdGhpcy5saW5lSW5wdXRdO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIGxldCByYW5nZTtcbiAgICAgICAgICAgIGlmIChiYXJSYW5nZSA+IGxpbmVSYW5nZSkge1xuICAgICAgICAgICAgICAgIHJhbmdlID0gYmFyUmFuZ2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICByYW5nZSA9IGxpbmVSYW5nZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHkuZG9tYWluKFswLCByYW5nZV0pO1xuXG5cbiAgICAgICAgICAgIGlmKHRoaXMuZGV2aWNlLklzRGVza3RvcCgpPT10cnVlKVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBnLmFwcGVuZChcImdcIilcbiAgICAgICAgICAgICAgICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIFwidHJhbnNsYXRlKDAsXCIgKyBoZWlnaHQgKyBcIilcIilcbiAgICAgICAgICAgICAgICAgIC5jYWxsKGQzLmF4aXNCb3R0b20oeCkpXG4gICAgICAgICAgICB9XG4gICAgICAgICAgZWxzZVxuICAgICAgICAgICB7XG4gICAgICAgICAgICBnLmFwcGVuZChcImdcIilcbiAgICAgICAgICAgICAgICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIFwidHJhbnNsYXRlKDAsXCIgKyBoZWlnaHQgKyBcIilcIilcbiAgICAgICAgICAgICAgICAgIC5jYWxsKGQzLmF4aXNCb3R0b20oeCkpLlxuICAgICAgICAgICAgICAgICAgIHNlbGVjdEFsbChcInRleHRcIilcbiAgICAgICAgICAgICAgICAgICAuYXR0cihcInlcIiwgMClcbiAgICAgICAgICAgICAgICAgICAuYXR0cihcInhcIiwgOSlcbiAgICAgICAgICAgICAgICAgICAuYXR0cihcImR5XCIsIFwiLjM1ZW1cIilcbiAgICAgICAgICAgICAgICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBcInJvdGF0ZSg2NSlcIilcbiAgICAgICAgICAgICAgICAgICAuc3R5bGUoXCJ0ZXh0LWFuY2hvclwiLCBcInN0YXJ0XCIpO1xuICAgICBcbiAgICAgICAgICB9XG4gICAgICAgICAgICAvL2FkZCB5IGF4aXMgdG8gc3ZnXG4gICAgICAgICAgICBnLmFwcGVuZChcImdcIilcbiAgICAgICAgICAgICAgICAuY2FsbChkMy5heGlzTGVmdCh5KVxuICAgICAgICAgICAgICAgICAgICAudGlja3MoMTApKVxuXG4gICAgICAgICAgIHRoaXMucGxvdExpbmUoZyx4LHksaGVpZ2h0LHdpZHRoKTsgXG4gICAgICAgICAgIFxuICAgICAgICAgICAgLy9hZGQgYmFyIGNoYXJ0XG4gICAgICAgICAgICBnLnNlbGVjdEFsbChcIi5iYXJcIilcbiAgICAgICAgICAgICAgICAuZGF0YSh0aGlzLmRhdGEpXG4gICAgICAgICAgICAgICAgLmVudGVyKClcbiAgICAgICAgICAgICAgICAuYXBwZW5kKFwicmVjdFwiKVxuICAgICAgICAgICAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJiYXJcIilcbiAgICAgICAgICAgICAgICAuYXR0cihcInhcIiwgKGQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHgoZFtPYmplY3Qua2V5cyhkKVswXV0pO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmF0dHIoXCJ5XCIsIChkKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB5KGRbT2JqZWN0LmtleXMoZClbMV1dKTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5hdHRyKFwiY3Vyc29yXCIsIFwicG9pbnRlclwiKVxuICAgICAgICAgICAgICAgIC5hdHRyKFwid2lkdGhcIiwgeC5iYW5kd2lkdGgoKSlcbiAgICAgICAgICAgICAgICAuYXR0cihcImhlaWdodFwiLCAoZCkgPT4geyByZXR1cm4gaGVpZ2h0IC0geShkW09iamVjdC5rZXlzKGQpWzFdXSk7IH0pXG4gICAgICAgICAgICAgICAgLnN0eWxlKFwiZmlsbFwiLCAoZCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZC5jb2xvcjtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5vbihcIm1vdXNlb3ZlclwiLCAoZCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdG9vbHRpcC5zdHlsZShcInZpc2liaWxpdHlcIiwgXCJ2aXNpYmxlXCIpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLm9uKFwibW91c2Vtb3ZlXCIsIChkKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0b29sdGlwLmh0bWwoXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZvcm1Ub29sdGlwRGF0YShkKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIC5zdHlsZShcInRvcFwiLCAoZDMuZXZlbnQucGFnZVkgLSAxMCkgKyBcInB4XCIpXG4gICAgICAgICAgICAgICAgICAgICAgICAuc3R5bGUoXCJsZWZ0XCIsIChkMy5ldmVudC5wYWdlWCArIDEwKSArIFwicHhcIik7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAub24oXCJtb3VzZW91dFwiLCAoZCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdG9vbHRpcC5zdHlsZShcInZpc2liaWxpdHlcIiwgXCJoaWRkZW5cIik7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAub24oXCJjbGlja1wiLCAoZCkgPT4ge1xuXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYmFyQ2hhcnRDbGljayhkKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5mb3JkcmlsbGFibGVDbGljayh0aGlzLCBkLGV2ZW50KTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRvb2x0aXAuc3R5bGUoXCJ2aXNpYmlsaXR5XCIsIFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgLy9saW5lIGNvZGUgc3RhcnRcbiAgICAgICAgICAgIGxldCB2YWx1ZWxpbmUgPSBkMy5saW5lKClcbiAgICAgICAgICAgICAgICAueChmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4geChcbiAgICAgICAgICAgICAgICAgICAgICAgIGRbT2JqZWN0LmtleXMoZClbMF1dXG4gICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAueShmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4geShcbiAgICAgICAgICAgICAgICAgICAgICAgIGRbbGluZU5hbWVdXG4gICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGxldCBzaGlmdCA9IG1hcmdpbi5sZWZ0ICsgeC5iYW5kd2lkdGgoKSAvIDI7XG4gICAgICAgICAgICB0aGlzLnN2Zy5hcHBlbmQoXCJwYXRoXCIpXG4gICAgICAgICAgICAgICAgLmRhdGEoW3RoaXMuZGF0YV0pXG4gICAgICAgICAgICAgICAgLmF0dHIoXCJmaWxsXCIsIFwibm9uZVwiKVxuICAgICAgICAgICAgICAgIC5zdHlsZShcInN0cm9rZVwiLCB0aGlzLmxpbmVDb2xvcilcbiAgICAgICAgICAgICAgICAuYXR0cihcInN0cm9rZS13aWR0aFwiLCAxLjUpXG4gICAgICAgICAgICAgICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgXCJ0cmFuc2xhdGUoIFwiICsgc2hpZnQgKyBcIiwgMjAgKVwiKVxuICAgICAgICAgICAgICAgIC5hdHRyKFwiZFwiLCB2YWx1ZWxpbmUpO1xuICAgICAgICAgICAgbGV0IHBvaW50czEgPSB0aGlzLnN2Zy5zZWxlY3RBbGwoXCJjaXJjbGUucG9pbnQxXCIpXG4gICAgICAgICAgICAgICAgLmRhdGEodGhpcy5kYXRhKVxuXG4gICAgICAgICAgICBwb2ludHMxLmVudGVyKCkuYXBwZW5kKFwiY2lyY2xlXCIpXG4gICAgICAgICAgICAgICAgLm1lcmdlKHBvaW50czEpXG4gICAgICAgICAgICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcInBvaW50MVwiKVxuICAgICAgICAgICAgICAgIC5hdHRyKFwiY3Vyc29yXCIsIFwicG9pbnRlclwiKVxuICAgICAgICAgICAgICAgIC5zdHlsZShcInN0cm9rZVwiLCB0aGlzLmxpbmVDb2xvcilcbiAgICAgICAgICAgICAgICAuc3R5bGUoXCJmaWxsXCIsIHRoaXMubGluZUNvbG9yKVxuICAgICAgICAgICAgICAgIC5hdHRyKFwiY3hcIiwgKGQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHgoXG4gICAgICAgICAgICAgICAgICAgICAgICBkW09iamVjdC5rZXlzKGQpWzBdXVxuICAgICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmF0dHIoXCJjeVwiLCAoZCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4geShcbiAgICAgICAgICAgICAgICAgICAgICAgIGRbbGluZU5hbWVdXG4gICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuYXR0cihcInJcIiwgKGQpID0+IHsgcmV0dXJuIDU7IH0pXG4gICAgICAgICAgICAgICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgXCJ0cmFuc2xhdGUoIFwiICsgc2hpZnQgKyBcIiwgMjAgKVwiKVxuICAgICAgICAgICAgICAgIC5vbihcIm1vdXNlb3ZlclwiLCAoZCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdG9vbHRpcC5zdHlsZShcInZpc2liaWxpdHlcIiwgXCJ2aXNpYmxlXCIpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLm9uKFwibW91c2Vtb3ZlXCIsIChkKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0b29sdGlwLmh0bWwoXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZvcm1Ub29sdGlwTGluZURhdGEoZCkpXG4gICAgICAgICAgICAgICAgICAgICAgICAuc3R5bGUoXCJ0b3BcIiwgKGQzLmV2ZW50LnBhZ2VZIC0gMTApICsgXCJweFwiKVxuICAgICAgICAgICAgICAgICAgICAgICAgLnN0eWxlKFwibGVmdFwiLCAoZDMuZXZlbnQucGFnZVggKyAxMCkgKyBcInB4XCIpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLm9uKFwibW91c2VvdXRcIiwgKGQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRvb2x0aXAuc3R5bGUoXCJ2aXNpYmlsaXR5XCIsIFwiaGlkZGVuXCIpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLm9uKFwiY2xpY2tcIiwgKGQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5vbkNvbWJvTGluZUNsaWNrKGQpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmZvcmRyaWxsYWJsZUNsaWNrKHRoaXMsIGQsZXZlbnQpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdG9vbHRpcC5zdHlsZShcInZpc2liaWxpdHlcIiwgXCJoaWRkZW5cIik7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAvL2xpbmUgY29kZSBlbmRzXG4gICAgICAgIH1cblxuXG4gICAgfVxuXG4gICAgcGxvdExpbmUoZyx4LHksaGVpZ2h0LHdpZHRoKVxue1xuXG4gICAgaWYodGhpcy5oU2NhbGUpe1xuICAgICAgICBnLmFwcGVuZCgnZycpXG4gICAgICAgICAgICAuYXR0cihcImNvbG9yXCIsIFwibGlnaHRncmV5XCIpXG4gICAgICAgICAgICAuY2FsbChkMy5heGlzTGVmdCh5KVxuICAgICAgICAgICAgLiB0aWNrU2l6ZSgtd2lkdGgpLnRpY2tGb3JtYXQoJycpKTsgICAgIFxuICAgIH1cbn1cbiAgICBmb3JtVG9vbHRpcERhdGEodG9vbHRpcERhdGE6IGFueSkge1xuICAgICAgICBsZXQgb2JqZWN0ID0ge307XG4gICAgICAgIGZvciAobGV0IFtrZXksIHZhbHVlXSBvZiBPYmplY3QuZW50cmllcyh0b29sdGlwRGF0YSkpIHtcbiAgICAgICAgICAgIGlmIChrZXkgIT0gJ2NvbG9yJykge1xuICAgICAgICAgICAgICAgIG9iamVjdFtrZXldID0gdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMudG9vbFRpcEZvckJhcihvYmplY3QpO1xuICAgIH1cblxuICAgIHRyYW5zZm9ybURhdGEoZGF0YTogYW55KSB7XG4gICAgICAgIHRoaXMudHJhbnNmb3JtZWRkYXRhPVtdO1xuICAgICAgICB0aGlzLmtleUFycmF5ID0gZGF0YVswXTtcbiAgIFxuICAgICAgICBkYXRhLmZvckVhY2goKGVsZW1lbnQsIGluZGV4KSA9PiB7XG4gICAgICAgICAgICBpZiAoaW5kZXggPiAwKSB7XG4gICAgICAgICAgICAgICAgbGV0IER1bW15T2JqZWN0ID0ge307XG4gICAgICAgICAgICAgICAgZWxlbWVudC5mb3JFYWNoKChpbmRpdmlkdWFsdmFsdWUsIGtleWluZGV4KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIER1bW15T2JqZWN0W3RoaXMua2V5QXJyYXlba2V5aW5kZXhdXSA9IGluZGl2aWR1YWx2YWx1ZTtcbiAgICAgICAgICAgICAgICB9KTsvL2lubmVyIGZvciBsb29wIGVuZHNcbiAgICAgICAgICAgICAgICB0aGlzLnRyYW5zZm9ybWVkZGF0YS5wdXNoKER1bW15T2JqZWN0KTtcbiAgICAgICAgICAgIH0vL2lmIGVuZHNcbiAgICAgICAgfSk7Ly9vdXRlciBmb3IgbG9vcCBlbmRzXG4gICAgICAgIHRoaXMuZGF0YSA9IHRoaXMudHJhbnNmb3JtZWRkYXRhO1xuICAgIH1cblxuICAgIGZvcm1MZWdlbmREYXRhKCkge1xuICAgICAgICB0aGlzLmxlZ2VuZEFycmF5ID0gW107XG4gICAgICAgIHRoaXMuZGF0YS5mb3JFYWNoKGVsZW1lbnQgPT4ge1xuICAgICAgICAgICAgbGV0IGxlZ2VuZG9iamVjdCA9IHt9O1xuICAgICAgICAgICAgbGVnZW5kb2JqZWN0WydsYWJlbCddID0gZWxlbWVudFtPYmplY3Qua2V5cyhlbGVtZW50KVswXV07XG4gICAgICAgICAgICBsZWdlbmRvYmplY3RbJ3ZhbHVlJ10gPSBlbGVtZW50W09iamVjdC5rZXlzKGVsZW1lbnQpWzFdXTtcbiAgICAgICAgICAgIGxlZ2VuZG9iamVjdFsnY29sb3InXSA9IGVsZW1lbnQuY29sb3I7XG4gICAgICAgICAgICB0aGlzLmxlZ2VuZEFycmF5LnB1c2gobGVnZW5kb2JqZWN0KTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgb25CYXJMZWdlbmRDbGljayhsZWdlbmRldmVudDogYW55KSB7XG4gICAgICAgIGxldCBvYmogPSB7fTtcbiAgICAgICAgb2JqW3RoaXMua2V5QXJyYXlbMF1dID0gbGVnZW5kZXZlbnQubGFiZWw7XG4gICAgICAgIG9ialt0aGlzLmtleUFycmF5WzFdXSA9IGxlZ2VuZGV2ZW50LnZhbHVlO1xuICAgICAgICB0aGlzLmxlZ2VuZENsaWNrKG9iaik7XG4gICAgfVxuXG5cbiAgICBiYXJDaGFydENsaWNrKGV2ZW50OiBhbnkpIHtcbiAgICAgICAgbGV0IG9iamVjdCA9IHt9O1xuICAgICAgICBmb3IgKGxldCBba2V5LCB2YWx1ZV0gb2YgT2JqZWN0LmVudHJpZXMoZXZlbnQpKSB7XG4gICAgICAgICAgICBpZiAoa2V5ICE9ICdjb2xvcicpIHtcbiAgICAgICAgICAgICAgICBvYmplY3Rba2V5XSA9IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMuY2hhcnRDbGljayhvYmplY3QpO1xuICAgIH1cblxuICAgIG9uQ29tYm9MaW5lQ2xpY2soZGF0YTogYW55KSB7XG4gICAgICAgIGxldCBvYmplY3QgPSB7fTtcbiAgICAgICAgZm9yIChsZXQgW2tleSwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKGRhdGEpKSB7XG4gICAgICAgICAgICBpZiAoa2V5ICE9IFwiY29sb3JcIikge1xuICAgICAgICAgICAgICAgIG9iamVjdFtrZXldID0gdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5jb21ib0xpbmVDbGljayhvYmplY3QpO1xuICAgICAgICAvL3RoaXMuY2hhcnRDbGljayhvYmplY3QpO1xuICAgIH1cblxuICAgIGZvcm1Ub29sdGlwTGluZURhdGEoZGF0YTogYW55KSB7XG4gICAgICAgIGxldCBvYmplY3QgPSB7fTtcbiAgICAgICAgZm9yIChsZXQgW2tleSwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKGRhdGEpKSB7XG4gICAgICAgICAgICBpZiAoa2V5ID09IHRoaXMubGluZUlucHV0KSB7XG4gICAgICAgICAgICAgICAgb2JqZWN0W2tleV0gPSB2YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy50b29sVGlwRm9yQmFyKG9iamVjdCk7XG4gICAgfVxuXG4gICAgcmVzaXplKCkge1xuXG4gICAgICAgIHRoaXMuc3Znd2lkdGggPSAwO1xuICAgICAgdGhpcy5zdmcuc2VsZWN0QWxsKFwiKlwiKS5yZW1vdmUoKTtcblxuICAgICB0aGlzLnJlc2l6ZWZsYWcgPSB0cnVlO1xuICAgICB0aGlzLnN2Z3dpZHRoID0gdGhpcy5kaXZpZC5uYXRpdmVFbGVtZW50Lm9mZnNldFdpZHRoO1xuICAgLy8gIHRoaXMuc3ZnaGVpZ2h0PXRoaXMub2Zmc2V0aGVpZ2h0O1xuICAgICB0aGlzLnBsb3REM0NoYXJ0KCk7XG5cbiAgICB9XG5cblxufVxuIl19