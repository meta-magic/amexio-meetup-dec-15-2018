/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */
import { Input } from "@angular/core";
import * as d3 from 'd3';
import { AmexioD3BaseChartComponent } from "../base/base.component";
export class AmexioD3BaseLineComponent extends AmexioD3BaseChartComponent {
    /**
     * @param {?} deviceQueryService
     */
    constructor(deviceQueryService) {
        super('line');
        this.deviceQueryService = deviceQueryService;
        this.svgheight = 300;
        this.hScale = true;
        this.vScale = false;
    }
    /**
     * @param {?} v
     * @return {?}
     */
    set data(v) {
        this._data = v;
        this.createXYAxisData();
    }
    /**
     * @return {?}
     */
    get data() {
        return this._data;
    }
    /**
     * @return {?}
     */
    createXYAxisData() {
        this.xaxisdata = [];
        this.yaxisdata = [];
        this.multiseriesdata = [];
        this.legenddata = [];
        this.legends = [];
        this.xaxisname = this.data[0][0].label;
        /** @type {?} */
        const msdarray = [];
        for (let index = 0; index < this._data[0].length; index++) {
            /** @type {?} */
            const legend = this._data[0][index];
            msdarray[index] = [];
            this.legenddata.push({ 'label': legend.label, 'color': this.predefinedcolors[index + 1] });
            if (index > 0)
                this.legends.push({ 'label': legend.label, 'color': this.predefinedcolors[index] });
        }
        /** @type {?} */
        let i = 0;
        this._data.forEach(object => {
            if (i > 0) {
                /** @type {?} */
                let j = 0;
                object.forEach(a => {
                    if (j === 0) {
                        this.xaxisdata.push({ 'label': a, 'value': a });
                    }
                    else {
                        this.yaxisdata.push({ 'label': a, 'value': a });
                    }
                    msdarray[j].push(a);
                    j++;
                });
            }
            i++;
        });
        for (let index = 0; index < msdarray.length; index++) {
            /** @type {?} */
            const element = msdarray[index];
            if (index > 0) {
                /** @type {?} */
                let md = [];
                for (let j = 0; j < element.length; j++) {
                    /** @type {?} */
                    const v = element[j];
                    md.push({ 'legend': this.legenddata[index].label, 'label': this.xaxisdata[j].value, 'value': v });
                }
                this.multiseriesdata.push(md);
                this.legends[index - 1].data = md;
            }
        }
    }
    /**
     * @return {?}
     */
    initChart() {
        this.svg = d3.select("#" + this.componentId);
        /** @type {?} */
        const margin = { top: 40, right: 20, bottom: 30, left: 40 };
        /** @type {?} */
        const width = +this.svgwidth - margin.left - margin.right;
        /** @type {?} */
        const height = +this.svgheight - margin.top - margin.bottom;
        /** @type {?} */
        const g = this.svg.append("g").attr("transform", "translate(" + margin.left + "," + margin.top + ")");
        /** @type {?} */
        const x = d3.scaleBand()
            .rangeRound([0, width])
            .padding(0.1);
        /** @type {?} */
        const y = d3.scaleLinear()
            .rangeRound([height, 0]);
        x.domain(this.xaxisdata.map((d) => { return d.label; }));
        y.domain([0, d3.max(this.yaxisdata, (d) => { return d.value; })]);
        //add axis 
        if (this.deviceQueryService.IsDesktop() == true) {
            g.append("g")
                .attr("transform", "translate(0," + height + ")")
                .attr("color", "grey")
                .call(d3.axisBottom(x));
        }
        else {
            g.append("g")
                .attr("transform", "translate(0," + height + ")")
                .attr("color", "grey")
                .call(d3.axisBottom(x)).
                selectAll("text")
                .attr("y", 0)
                .attr("x", 9)
                .attr("dy", ".35em")
                .attr("transform", "rotate(60)")
                .style("text-anchor", "start");
        }
        g.append("g")
            .attr("color", "grey")
            .call(d3.axisLeft(y));
        return {
            g, x, y, height, width
        };
    }
    /**
     * @param {?} g
     * @param {?} x
     * @param {?} y
     * @param {?} height
     * @param {?} width
     * @return {?}
     */
    plotScale(g, x, y, height, width) {
        if (this.vScale) {
            g.append('g')
                .attr("color", "lightgrey")
                .attr('transform', 'translate(0,' + height + ')')
                .call(d3.axisBottom(x).
                tickSize(-this.width).tickFormat(''));
        }
        if (this.hScale) {
            g.append('g')
                .attr("color", "lightgrey")
                .call(d3.axisLeft(y)
                .tickSize(-width).tickFormat(''));
        }
    }
    /**
     * @param {?} node
     * @return {?}
     */
    legendClick(node) {
        // const legendNode = JSON.parse(JSON.stringify(node));
        // delete legendNode.color;
        // legendNode.data.forEach(element => {
        //     delete element.legend;
        // });
        // const legendNode = JSON.parse(JSON.stringify(node));
        // delete legendNode.color;
        // legendNode.data.forEach(element => {
        //     delete element.legend;
        // });
        /** @type {?} */
        let obj = {};
        obj["label"] = node.label;
        /** @type {?} */
        let data = [];
        node.data.forEach(element => {
            /** @type {?} */
            let object = {};
            object[element.legend] = element.value;
            object[this.xaxisname] = element.label;
            //   object[element.label] = element.value;
            data.push(object);
        });
        obj["data"] = data;
        this.onLegendClick.emit(obj);
        // this.onLegendClick.emit(legendNode);
    }
}
AmexioD3BaseLineComponent.propDecorators = {
    hScale: [{ type: Input, args: ['horizontal-scale',] }],
    vScale: [{ type: Input, args: ['vertical-scale',] }],
    httpurl: [{ type: Input, args: ['data',] }, { type: Input, args: ['http-url',] }],
    httpmethod: [{ type: Input, args: ['http-method',] }]
};
if (false) {
    /** @type {?} */
    AmexioD3BaseLineComponent.prototype.svgwidth;
    /** @type {?} */
    AmexioD3BaseLineComponent.prototype.svgheight;
    /** @type {?} */
    AmexioD3BaseLineComponent.prototype._data;
    /** @type {?} */
    AmexioD3BaseLineComponent.prototype.xaxisdata;
    /** @type {?} */
    AmexioD3BaseLineComponent.prototype.yaxisdata;
    /** @type {?} */
    AmexioD3BaseLineComponent.prototype.legenddata;
    /** @type {?} */
    AmexioD3BaseLineComponent.prototype.legends;
    /** @type {?} */
    AmexioD3BaseLineComponent.prototype.xaxisname;
    /** @type {?} */
    AmexioD3BaseLineComponent.prototype.multiseriesdata;
    /** @type {?} */
    AmexioD3BaseLineComponent.prototype.svg;
    /** @type {?} */
    AmexioD3BaseLineComponent.prototype.hScale;
    /** @type {?} */
    AmexioD3BaseLineComponent.prototype.vScale;
    /** @type {?} */
    AmexioD3BaseLineComponent.prototype.httpurl;
    /** @type {?} */
    AmexioD3BaseLineComponent.prototype.httpmethod;
    /** @type {?} */
    AmexioD3BaseLineComponent.prototype.deviceQueryService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmFzZWxpbmUuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vYW1leGlvLWNoYXJ0LWQzLyIsInNvdXJjZXMiOlsibGliL2xpbmUvYmFzZWxpbmUuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsS0FBSyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3RDLE9BQU8sS0FBSyxFQUFFLE1BQU0sSUFBSSxDQUFDO0FBQ3pCLE9BQU8sRUFBRSwwQkFBMEIsRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBR3BFLE1BQU0sZ0NBQWlDLFNBQVEsMEJBQTBCOzs7O0lBdUJyRSxZQUFtQixrQkFBc0M7UUFDckQsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBREMsdUJBQWtCLEdBQWxCLGtCQUFrQixDQUFvQjtRQXBCekQsY0FBUyxHQUFDLEdBQUcsQ0FBQztRQVVhLFdBQU0sR0FBYSxJQUFJLENBQUM7UUFFeEIsV0FBTSxHQUFhLEtBQUssQ0FBQztJQVVwRCxDQUFDOzs7OztJQUdELElBQUksSUFBSSxDQUFDLENBQUs7UUFDVixJQUFJLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQztRQUNmLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO0lBQzVCLENBQUM7Ozs7SUFFRCxJQUFJLElBQUk7UUFDSixNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQztJQUN0QixDQUFDOzs7O0lBR1MsZ0JBQWdCO1FBRXRCLElBQUksQ0FBQyxTQUFTLEdBQUcsRUFBRSxDQUFDO1FBQ3BCLElBQUksQ0FBQyxTQUFTLEdBQUcsRUFBRSxDQUFDO1FBQ3BCLElBQUksQ0FBQyxlQUFlLEdBQUcsRUFBRSxDQUFDO1FBQzFCLElBQUksQ0FBQyxVQUFVLEdBQUcsRUFBRSxDQUFDO1FBQ3JCLElBQUksQ0FBQyxPQUFPLEdBQUcsRUFBRSxDQUFDO1FBQ2xCLElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMs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QXVDO1FBQ3ZDLDZCQUE2QjtRQUM3QixNQUFNOzs7Ozs7O1lBRUYsR0FBRyxHQUFHLEVBQUU7UUFDaEIsR0FBRyxDQUFDLE9BQU8sQ0FBQyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUM7O1lBQ3RCLElBQUksR0FBRyxFQUFFO1FBQ2IsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLEVBQUU7O2dCQUN0QixNQUFNLEdBQUcsRUFBRTtZQUVmLE1BQU0sQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLEdBQUcsT0FBTyxDQUFDLEtBQUssQ0FBQztZQUN2QyxNQUFNLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxHQUFHLE9BQU8sQ0FBQyxLQUFLLENBQUM7WUFDekMsMkNBQTJDO1lBQ3pDLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDcEIsQ0FBQyxDQUFDLENBQUM7UUFDSCxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsSUFBSSxDQUFDO1FBQ25CLElBQUksQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBRXpCLHVDQUF1QztJQUMzQyxDQUFDOzs7cUJBdktBLEtBQUssU0FBQyxrQkFBa0I7cUJBRXhCLEtBQUssU0FBQyxnQkFBZ0I7c0JBRXRCLEtBQUssU0FBQyxNQUFNLGNBRVosS0FBSyxTQUFDLFVBQVU7eUJBRWhCLEtBQUssU0FBQyxhQUFhOzs7O0lBbkJwQiw2Q0FBZTs7SUFDZiw4Q0FBYzs7SUFDZCwwQ0FBeUI7O0lBQ3pCLDhDQUEyQjs7SUFDM0IsOENBQTJCOztJQUMzQiwrQ0FBMkI7O0lBQzNCLDRDQUFtQjs7SUFDbkIsOENBQTBCOztJQUMxQixvREFBa0M7O0lBQ2xDLHdDQUFROztJQUVSLDJDQUFtRDs7SUFFbkQsMkNBQW9EOztJQUVwRCw0Q0FFZ0M7O0lBRWhDLCtDQUFzQzs7SUFFMUIsdURBQTZDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5wdXQgfSBmcm9tIFwiQGFuZ3VsYXIvY29yZVwiO1xuaW1wb3J0ICogYXMgZDMgZnJvbSAnZDMnO1xuaW1wb3J0IHsgQW1leGlvRDNCYXNlQ2hhcnRDb21wb25lbnQgfSBmcm9tIFwiLi4vYmFzZS9iYXNlLmNvbXBvbmVudFwiO1xuaW1wb3J0e0RldmljZVF1ZXJ5U2VydmljZX0gZnJvbSAnLi4vc2VydmljZXMvZGV2aWNlLnF1ZXJ5LnNlcnZpY2UnO1xuXG5leHBvcnQgY2xhc3MgQW1leGlvRDNCYXNlTGluZUNvbXBvbmVudCBleHRlbmRzIEFtZXhpb0QzQmFzZUNoYXJ0Q29tcG9uZW50XG57XG4gICAgc3Znd2lkdGggOiBhbnk7XG4gICAgc3ZnaGVpZ2h0PTMwMDtcbiAgICBwcml2YXRlIF9kYXRhICAgICAgOiBhbnk7XG4gICAgcHJpdmF0ZSB4YXhpc2RhdGEgIDogYW55W107XG4gICAgcHJpdmF0ZSB5YXhpc2RhdGEgIDogYW55W107XG4gICAgcHJpdmF0ZSBsZWdlbmRkYXRhIDogYW55W107XG4gICAgbGVnZW5kcyAgICA6IGFueVtdO1xuICAgIHByb3RlY3RlZCB4YXhpc25hbWUgOiBhbnk7XG4gICAgcHJvdGVjdGVkIG11bHRpc2VyaWVzZGF0YSA6IGFueVtdO1xuICAgIHN2Zzphbnk7XG5cbiAgICBASW5wdXQoJ2hvcml6b250YWwtc2NhbGUnKSBoU2NhbGUgOiBib29sZWFuID0gdHJ1ZTtcblxuICAgIEBJbnB1dCgndmVydGljYWwtc2NhbGUnKSAgIHZTY2FsZSA6IGJvb2xlYW4gPSBmYWxzZTtcblxuICAgIEBJbnB1dCgnZGF0YScpIFxuXG4gICAgQElucHV0KCdodHRwLXVybCcpIGh0dHB1cmw6IGFueTtcbiAgICBcbiAgICBASW5wdXQoJ2h0dHAtbWV0aG9kJykgaHR0cG1ldGhvZDogYW55O1xuXG4gICAgY29uc3RydWN0b3IocHVibGljIGRldmljZVF1ZXJ5U2VydmljZTogRGV2aWNlUXVlcnlTZXJ2aWNlKSB7XG4gICAgICAgIHN1cGVyKCdsaW5lJyk7XG4gICAgfVxuXG5cbiAgICBzZXQgZGF0YSh2OmFueSl7XG4gICAgICAgIHRoaXMuX2RhdGEgPSB2O1xuICAgICAgICB0aGlzLmNyZWF0ZVhZQXhpc0RhdGEoKTtcbiAgICB9XG5cbiAgICBnZXQgZGF0YSgpe1xuICAgICAgICByZXR1cm4gdGhpcy5fZGF0YTtcbiAgICB9XG5cblxuICAgIHByb3RlY3RlZCBjcmVhdGVYWUF4aXNEYXRhKCkgOiB2b2lkIHtcblxuICAgICAgICB0aGlzLnhheGlzZGF0YSA9IFtdO1xuICAgICAgICB0aGlzLnlheGlzZGF0YSA9IFtdO1xuICAgICAgICB0aGlzLm11bHRpc2VyaWVzZGF0YSA9IFtdO1xuICAgICAgICB0aGlzLmxlZ2VuZGRhdGEgPSBbXTtcbiAgICAgICAgdGhpcy5sZWdlbmRzID0gW107XG4gICAgICAgIHRoaXMueGF4aXNuYW1lID0gdGhpcy5kYXRhWzBdWzBdLmxhYmVsO1xuICAgICAgICAgY29uc3QgbXNkYXJyYXkgOiBhbnkgW10gPVtdO1xuICAgICAgICAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IHRoaXMuX2RhdGFbMF0ubGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgICAgICAgICBjb25zdCBsZWdlbmQgPSB0aGlzLl9kYXRhWzBdW2luZGV4XTtcbiAgICAgICAgICAgIG1zZGFycmF5W2luZGV4XT1bXTtcbiAgICAgICAgICAgIHRoaXMubGVnZW5kZGF0YS5wdXNoKHsnbGFiZWwnOmxlZ2VuZC5sYWJlbCwnY29sb3InOnRoaXMucHJlZGVmaW5lZGNvbG9yc1tpbmRleCsxXX0pO1xuICAgICAgICAgICAgaWYoaW5kZXggPiAwKVxuICAgICAgICAgICAgICAgIHRoaXMubGVnZW5kcy5wdXNoKHsnbGFiZWwnOmxlZ2VuZC5sYWJlbCwnY29sb3InOnRoaXMucHJlZGVmaW5lZGNvbG9yc1tpbmRleF19KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBpID0gMDtcbiAgICAgICAgdGhpcy5fZGF0YS5mb3JFYWNoKG9iamVjdCA9PiB7XG4gICAgICAgICAgICBpZihpPjApe1xuICAgICAgICAgICAgICAgIGxldCBqID0gMDtcbiAgICAgICAgICAgICAgICBvYmplY3QuZm9yRWFjaChhID0+e1xuICAgICAgICAgICAgICAgICAgICAgaWYoaj09PTApe1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy54YXhpc2RhdGEucHVzaCh7J2xhYmVsJzphLCAndmFsdWUnOmF9KTtcbiAgICAgICAgICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnlheGlzZGF0YS5wdXNoKHsnbGFiZWwnOmEsICd2YWx1ZSc6YX0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIG1zZGFycmF5W2pdLnB1c2goYSk7XG4gICAgICAgICAgICAgICAgICAgIGorKztcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGkrKztcbiAgICAgICAgfSk7XG5cbiAgICAgICAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IG1zZGFycmF5Lmxlbmd0aDsgaW5kZXgrKykge1xuICAgICAgICAgICAgY29uc3QgZWxlbWVudCA9IG1zZGFycmF5W2luZGV4XTtcbiAgICAgICAgICAgIGlmKGluZGV4ID4wKXtcbiAgICAgICAgICAgICAgICBsZXQgbWQgOiBhbnkgW10gPSBbXTtcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IGVsZW1lbnQubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdiA9IGVsZW1lbnRbal07XG4gICAgICAgICAgICAgICAgICAgIG1kLnB1c2goeydsZWdlbmQnOnRoaXMubGVnZW5kZGF0YVtpbmRleF0ubGFiZWwsJ2xhYmVsJzp0aGlzLnhheGlzZGF0YVtqXS52YWx1ZSwgJ3ZhbHVlJzp2fSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMubXVsdGlzZXJpZXNkYXRhLnB1c2gobWQpO1xuICAgICAgICAgICAgICAgIHRoaXMubGVnZW5kc1tpbmRleC0xXS5kYXRhID0gbWQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgaW5pdENoYXJ0KCkgOiBhbnkge1xuXG4gICAgICAgIHRoaXMuc3ZnICAgICAgID0gZDMuc2VsZWN0KFwiI1wiK3RoaXMuY29tcG9uZW50SWQpO1xuICAgICAgICBjb25zdCBtYXJnaW4gICAgPSB7IHRvcDogNDAsIHJpZ2h0OiAyMCwgYm90dG9tOiAzMCwgbGVmdDogNDAgfTtcbiAgICAgICAgY29uc3Qgd2lkdGggICAgID0gK3RoaXMuc3Znd2lkdGggLSBtYXJnaW4ubGVmdCAtIG1hcmdpbi5yaWdodDtcbiAgICAgICAgY29uc3QgaGVpZ2h0ICAgID0gK3RoaXMuc3ZnaGVpZ2h0IC0gbWFyZ2luLnRvcCAtIG1hcmdpbi5ib3R0b207XG4gICAgICAgIGNvbnN0IGcgICAgICAgICA9IHRoaXMuc3ZnLmFwcGVuZChcImdcIikuYXR0cihcInRyYW5zZm9ybVwiLCBcInRyYW5zbGF0ZShcIiArIG1hcmdpbi5sZWZ0ICsgXCIsXCIgKyBtYXJnaW4udG9wICsgXCIpXCIpO1xuXG4gICAgICAgIGNvbnN0IHggPSBkMy5zY2FsZUJhbmQoKVxuICAgICAgICAgICAgICAgICAgICAucmFuZ2VSb3VuZChbMCwgd2lkdGhdKVxuICAgICAgICAgICAgICAgICAgICAucGFkZGluZygwLjEpOyAgICAgICAgICAgICAgICAgICAgXG4gICAgXG4gICAgICAgIGNvbnN0IHkgPSBkMy5zY2FsZUxpbmVhcigpXG4gICAgICAgICAgICAgICAgICAgICAucmFuZ2VSb3VuZChbaGVpZ2h0LCAwXSk7XG5cbiAgICAgICAgeC5kb21haW4odGhpcy54YXhpc2RhdGEubWFwKCAoZCkgPT4geyByZXR1cm4gZC5sYWJlbDt9KSk7XG4gICAgICAgIHkuZG9tYWluKFswLCBkMy5tYXgodGhpcy55YXhpc2RhdGEsICAoZCkgPT4geyByZXR1cm4gZC52YWx1ZTsgfSldKTtcblxuICAgICAgICAvL2FkZCBheGlzIFxuICAgICAgICBpZih0aGlzLmRldmljZVF1ZXJ5U2VydmljZS5Jc0Rlc2t0b3AoKT09dHJ1ZSlcbiAgICAgICAge1xuICAgICAgICAgIGcuYXBwZW5kKFwiZ1wiKVxuICAgICAgICAgICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBcInRyYW5zbGF0ZSgwLFwiICsgaGVpZ2h0ICsgXCIpXCIpXG4gICAgICAgICAgICAgIC5hdHRyKFwiY29sb3JcIiwgXCJncmV5XCIpXG4gICAgICAgICAgICAgIC5jYWxsKGQzLmF4aXNCb3R0b20oeCkpXG4gICAgICAgIH1cbiAgICAgIGVsc2VcbiAgICAgICB7XG4gICAgICAgIGcuYXBwZW5kKFwiZ1wiKVxuICAgICAgICAgICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBcInRyYW5zbGF0ZSgwLFwiICsgaGVpZ2h0ICsgXCIpXCIpXG4gICAgICAgICAgICAgIC5hdHRyKFwiY29sb3JcIiwgXCJncmV5XCIpXG4gICAgICAgICAgICAgIC5jYWxsKGQzLmF4aXNCb3R0b20oeCkpLlxuICAgICAgICAgICAgICAgc2VsZWN0QWxsKFwidGV4dFwiKVxuICAgICAgICAgICAgICAgLmF0dHIoXCJ5XCIsIDApXG4gICAgICAgICAgICAgICAuYXR0cihcInhcIiwgOSlcbiAgICAgICAgICAgICAgIC5hdHRyKFwiZHlcIiwgXCIuMzVlbVwiKVxuICAgICAgICAgICAgICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgXCJyb3RhdGUoNjApXCIpXG4gICAgICAgICAgICAgICAuc3R5bGUoXCJ0ZXh0LWFuY2hvclwiLCBcInN0YXJ0XCIpO1xuICAgICAgfVxuICAgICBcbiAgICAgICAgZy5hcHBlbmQoXCJnXCIpXG4gICAgICAgICAgICAuYXR0cihcImNvbG9yXCIsIFwiZ3JleVwiKVxuICAgICAgICAgICAgLmNhbGwoZDMuYXhpc0xlZnQoeSkpO1xuXG5cbiAgICAgICAgcmV0dXJue1xuICAgICAgICAgICAgIGcsIHgsIHksIGhlaWdodCwgd2lkdGhcbiAgICAgICAgfVxuXG4gICAgfSAgICBcblxuXG4gICAgcHJvdGVjdGVkIHBsb3RTY2FsZShnOmFueSx4OmFueSwgeTphbnksaGVpZ2h0OmFueSx3aWR0aDphbnkpIDogdm9pZCBcbiAgICB7XG4gICAgICAgIGlmKHRoaXMudlNjYWxlKXtcbiAgICAgICAgICAgIGcuYXBwZW5kKCdnJylcbiAgICAgICAgICAgICAgICAuYXR0cihcImNvbG9yXCIsIFwibGlnaHRncmV5XCIpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ3RyYW5zZm9ybScsICd0cmFuc2xhdGUoMCwnICsgaGVpZ2h0ICsgJyknKVxuICAgICAgICAgICAgICAgIC5jYWxsKGQzLmF4aXNCb3R0b20oeCkuXG4gICAgICAgICAgICAgICAgIHRpY2tTaXplKC10aGlzLndpZHRoKS50aWNrRm9ybWF0KCcnKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgICBpZih0aGlzLmhTY2FsZSl7XG4gICAgICAgICAgICBnLmFwcGVuZCgnZycpXG4gICAgICAgICAgICAgICAgLmF0dHIoXCJjb2xvclwiLCBcImxpZ2h0Z3JleVwiKVxuICAgICAgICAgICAgICAgIC5jYWxsKGQzLmF4aXNMZWZ0KHkpXG4gICAgICAgICAgICAgICAgLiB0aWNrU2l6ZSgtd2lkdGgpLnRpY2tGb3JtYXQoJycpKTsgICAgIFxuICAgICAgICB9XG4gICAgfVxuXG4gXG4gICAgbGVnZW5kQ2xpY2sobm9kZTphbnkpe1xuIFxuICAgICAgICAvLyBjb25zdCBsZWdlbmROb2RlID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShub2RlKSk7XG4gICAgICAgIC8vIGRlbGV0ZSBsZWdlbmROb2RlLmNvbG9yO1xuICAgICAgICAvLyBsZWdlbmROb2RlLmRhdGEuZm9yRWFjaChlbGVtZW50ID0+IHtcbiAgICAgICAgLy8gICAgIGRlbGV0ZSBlbGVtZW50LmxlZ2VuZDtcbiAgICAgICAgLy8gfSk7XG5cbiAgICAgICAgbGV0IG9iaiA9IHt9O1xuICAgIG9ialtcImxhYmVsXCJdID0gbm9kZS5sYWJlbDtcbiAgICBsZXQgZGF0YSA9IFtdO1xuICAgIG5vZGUuZGF0YS5mb3JFYWNoKGVsZW1lbnQgPT4ge1xuICAgICAgbGV0IG9iamVjdCA9IHt9O1xuICAgICBcbiAgICAgIG9iamVjdFtlbGVtZW50LmxlZ2VuZF0gPSBlbGVtZW50LnZhbHVlO1xuICAgICAgb2JqZWN0W3RoaXMueGF4aXNuYW1lXSA9IGVsZW1lbnQubGFiZWw7XG4gICAgLy8gICBvYmplY3RbZWxlbWVudC5sYWJlbF0gPSBlbGVtZW50LnZhbHVlO1xuICAgICAgZGF0YS5wdXNoKG9iamVjdCk7XG4gICAgfSk7XG4gICAgb2JqW1wiZGF0YVwiXSA9IGRhdGE7XG4gICAgdGhpcy5vbkxlZ2VuZENsaWNrLmVtaXQob2JqKTtcbiAgICBcbiAgICAgICAgLy8gdGhpcy5vbkxlZ2VuZENsaWNrLmVtaXQobGVnZW5kTm9kZSk7XG4gICAgfVxufSJdfQ==