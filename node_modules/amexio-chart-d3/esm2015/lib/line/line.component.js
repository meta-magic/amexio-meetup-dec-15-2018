/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */
import { Component, ViewChild, ElementRef, Input } from "@angular/core";
import * as d3 from 'd3';
import { AmexioD3BaseLineComponent } from "./baseline.component";
import { CommanDataService } from '../services/comman.data.service';
import { DeviceQueryService } from "../services/device.query.service";
export class AmexioD3LineComponent extends AmexioD3BaseLineComponent {
    /**
     * @param {?} deviceQueryService
     * @param {?} myservice
     */
    constructor(deviceQueryService, myservice) {
        super(deviceQueryService);
        this.deviceQueryService = deviceQueryService;
        this.myservice = myservice;
        this.level = 0;
        this.labelflag = false;
        this.labelcolor = "black";
        this.drillabledatakey = [];
        this.drillableFlag = true;
        this.resizeflag = false;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        if (this.level <= 1) {
            /** @type {?} */
            let resp;
            if (this.httpmethod && this.httpurl) {
                this.myservice.fetchUrlData(this.httpurl, this.httpmethod).subscribe((response) => {
                    resp = response;
                }, (error) => {
                }, () => {
                    setTimeout(() => {
                        this.data = this.getResponseData(resp);
                        this.plotD3Chart();
                    }, 0);
                });
            }
            else if (this.data) {
                setTimeout(() => {
                    this.data = this.getResponseData(this.data);
                    this.plotD3Chart();
                }, 0);
            }
        }
    }
    /**
     * @param {?} data
     * @return {?}
     */
    fetchData(data) {
        /** @type {?} */
        let requestJson;
        /** @type {?} */
        let key = this.drillabledatakey;
        /** @type {?} */
        let resp;
        if (this.drillabledatakey.length) {
            /** @type {?} */
            let drillabledata = this.getMultipleDrillbleKeyData(data, key);
            requestJson = drillabledata;
        }
        else {
            requestJson = data;
        }
        if (this.httpmethod && this.httpurl) {
            this.myservice.postfetchData(this.httpurl, this.httpmethod, requestJson).subscribe((response) => {
                resp = response;
            }, (error) => {
            }, () => {
                setTimeout(() => {
                    this.data = this.getResponseData(resp);
                    this.drawChart();
                }, 0);
            });
        }
    }
    /**
     * @return {?}
     */
    drawChart() {
        setTimeout(() => {
            this.plotD3Chart();
        }, 0);
    }
    /**
     * @return {?}
     */
    resize() {
        this.svgwidth = 0;
        this.svg.selectAll("*").remove();
        this.resizeflag = true;
        this.svgwidth = this.divid.nativeElement.offsetWidth;
        this.plotD3Chart();
    }
    /**
     * @param {?} httpResponse
     * @return {?}
     */
    getResponseData(httpResponse) {
        /** @type {?} */
        let responsedata = httpResponse;
        if (this.datareader != null) {
            /** @type {?} */
            const dr = this.datareader.split('.');
            for (const ir of dr) {
                responsedata = responsedata[ir];
            }
        }
        else {
            responsedata = httpResponse;
        }
        return responsedata;
    }
    /**
     * @return {?}
     */
    plotD3Chart() {
        if (this.resizeflag == false) {
            if (this.chartId) {
                this.svgwidth = this.chartId.nativeElement.offsetWidth;
            }
            else {
                this.svgwidth = this.svgwidth;
            }
        }
        /** @type {?} */
        const tooltip = this.toolTip(d3);
        /** @type {?} */
        const linechart = this.initChart();
        this.plotScale(linechart.g, linechart.x, linechart.y, linechart.height, linechart.width);
        this.plotLine(linechart.g, linechart.x, linechart.y, linechart.height, linechart.width, [], tooltip, (1));
        for (let index = 0; index < this.multiseriesdata.length; index++) {
            this.plotLine(linechart.g, linechart.x, linechart.y, linechart.height, linechart.width, this.multiseriesdata[index], tooltip, (index + 1));
        }
    }
    /**
     * @param {?} g
     * @param {?} x
     * @param {?} y
     * @param {?} height
     * @param {?} width
     * @param {?} data
     * @param {?} tooltip
     * @param {?} i
     * @return {?}
     */
    plotLine(g, x, y, height, width, data, tooltip, i) {
        /** @type {?} */
        const line = d3.line()
            .x(function (d) { return x(d.label); })
            .y(function (d) { return y(d.value); });
        g.append("path")
            .datum(data)
            .attr("fill", "none")
            .attr("stroke", this.predefinedcolors[i])
            .attr("stroke-width", 1.5)
            .attr("d", line);
        g.selectAll('dot')
            .data(data)
            .enter()
            .append('circle')
            .attr("cx", (d) => { return x(d.label); })
            .attr("cy", (d) => { return y(d.value); })
            .attr('r', 2)
            .attr("cursor", "pointer")
            .on("mouseover", (d) => {
            return tooltip.style("visibility", "visible");
        })
            .on("mousemove", (d) => {
            return tooltip.html(this.callTooltip(d)
            //  this.toolTipForLine(d)
            //  this.toolTipWithLegendandAxis(d.legend,d.label,d.value)
            )
                .style("top", (d3.event.pageY - 10) + "px")
                .style("left", (d3.event.pageX + 10) + "px");
        })
            .on("mouseout", (d) => {
            return tooltip.style("visibility", "hidden");
        })
            .on("click", (d) => {
            this.lineChartClick(d);
            this.fordrillableClick(this, d, event);
            return tooltip.style("visibility", "hidden");
        });
        //lets plot labels here
        if (this.labelflag) {
            g.selectAll('label')
                .data(data)
                .enter()
                .append('text')
                .style("font-weight", "bold")
                .attr("text-anchor", "middle")
                .attr("fill", (d) => {
                if (this.labelcolor.length > 0) {
                    return this.labelcolor;
                }
                else {
                    return "black";
                }
            })
                .attr("x", function (d, i) {
                return x(d.label);
            })
                .attr("y", function (d, i) {
                return y(d.value) - 10;
            })
                .text(function (d) {
                return d.value;
            });
        }
    }
    /**
     * @param {?} d
     * @return {?}
     */
    lineChartClick(d) {
        /** @type {?} */
        let obj = {};
        obj[d.legend] = d.value;
        obj[this.xaxisname] = d.label;
        this.chartClick(obj);
    }
    /**
     * @param {?} tooltipdata
     * @return {?}
     */
    callTooltip(tooltipdata) {
        /** @type {?} */
        let obj = {};
        obj[tooltipdata.legend] = tooltipdata.value;
        obj[this.xaxisname] = tooltipdata.label;
        return this.toolTipForBar(obj);
    }
}
AmexioD3LineComponent.decorators = [
    { type: Component, args: [{
                selector: 'amexio-d3-chart-line',
                template: `
<div *ngIf="drillableFlag" #divid (window:resize)="resize()"> 
<table style="width: 100%;" #chartId  >
        <tr><td style="font-size: 18px; font-weight: bold; "> {{title}} </td></tr>
        <tr>
            <td>
                <svg [attr.height]="height" [attr.width]="svgwidth" [attr.id]="componentId">
                </svg>            
            </td>
        </tr>
        <tr>
            <td style="display: block; padding: 5px;">
                    <amexio-d3-legend *ngIf="legend" [horizontal]="true" (onClick)="legendClick($event)" 
                                        [data]="legends" style="height:100%;">
                    </amexio-d3-legend>
            </td>
        
        </tr>
</table>
</div>
    `
            },] },
];
AmexioD3LineComponent.ctorParameters = () => [
    { type: DeviceQueryService },
    { type: CommanDataService }
];
AmexioD3LineComponent.propDecorators = {
    chartId: [{ type: ViewChild, args: ['chartId',] }],
    divid: [{ type: ViewChild, args: ['divid',] }],
    drillid: [{ type: ViewChild, args: ['drillid',] }],
    datareader: [{ type: Input, args: ['data-reader',] }],
    level: [{ type: Input, args: ['level',] }],
    labelflag: [{ type: Input, args: ['label',] }],
    labelcolor: [{ type: Input, args: ['label-color',] }],
    target: [{ type: Input, args: ['target',] }],
    drillabledatakey: [{ type: Input, args: ['drillable-data',] }]
};
if (false) {
    /** @type {?} */
    AmexioD3LineComponent.prototype.chartId;
    /** @type {?} */
    AmexioD3LineComponent.prototype.divid;
    /** @type {?} */
    AmexioD3LineComponent.prototype.drillid;
    /** @type {?} */
    AmexioD3LineComponent.prototype.datareader;
    /** @type {?} */
    AmexioD3LineComponent.prototype.level;
    /** @type {?} */
    AmexioD3LineComponent.prototype.labelflag;
    /** @type {?} */
    AmexioD3LineComponent.prototype.labelcolor;
    /** @type {?} */
    AmexioD3LineComponent.prototype.target;
    /** @type {?} */
    AmexioD3LineComponent.prototype.drillabledatakey;
    /** @type {?} */
    AmexioD3LineComponent.prototype.drillableFlag;
    /** @type {?} */
    AmexioD3LineComponent.prototype.resizeflag;
    /** @type {?} */
    AmexioD3LineComponent.prototype.deviceQueryService;
    /** @type {?} */
    AmexioD3LineComponent.prototype.myservice;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGluZS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9hbWV4aW8tY2hhcnQtZDMvIiwic291cmNlcyI6WyJsaWIvbGluZS9saW5lLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxTQUFTLEVBQUUsVUFBVSxFQUFFLEtBQUssRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUN4RSxPQUFPLEtBQUssRUFBRSxNQUFNLElBQUksQ0FBQztBQUN6QixPQUFPLEVBQUUseUJBQXlCLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUlqRSxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxpQ0FBaUMsQ0FBQztBQUNwRSxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSxrQ0FBa0MsQ0FBQztBQTBCdEUsTUFBTSw0QkFBNkIsU0FBUSx5QkFBeUI7Ozs7O0lBY2hFLFlBQW1CLGtCQUFzQyxFQUFRLFNBQTJCO1FBQ3RGLEtBQUssQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO1FBRGIsdUJBQWtCLEdBQWxCLGtCQUFrQixDQUFvQjtRQUFRLGNBQVMsR0FBVCxTQUFTLENBQWtCO1FBUjVFLFVBQUssR0FBUSxDQUFDLENBQUM7UUFDZixjQUFTLEdBQVksS0FBSyxDQUFDO1FBQ3JCLGVBQVUsR0FBVyxPQUFPLENBQUM7UUFFMUIscUJBQWdCLEdBQU8sRUFBRSxDQUFBO1FBQ2xELGtCQUFhLEdBQVcsSUFBSSxDQUFDO1FBQzdCLGVBQVUsR0FBUyxLQUFLLENBQUM7SUFJekIsQ0FBQzs7OztJQUVELFFBQVE7UUFFSixFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxJQUFJLENBQUMsQ0FBQyxDQUFBLENBQUM7O2dCQUNqQixJQUFTO1lBQ2IsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLFVBQVUsSUFBSSxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztnQkFDbEMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxZQUFZLENB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U0FBUyxTQUFDLE9BQU87c0JBQ2pCLFNBQVMsU0FBQyxTQUFTO3lCQUNuQixLQUFLLFNBQUMsYUFBYTtvQkFDbkIsS0FBSyxTQUFDLE9BQU87d0JBQ2IsS0FBSyxTQUFDLE9BQU87eUJBQ2IsS0FBSyxTQUFDLGFBQWE7cUJBQ25CLEtBQUssU0FBQyxRQUFROytCQUNkLEtBQUssU0FBQyxnQkFBZ0I7Ozs7SUFSdkIsd0NBQTBDOztJQUMxQyxzQ0FBc0M7O0lBQ3RDLHdDQUFrQzs7SUFDbEMsMkNBQXlDOztJQUN6QyxzQ0FBK0I7O0lBQy9CLDBDQUEyQzs7SUFDM0MsMkNBQW1EOztJQUNuRCx1Q0FBK0I7O0lBQy9CLGlEQUFrRDs7SUFDbEQsOENBQTZCOztJQUM3QiwyQ0FBeUI7O0lBRWIsbURBQTZDOztJQUFDLDBDQUFrQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgVmlld0NoaWxkLCBFbGVtZW50UmVmLCBJbnB1dCB9IGZyb20gXCJAYW5ndWxhci9jb3JlXCI7XG5pbXBvcnQgKiBhcyBkMyBmcm9tICdkMyc7XG5pbXBvcnQgeyBBbWV4aW9EM0Jhc2VMaW5lQ29tcG9uZW50IH0gZnJvbSBcIi4vYmFzZWxpbmUuY29tcG9uZW50XCI7XG5pbXBvcnQgeyBBbWV4aW9EM0Jhc2VDaGFydENvbXBvbmVudCB9IGZyb20gXCIuLi9iYXNlL2Jhc2UuY29tcG9uZW50XCI7XG5pbXBvcnQgeyBQbG90Q2FydCB9IGZyb20gXCIuLi9iYXNlL2NoYXJ0LmNvbXBvbmVudFwiO1xuaW1wb3J0IHsgSHR0cENsaWVudCwgSHR0cENsaWVudE1vZHVsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbi9odHRwJztcbmltcG9ydCB7IENvbW1hbkRhdGFTZXJ2aWNlIH0gZnJvbSAnLi4vc2VydmljZXMvY29tbWFuLmRhdGEuc2VydmljZSc7XG5pbXBvcnQgeyBEZXZpY2VRdWVyeVNlcnZpY2UgfSBmcm9tIFwiLi4vc2VydmljZXMvZGV2aWNlLnF1ZXJ5LnNlcnZpY2VcIjtcblxuQENvbXBvbmVudCh7XG4gICAgc2VsZWN0b3I6ICdhbWV4aW8tZDMtY2hhcnQtbGluZScsXG4gICAgdGVtcGxhdGU6IGBcbjxkaXYgKm5nSWY9XCJkcmlsbGFibGVGbGFnXCIgI2RpdmlkICh3aW5kb3c6cmVzaXplKT1cInJlc2l6ZSgpXCI+IFxuPHRhYmxlIHN0eWxlPVwid2lkdGg6IDEwMCU7XCIgI2NoYXJ0SWQgID5cbiAgICAgICAgPHRyPjx0ZCBzdHlsZT1cImZvbnQtc2l6ZTogMThweDsgZm9udC13ZWlnaHQ6IGJvbGQ7IFwiPiB7e3RpdGxlfX0gPC90ZD48L3RyPlxuICAgICAgICA8dHI+XG4gICAgICAgICAgICA8dGQ+XG4gICAgICAgICAgICAgICAgPHN2ZyBbYXR0ci5oZWlnaHRdPVwiaGVpZ2h0XCIgW2F0dHIud2lkdGhdPVwic3Znd2lkdGhcIiBbYXR0ci5pZF09XCJjb21wb25lbnRJZFwiPlxuICAgICAgICAgICAgICAgIDwvc3ZnPiAgICAgICAgICAgIFxuICAgICAgICAgICAgPC90ZD5cbiAgICAgICAgPC90cj5cbiAgICAgICAgPHRyPlxuICAgICAgICAgICAgPHRkIHN0eWxlPVwiZGlzcGxheTogYmxvY2s7IHBhZGRpbmc6IDVweDtcIj5cbiAgICAgICAgICAgICAgICAgICAgPGFtZXhpby1kMy1sZWdlbmQgKm5nSWY9XCJsZWdlbmRcIiBbaG9yaXpvbnRhbF09XCJ0cnVlXCIgKG9uQ2xpY2spPVwibGVnZW5kQ2xpY2soJGV2ZW50KVwiIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtkYXRhXT1cImxlZ2VuZHNcIiBzdHlsZT1cImhlaWdodDoxMDAlO1wiPlxuICAgICAgICAgICAgICAgICAgICA8L2FtZXhpby1kMy1sZWdlbmQ+XG4gICAgICAgICAgICA8L3RkPlxuICAgICAgICBcbiAgICAgICAgPC90cj5cbjwvdGFibGU+XG48L2Rpdj5cbiAgICBgXG59KVxuZXhwb3J0IGNsYXNzIEFtZXhpb0QzTGluZUNvbXBvbmVudCBleHRlbmRzIEFtZXhpb0QzQmFzZUxpbmVDb21wb25lbnQgaW1wbGVtZW50cyBQbG90Q2FydCB7XG5cbiAgICBAVmlld0NoaWxkKCdjaGFydElkJykgY2hhcnRJZDogRWxlbWVudFJlZjtcbiAgICBAVmlld0NoaWxkKCdkaXZpZCcpIGRpdmlkOiBFbGVtZW50UmVmO1xuICAgIEBWaWV3Q2hpbGQoJ2RyaWxsaWQnKSBkcmlsbGlkOmFueTtcbiAgICBASW5wdXQoJ2RhdGEtcmVhZGVyJykgZGF0YXJlYWRlcjogc3RyaW5nO1xuICAgIEBJbnB1dCgnbGV2ZWwnKSBsZXZlbDpudW1iZXI9MDtcbiAgICBASW5wdXQoJ2xhYmVsJykgbGFiZWxmbGFnOiBib29sZWFuID0gZmFsc2U7XG4gICAgQElucHV0KCdsYWJlbC1jb2xvcicpIGxhYmVsY29sb3I6IHN0cmluZyA9IFwiYmxhY2tcIjtcbiAgICBASW5wdXQoJ3RhcmdldCcpIHRhcmdldDpudW1iZXI7XG4gICAgQElucHV0KCdkcmlsbGFibGUtZGF0YScpIGRyaWxsYWJsZWRhdGFrZXk6YW55W109W11cbiAgICBkcmlsbGFibGVGbGFnOmJvb2xlYW4gPSB0cnVlO1xuICAgIHJlc2l6ZWZsYWc6Ym9vbGVhbj1mYWxzZTtcbiBcbiAgICBjb25zdHJ1Y3RvcihwdWJsaWMgZGV2aWNlUXVlcnlTZXJ2aWNlOiBEZXZpY2VRdWVyeVNlcnZpY2UscHVibGljIG15c2VydmljZTpDb21tYW5EYXRhU2VydmljZSkge1xuICAgICAgICAgIHN1cGVyKGRldmljZVF1ZXJ5U2VydmljZSk7XG4gICAgfVxuXG4gICAgbmdPbkluaXQoKSB7XG5cbiAgICAgICAgaWYgKHRoaXMubGV2ZWwgPD0gMSl7XG4gICAgICAgIGxldCByZXNwOiBhbnlcbiAgICAgICAgaWYgKHRoaXMuaHR0cG1ldGhvZCAmJiB0aGlzLmh0dHB1cmwpIHtcbiAgICAgICAgICAgIHRoaXMubXlzZXJ2aWNlLmZldGNoVXJsRGF0YSh0aGlzLmh0dHB1cmwsIHRoaXMuaHR0cG1ldGhvZCkuc3Vic2NyaWJlKChyZXNwb25zZSkgPT4ge1xuICAgICAgICAgICAgICAgIHJlc3AgPSByZXNwb25zZTtcbiAgICAgICAgICAgIH0sIChlcnJvcikgPT4ge1xuICAgICAgICAgICAgfSwgKCkgPT4ge1xuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmRhdGEgPSB0aGlzLmdldFJlc3BvbnNlRGF0YShyZXNwKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wbG90RDNDaGFydCgpO1xuICAgICAgICAgICAgICAgIH0sIDApO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZVxuICAgICAgICAgICAgaWYgKHRoaXMuZGF0YSkge1xuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmRhdGEgPSB0aGlzLmdldFJlc3BvbnNlRGF0YSh0aGlzLmRhdGEpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBsb3REM0NoYXJ0KCk7XG4gICAgICAgICAgICAgICAgfSwgMCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gICAgICBcbiAgICB9XG5cblxuICAgIGZldGNoRGF0YShkYXRhOiBhbnkpIHtcbiAgIFxuICAgICAgICBsZXQgcmVxdWVzdEpzb247XG4gICAgICAgIGxldCBrZXk9dGhpcy5kcmlsbGFibGVkYXRha2V5O1xuICAgICAgICBsZXQgcmVzcDogYW55O1xuICAgICAgICBpZih0aGlzLmRyaWxsYWJsZWRhdGFrZXkubGVuZ3RoKVxuICAgICAgICB7XG4gICAgICAgICAgICAgbGV0IGRyaWxsYWJsZWRhdGE9IHRoaXMuZ2V0TXVsdGlwbGVEcmlsbGJsZUtleURhdGEoZGF0YSxrZXkpO1xuICAgICAgICAgICAgIHJlcXVlc3RKc29uPWRyaWxsYWJsZWRhdGE7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZXtcbiAgICAgICAgICAgICAgICAgcmVxdWVzdEpzb249ZGF0YTtcbiAgICAgICAgICAgICB9XG4gICAgICBcbiAgIGlmICh0aGlzLmh0dHBtZXRob2QgJiYgdGhpcy5odHRwdXJsKSB7XG4gICAgIHRoaXMubXlzZXJ2aWNlLnBvc3RmZXRjaERhdGEodGhpcy5odHRwdXJsLHRoaXMuaHR0cG1ldGhvZCwgcmVxdWVzdEpzb24pLnN1YnNjcmliZSgocmVzcG9uc2UpID0+IHtcbiAgICAgICAgICAgICAgICByZXNwID0gcmVzcG9uc2U7XG4gICAgICAgICAgICB9LCAoZXJyb3IpID0+IHtcbiAgICAgICAgICAgIH0sICgpID0+IHtcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kYXRhID0gdGhpcy5nZXRSZXNwb25zZURhdGEocmVzcCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZHJhd0NoYXJ0KCk7ICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIH0sIDApO1xuICAgICAgICAgICB9KTsgICAgXG4gICAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgZHJhd0NoYXJ0KCkge1xuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICB0aGlzLnBsb3REM0NoYXJ0KCk7XG4gICAgICB9LCAwKTtcbiAgICB9IFxuXG4gICAgcmVzaXplKCkge1xuXG4gICAgdGhpcy5zdmd3aWR0aCA9IDA7XG4gICAgdGhpcy5zdmcuc2VsZWN0QWxsKFwiKlwiKS5yZW1vdmUoKTtcblxuICAgIHRoaXMucmVzaXplZmxhZyA9IHRydWU7XG4gICAgdGhpcy5zdmd3aWR0aCA9IHRoaXMuZGl2aWQubmF0aXZlRWxlbWVudC5vZmZzZXRXaWR0aDtcbiAgICB0aGlzLnBsb3REM0NoYXJ0KCk7XG4gIFxuXG4gICAgfVxuXG4gICAgZ2V0UmVzcG9uc2VEYXRhKGh0dHBSZXNwb25zZTogYW55KSB7XG4gICAgICAgIGxldCByZXNwb25zZWRhdGEgPSBodHRwUmVzcG9uc2U7XG4gICAgICAgIGlmICh0aGlzLmRhdGFyZWFkZXIgIT0gbnVsbCkge1xuICAgICAgICAgICAgY29uc3QgZHIgPSB0aGlzLmRhdGFyZWFkZXIuc3BsaXQoJy4nKTtcbiAgICAgICAgICAgIGZvciAoY29uc3QgaXIgb2YgZHIpIHtcbiAgICAgICAgICAgICAgICByZXNwb25zZWRhdGEgPSByZXNwb25zZWRhdGFbaXJdO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmVzcG9uc2VkYXRhID0gaHR0cFJlc3BvbnNlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZXNwb25zZWRhdGE7XG4gICAgfVxuXG4gIHBsb3REM0NoYXJ0KCk6IHZvaWQge1xuXG4gICAgXG4gICAgICAgaWYodGhpcy5yZXNpemVmbGFnPT1mYWxzZSlcbiAgICAgICB7XG4gIGlmKHRoaXMuY2hhcnRJZCl7XG4gICAgICAgICAgICB0aGlzLnN2Z3dpZHRoID0gdGhpcy5jaGFydElkLm5hdGl2ZUVsZW1lbnQub2Zmc2V0V2lkdGg7XG4gICAgfSBlbHNle1xuICAgICAgICAgICAgICAgdGhpcy5zdmd3aWR0aCA9IHRoaXMuc3Znd2lkdGg7XG4gICAgICAgIH1cbiAgICB9XG4gICAgICAgIGNvbnN0IHRvb2x0aXAgPSB0aGlzLnRvb2xUaXAoZDMpO1xuXG4gICAgICAgIGNvbnN0IGxpbmVjaGFydCA9IHRoaXMuaW5pdENoYXJ0KCk7XG5cbiAgICAgICAgdGhpcy5wbG90U2NhbGUobGluZWNoYXJ0LmcsIGxpbmVjaGFydC54LCBsaW5lY2hhcnQueSwgbGluZWNoYXJ0LmhlaWdodCwgbGluZWNoYXJ0LndpZHRoKTtcblxuICAgICAgICB0aGlzLnBsb3RMaW5lKGxpbmVjaGFydC5nLCBsaW5lY2hhcnQueCwgbGluZWNoYXJ0LnksIGxpbmVjaGFydC5oZWlnaHQsXG4gICAgICAgICAgICBsaW5lY2hhcnQud2lkdGgsIFtdLCB0b29sdGlwLCAoMSkpO1xuXG4gICAgICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCB0aGlzLm11bHRpc2VyaWVzZGF0YS5sZW5ndGg7IGluZGV4KyspIHtcbiAgICAgICAgICAgIHRoaXMucGxvdExpbmUobGluZWNoYXJ0LmcsIGxpbmVjaGFydC54LCBsaW5lY2hhcnQueSwgbGluZWNoYXJ0LmhlaWdodCxcbiAgICAgICAgICAgICAgICBsaW5lY2hhcnQud2lkdGgsIHRoaXMubXVsdGlzZXJpZXNkYXRhW2luZGV4XSwgdG9vbHRpcCwgKGluZGV4ICsgMSkpO1xuICAgICAgICB9XG5cblxuICAgIH1cblxuICAgIHByaXZhdGUgcGxvdExpbmUoZzogYW55LCB4OiBhbnksIHk6IGFueSwgaGVpZ2h0OiBhbnksIHdpZHRoOiBhbnksIGRhdGE6IGFueSwgdG9vbHRpcDogYW55LCBpOiBudW1iZXIpOiB2b2lkIHtcblxuICAgICAgICBjb25zdCBsaW5lID0gZDMubGluZSgpXG4gICAgICAgICAgICAueChmdW5jdGlvbiAoZCkgeyByZXR1cm4geChkLmxhYmVsKTsgfSlcbiAgICAgICAgICAgIC55KGZ1bmN0aW9uIChkKSB7IHJldHVybiB5KGQudmFsdWUpOyB9KTtcblxuICAgICAgICBnLmFwcGVuZChcInBhdGhcIilcbiAgICAgICAgICAgIC5kYXR1bShkYXRhKVxuICAgICAgICAgICAgLmF0dHIoXCJmaWxsXCIsIFwibm9uZVwiKVxuICAgICAgICAgICAgLmF0dHIoXCJzdHJva2VcIiwgdGhpcy5wcmVkZWZpbmVkY29sb3JzW2ldKVxuICAgICAgICAgICAgLmF0dHIoXCJzdHJva2Utd2lkdGhcIiwgMS41KVxuICAgICAgICAgICAgLmF0dHIoXCJkXCIsIGxpbmUpO1xuXG4gICAgICAgIGcuc2VsZWN0QWxsKCdkb3QnKVxuICAgICAgICAgICAgLmRhdGEoZGF0YSlcbiAgICAgICAgICAgIC5lbnRlcigpXG4gICAgICAgICAgICAuYXBwZW5kKCdjaXJjbGUnKVxuICAgICAgICAgICAgLmF0dHIoXCJjeFwiLCAoZCkgPT4geyByZXR1cm4geChkLmxhYmVsKTsgfSlcbiAgICAgICAgICAgIC5hdHRyKFwiY3lcIiwgKGQpID0+IHsgcmV0dXJuIHkoZC52YWx1ZSk7IH0pXG4gICAgICAgICAgICAuYXR0cigncicsIDIpXG4gICAgICAgICAgICAuYXR0cihcImN1cnNvclwiLCBcInBvaW50ZXJcIilcbiAgICAgICAgICAgIC5vbihcIm1vdXNlb3ZlclwiLCAoZCkgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiB0b29sdGlwLnN0eWxlKFwidmlzaWJpbGl0eVwiLCBcInZpc2libGVcIik7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLm9uKFwibW91c2Vtb3ZlXCIsIChkKSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRvb2x0aXAuaHRtbChcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jYWxsVG9vbHRpcChkKVxuICAgICAgICAgICAgICAgICAgICAvLyAgdGhpcy50b29sVGlwRm9yTGluZShkKVxuXG4gICAgICAgICAgICAgICAgICAgIC8vICB0aGlzLnRvb2xUaXBXaXRoTGVnZW5kYW5kQXhpcyhkLmxlZ2VuZCxkLmxhYmVsLGQudmFsdWUpXG5cbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgICAgIC5zdHlsZShcInRvcFwiLCAoZDMuZXZlbnQucGFnZVkgLSAxMCkgKyBcInB4XCIpXG4gICAgICAgICAgICAgICAgICAgIC5zdHlsZShcImxlZnRcIiwgKGQzLmV2ZW50LnBhZ2VYICsgMTApICsgXCJweFwiKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAub24oXCJtb3VzZW91dFwiLCAoZCkgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiB0b29sdGlwLnN0eWxlKFwidmlzaWJpbGl0eVwiLCBcImhpZGRlblwiKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAub24oXCJjbGlja1wiLCAoZCkgPT4ge1xuICAgICAgICAgICAgICAgICB0aGlzLmxpbmVDaGFydENsaWNrKGQpO1xuICAgICAgICAgICAgICAgICB0aGlzLmZvcmRyaWxsYWJsZUNsaWNrKHRoaXMsZCxldmVudCk7XG4gICAgICAgICAgICAgICAgIHJldHVybiB0b29sdGlwLnN0eWxlKFwidmlzaWJpbGl0eVwiLCBcImhpZGRlblwiKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAvL2xldHMgcGxvdCBsYWJlbHMgaGVyZVxuICAgICAgaWYgKHRoaXMubGFiZWxmbGFnKSB7XG4gICAgICAgIGcuc2VsZWN0QWxsKCdsYWJlbCcpXG4gICAgICAgICAgLmRhdGEoZGF0YSlcbiAgICAgICAgICAuZW50ZXIoKVxuICAgICAgICAgIC5hcHBlbmQoJ3RleHQnKVxuICAgICAgICAgIC5zdHlsZShcImZvbnQtd2VpZ2h0XCIsIFwiYm9sZFwiKVxuICAgICAgICAgIC5hdHRyKFwidGV4dC1hbmNob3JcIiwgXCJtaWRkbGVcIilcbiAgICAgICAgICAuYXR0cihcImZpbGxcIiwgKGQpID0+IHtcbiAgICAgICAgICAgIGlmICh0aGlzLmxhYmVsY29sb3IubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICByZXR1cm4gdGhpcy5sYWJlbGNvbG9yO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgcmV0dXJuIFwiYmxhY2tcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KVxuICAgICAgICAgIC5hdHRyKFwieFwiLCBmdW5jdGlvbiAoZCwgaSkge1xuICAgICAgICAgICAgcmV0dXJuIHgoZC5sYWJlbCk7XG4gICAgICAgICAgfSlcbiAgICAgICAgICAuYXR0cihcInlcIiwgZnVuY3Rpb24gKGQsIGkpIHtcbiAgICAgICAgICAgIHJldHVybiB5KGQudmFsdWUpIC0gMTA7XG4gICAgICAgICAgfSlcbiAgICAgICAgICAudGV4dChmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgcmV0dXJuIGQudmFsdWU7XG4gICAgICAgICAgfSlcbiAgICAgIH1cblxuICAgIH1cblxubGluZUNoYXJ0Q2xpY2soZDogYW55KXtcbiAgICBsZXQgb2JqID0ge307XG4gICAgb2JqW2QubGVnZW5kXSA9IGQudmFsdWU7XG4gICAgb2JqW3RoaXMueGF4aXNuYW1lXSA9IGQubGFiZWw7XG4gICAgdGhpcy5jaGFydENsaWNrKG9iaik7XG59XG5cbiAgICBjYWxsVG9vbHRpcCh0b29sdGlwZGF0YTogYW55KSB7XG4gICAgICAgIGxldCBvYmogPSB7fTtcbiAgICAgICAgb2JqW3Rvb2x0aXBkYXRhLmxlZ2VuZF0gPSB0b29sdGlwZGF0YS52YWx1ZTtcbiAgICAgICAgb2JqW3RoaXMueGF4aXNuYW1lXSA9IHRvb2x0aXBkYXRhLmxhYmVsO1xuICAgICAgICByZXR1cm4gdGhpcy50b29sVGlwRm9yQmFyKG9iaik7XG4gICAgfVxufSJdfQ==